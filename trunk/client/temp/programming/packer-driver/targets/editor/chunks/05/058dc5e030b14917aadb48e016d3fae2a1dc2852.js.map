{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/core/common/loader/ResLoader.ts"],"names":["ResLoader","Asset","assetManager","error","js","resources","warn","defaultBundleName","maxConcurrency","downloader","value","maxRequestsPerFrame","maxRetryCount","retryInterval","loadRemote","url","args","options","onComplete","length","loadBundle","v","Promise","resolve","reject","version","err","bundle","load","bundleName","paths","type","onProgress","Array","parseLoadResArgs","loadByArgs","loadAsync","asset","message","loadDir","dir","release","path","getBundle","get","releasePrefabtDepsRecursively","releaseDir","infos","getDirWithPath","map","info","uuid","removeBundle","decRef","assets","dump","forEach","key","console","log","count","pathsOut","typeOut","onProgressOut","onCompleteOut","undefined","isValidType","isChildClassOf","loadByBundleAndArgs","bundles","has","preLoadAsync","preLoad","preLoadByArgs","preLoadByBundleAndArgs","preloadDir","preload","resLoader"],"mappings":"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","sourcesContent":["import { Asset, AssetManager, Constructor, __private, assetManager, error, js, resources, warn } from \"cc\";\r\n\r\nexport type ProgressCallback = __private._cocos_asset_asset_manager_deprecated__LoadProgressCallback;\r\nexport type CompleteCallback<T = any> = any;       // (error: Error | null, asset: T) => void;  (error: Error | null, asset: T[], urls: string[]) => void;\r\nexport type IRemoteOptions = { [k: string]: any; ext?: string; } | null;\r\nexport type AssetType<T = Asset> = Constructor<T>;\r\n\r\ninterface ILoadResArgs<T extends Asset> {\r\n    bundle?: string;\r\n    dir?: string;\r\n    paths: string | string[];\r\n    type: AssetType<T> | null;\r\n    onProgress: ProgressCallback | null;\r\n    onComplete: CompleteCallback<T> | null;\r\n}\r\n\r\n/** \r\n * 游戏资源管理\r\n * 1、加载默认resources文件夹中资源\r\n * 2、加载默认bundle远程资源\r\n * 3、主动传递bundle名时，优先加载传递bundle名资源包中的资源\r\n */\r\nexport class ResLoader {\r\n    /** 全局默认加载的资源包名 */\r\n    defaultBundleName: string = \"resources\";\r\n\r\n    /** 下载时的最大并发数 - 项目设置 -> 项目数据 -> 资源下载并发数，设置默认值；初始值为15 */\r\n    get maxConcurrency() {\r\n        return assetManager.downloader.maxConcurrency;\r\n    }\r\n    set maxConcurrency(value) {\r\n        assetManager.downloader.maxConcurrency = value;\r\n    }\r\n\r\n    /** 下载时每帧可以启动的最大请求数 - 默认值为15 */\r\n    get maxRequestsPerFrame() {\r\n        return assetManager.downloader.maxRequestsPerFrame;\r\n    }\r\n    set maxRequestsPerFrame(value) {\r\n        assetManager.downloader.maxRequestsPerFrame = value;\r\n    }\r\n\r\n    /** 失败重试次数 - 默认值为0 */\r\n    get maxRetryCount() {\r\n        return assetManager.downloader.maxRetryCount;\r\n    }\r\n    set maxRetryCount(value) {\r\n        assetManager.downloader.maxRetryCount = value;\r\n    }\r\n\r\n    /** 重试的间隔时间，单位为毫秒 - 默认值为2000毫秒 */\r\n    get retryInterval() {\r\n        return assetManager.downloader.retryInterval;\r\n    }\r\n    set retryInterval(value) {\r\n        assetManager.downloader.retryInterval = value;\r\n    }\r\n\r\n    /**\r\n     * 加载远程资源\r\n     * @param url           资源地址\r\n     * @param options       资源参数，例：{ ext: \".png\" }\r\n     * @param onComplete    加载完成回调\r\n     * @example\r\nvar opt: IRemoteOptions = { ext: \".png\" };\r\nvar onComplete = (err: Error | null, data: ImageAsset) => {\r\n    const texture = new Texture2D();\r\n    texture.image = data;\r\n    \r\n    const spriteFrame = new SpriteFrame();\r\n    spriteFrame.texture = texture;\r\n    \r\n    var sprite = this.sprite.addComponent(Sprite);\r\n    sprite.spriteFrame = spriteFrame;\r\n}\r\noops.res.loadRemote<ImageAsset>(this.url, opt, onComplete);\r\n     */\r\n    loadRemote<T extends Asset>(url: string, options: IRemoteOptions | null, onComplete?: CompleteCallback<T> | null): void;\r\n    loadRemote<T extends Asset>(url: string, onComplete?: CompleteCallback<T> | null): void;\r\n    loadRemote<T extends Asset>(url: string, ...args: any): void {\r\n        let options: IRemoteOptions | null = null;\r\n        let onComplete: CompleteCallback<T> | null = null;\r\n        if (args.length == 2) {\r\n            options = args[0];\r\n            onComplete = args[1];\r\n        }\r\n        else {\r\n            onComplete = args[0];\r\n        }\r\n        assetManager.loadRemote<T>(url, options, onComplete);\r\n    }\r\n\r\n    /**\r\n     * 加载资源包\r\n     * @param url       资源地址\r\n     * @param v         资源MD5版本号\r\n     * @example\r\nvar serverUrl = \"http://192.168.1.8:8080/\";         // 服务器地址\r\nvar md5 = \"8e5c0\";                                  // Cocos Creator 构建后的MD5字符\r\nawait oops.res.loadBundle(serverUrl,md5);\r\n     */\r\n    loadBundle(url: string, v?: string) {\r\n        return new Promise<AssetManager.Bundle>((resolve, reject) => {\r\n            assetManager.loadBundle(url, { version: v }, (err, bundle: AssetManager.Bundle) => {\r\n                if (err) {\r\n                    return error(err);\r\n                }\r\n                resolve(bundle);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 加载一个资源\r\n     * @param bundleName    远程包名\r\n     * @param paths         资源路径\r\n     * @param type          资源类型\r\n     * @param onProgress    加载进度回调\r\n     * @param onComplete    加载完成回调\r\n     * @example\r\noops.res.load(\"spine_path\", sp.SkeletonData, (err: Error | null, sd: sp.SkeletonData) => {\r\n\r\n});\r\n     */\r\n    load<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(bundleName: string, paths: string | string[], onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(bundleName: string, paths: string | string[], onComplete?: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null, onComplete?: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(paths: string | string[], type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(paths: string | string[], onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(paths: string | string[], onComplete?: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(paths: string | string[], type: AssetType<T> | null, onComplete?: CompleteCallback<T> | null): void;\r\n    load<T extends Asset>(\r\n        bundleName: string,\r\n        paths?: string | string[] | AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        onProgress?: ProgressCallback | CompleteCallback | null,\r\n        onComplete?: CompleteCallback | null,\r\n    ) {\r\n        let args: ILoadResArgs<T> | null = null;\r\n        if (typeof paths === \"string\" || paths instanceof Array) {\r\n            args = this.parseLoadResArgs(paths, type, onProgress, onComplete);\r\n            args.bundle = bundleName;\r\n        }\r\n        else {\r\n            args = this.parseLoadResArgs(bundleName, paths, type, onProgress);\r\n            args.bundle = this.defaultBundleName;\r\n        }\r\n        this.loadByArgs(args);\r\n    }\r\n\r\n    loadAsync<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    loadAsync<T extends Asset>(bundleName: string, paths: string | string[]): Promise<T>;\r\n    loadAsync<T extends Asset>(bundleName: string, paths: string | string[]): Promise<T>;\r\n    loadAsync<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    loadAsync<T extends Asset>(paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    loadAsync<T extends Asset>(paths: string | string[]): Promise<T>;\r\n    loadAsync<T extends Asset>(paths: string | string[]): Promise<T>;\r\n    loadAsync<T extends Asset>(paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    loadAsync<T extends Asset>(bundleName: string, paths?: string | string[] | AssetType<T> | ProgressCallback | CompleteCallback | null, type?: AssetType<T> | ProgressCallback | CompleteCallback | null): Promise<T> {\r\n        return new Promise((resolve, reject) => {\r\n            this.load(bundleName, paths, type, (err: Error | null, asset: T) => {\r\n                if (err) {\r\n                    warn(err.message);\r\n                }\r\n                resolve(asset);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 加载文件夹中的资源\r\n     * @param bundleName    远程包名\r\n     * @param dir           文件夹名\r\n     * @param type          资源类型\r\n     * @param onProgress    加载进度回调\r\n     * @param onComplete    加载完成回调\r\n     * @example\r\n// 加载进度事件\r\nvar onProgressCallback = (finished: number, total: number, item: any) => {\r\n    console.log(\"资源加载进度\", finished, total);\r\n}\r\n\r\n// 加载完成事件\r\nvar onCompleteCallback = () => {\r\n    console.log(\"资源加载完成\");\r\n}\r\noops.res.loadDir(\"game\", onProgressCallback, onCompleteCallback);\r\n     */\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, onComplete?: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, type: AssetType<T> | null, onComplete?: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(dir: string, type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(dir: string, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(dir: string, onComplete?: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(dir: string, type: AssetType<T> | null, onComplete?: CompleteCallback<T[]> | null): void;\r\n    loadDir<T extends Asset>(\r\n        bundleName: string,\r\n        dir?: string | AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        onProgress?: ProgressCallback | CompleteCallback | null,\r\n        onComplete?: CompleteCallback | null,\r\n    ) {\r\n        let args: ILoadResArgs<T> | null = null;\r\n        if (typeof dir === \"string\") {\r\n            args = this.parseLoadResArgs(dir, type, onProgress, onComplete);\r\n            args.bundle = bundleName;\r\n        }\r\n        else {\r\n            args = this.parseLoadResArgs(bundleName, dir, type, onProgress);\r\n            args.bundle = this.defaultBundleName;\r\n        }\r\n        args.dir = args.paths as string;\r\n        this.loadByArgs(args);\r\n    }\r\n\r\n    /**\r\n     * 通过资源相对路径释放资源\r\n     * @param path          资源路径\r\n     * @param bundleName    远程资源包名\r\n     */\r\n    release(path: string, bundleName?: string) {\r\n        if (bundleName == null) bundleName = this.defaultBundleName;\r\n\r\n        const bundle = assetManager.getBundle(bundleName);\r\n        if (bundle) {\r\n            const asset = bundle.get(path);\r\n            if (asset) {\r\n                this.releasePrefabtDepsRecursively(asset);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 通过相对文件夹路径删除所有文件夹中资源\r\n     * @param path          资源文件夹路径\r\n     * @param bundleName    远程资源包名\r\n     */\r\n    releaseDir(path: string, bundleName?: string) {\r\n        if (bundleName == null) bundleName = this.defaultBundleName;\r\n\r\n        const bundle: AssetManager.Bundle | null = assetManager.getBundle(bundleName);\r\n        if (bundle) {\r\n            var infos = bundle.getDirWithPath(path);\r\n            if (infos) {\r\n                infos.map((info) => {\r\n                    this.releasePrefabtDepsRecursively(info.uuid);\r\n                });\r\n            }\r\n\r\n            if (path == \"\" && bundleName != \"resources\") {\r\n                assetManager.removeBundle(bundle);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 释放预制依赖资源 */\r\n    private releasePrefabtDepsRecursively(uuid: string | Asset) {\r\n        if (uuid instanceof Asset) {\r\n            uuid.decRef();\r\n            // assetManager.releaseAsset(uuid);\r\n        }\r\n        else {\r\n            const asset = assetManager.assets.get(uuid);\r\n            if (asset) {\r\n                asset.decRef();\r\n                // assetManager.releaseAsset(asset);\r\n            }\r\n        }\r\n\r\n        // Cocos引擎内部已处理子关联资源的释放\r\n        // if (asset instanceof Prefab) {\r\n        //     var uuids: string[] = assetManager.dependUtil.getDepsRecursively(uuid)!;\r\n        //     uuids.forEach(uuid => {\r\n        //         var asset = assetManager.assets.get(uuid)!;\r\n        //         asset.decRef();\r\n        //     });\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * 获取资源\r\n     * @param path          资源路径\r\n     * @param type          资源类型\r\n     * @param bundleName    远程资源包名\r\n     */\r\n    get<T extends Asset>(path: string, type?: __private.__types_globals__Constructor<T> | null, bundleName?: string): T | null {\r\n        if (bundleName == null) bundleName = this.defaultBundleName;\r\n\r\n        var bundle: AssetManager.Bundle = assetManager.getBundle(bundleName)!;\r\n        return bundle.get(path, type);\r\n    }\r\n\r\n    /** 打印缓存中所有资源信息 */\r\n    dump() {\r\n        assetManager.assets.forEach((value: Asset, key: string) => {\r\n            console.log(assetManager.assets.get(key));\r\n        })\r\n        console.log(`当前资源总数:${assetManager.assets.count}`);\r\n    }\r\n\r\n    private parseLoadResArgs<T extends Asset>(\r\n        paths: string | string[],\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        onProgress?: AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        onComplete?: ProgressCallback | CompleteCallback | null\r\n    ) {\r\n        let pathsOut: any = paths;\r\n        let typeOut: any = type;\r\n        let onProgressOut: any = onProgress;\r\n        let onCompleteOut: any = onComplete;\r\n        if (onComplete === undefined) {\r\n            const isValidType = js.isChildClassOf(type as AssetType, Asset);\r\n            if (onProgress) {\r\n                onCompleteOut = onProgress as CompleteCallback;\r\n                if (isValidType) {\r\n                    onProgressOut = null;\r\n                }\r\n            }\r\n            else if (onProgress === undefined && !isValidType) {\r\n                onCompleteOut = type as CompleteCallback;\r\n                onProgressOut = null;\r\n                typeOut = null;\r\n            }\r\n            if (onProgress !== undefined && !isValidType) {\r\n                onProgressOut = type as ProgressCallback;\r\n                typeOut = null;\r\n            }\r\n        }\r\n        return { paths: pathsOut, type: typeOut, onProgress: onProgressOut, onComplete: onCompleteOut };\r\n    }\r\n\r\n    private loadByBundleAndArgs<T extends Asset>(bundle: AssetManager.Bundle, args: ILoadResArgs<T>): void {\r\n        if (args.dir) {\r\n            bundle.loadDir(args.paths as string, args.type, args.onProgress, args.onComplete);\r\n        }\r\n        else {\r\n            if (typeof args.paths == 'string') {\r\n                bundle.load(args.paths, args.type, args.onProgress, args.onComplete);\r\n            }\r\n            else {\r\n                bundle.load(args.paths, args.type, args.onProgress, args.onComplete);\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadByArgs<T extends Asset>(args: ILoadResArgs<T>) {\r\n        if (args.bundle) {\r\n            if (assetManager.bundles.has(args.bundle)) {\r\n                let bundle = assetManager.bundles.get(args.bundle);\r\n                this.loadByBundleAndArgs(bundle!, args);\r\n            }\r\n            else {\r\n                // 自动加载bundle\r\n                assetManager.loadBundle(args.bundle, (err, bundle) => {\r\n                    if (!err) {\r\n                        this.loadByBundleAndArgs(bundle, args);\r\n                    }\r\n                })\r\n            }\r\n        }\r\n        else {\r\n            this.loadByBundleAndArgs(resources, args);\r\n        }\r\n    }\r\n\r\n    preLoadAsync<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    preLoadAsync<T extends Asset>(bundleName: string, paths: string | string[]): Promise<T>;\r\n    preLoadAsync<T extends Asset>(bundleName: string, paths: string | string[]): Promise<T>;\r\n    preLoadAsync<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    preLoadAsync<T extends Asset>(paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    preLoadAsync<T extends Asset>(paths: string | string[]): Promise<T>;\r\n    preLoadAsync<T extends Asset>(paths: string | string[]): Promise<T>;\r\n    preLoadAsync<T extends Asset>(paths: string | string[], type: AssetType<T> | null): Promise<T>;\r\n    preLoadAsync<T extends Asset>(bundleName: string, paths?: string | string[] | AssetType<T> | ProgressCallback | CompleteCallback | null, type?: AssetType<T> | ProgressCallback | CompleteCallback | null): Promise<T> {\r\n        return new Promise((resolve, reject) => {\r\n            this.preLoad(bundleName, paths, type, (err: Error | null, asset: T) => {\r\n                if (err) {\r\n                    warn(err.message);\r\n                }\r\n                resolve(asset);\r\n            });\r\n        });\r\n    }\r\n\r\n    preLoad<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(bundleName: string, paths: string | string[], onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(bundleName: string, paths: string | string[], onComplete?: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(bundleName: string, paths: string | string[], type: AssetType<T> | null, onComplete?: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(paths: string | string[], type: AssetType<T> | null, onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(paths: string | string[], onProgress: ProgressCallback | null, onComplete: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(paths: string | string[], onComplete?: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(paths: string | string[], type: AssetType<T> | null, onComplete?: CompleteCallback<T> | null): void;\r\n    preLoad<T extends Asset>(\r\n        bundleName: string,\r\n        paths?: string | string[] | AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback | null,\r\n        onProgress?: ProgressCallback | CompleteCallback | null,\r\n        onComplete?: CompleteCallback | null,\r\n    ) {\r\n        let args: ILoadResArgs<T> | null = null;\r\n        if (typeof paths === \"string\" || paths instanceof Array) {\r\n            args = this.parseLoadResArgs(paths, type, onProgress, onComplete);\r\n            args.bundle = bundleName;\r\n        }\r\n        else {\r\n            args = this.parseLoadResArgs(bundleName, paths, type, onProgress);\r\n            args.bundle = this.defaultBundleName;\r\n        }\r\n        this.preLoadByArgs(args);\r\n    }\r\n\r\n    private preLoadByArgs<T extends Asset>(args: ILoadResArgs<T>) {\r\n        if (args.bundle) {\r\n            if (assetManager.bundles.has(args.bundle)) {\r\n                let bundle = assetManager.bundles.get(args.bundle);\r\n                this.preLoadByBundleAndArgs(bundle!, args);\r\n            }\r\n            else {\r\n                // 自动加载bundle\r\n                assetManager.loadBundle(args.bundle, (err, bundle) => {\r\n                    if (!err) {\r\n                        this.preLoadByBundleAndArgs(bundle, args);\r\n                    }\r\n                })\r\n            }\r\n        }\r\n        else {\r\n            this.preLoadByBundleAndArgs(resources, args);\r\n        }\r\n    }\r\n\r\n    private preLoadByBundleAndArgs<T extends Asset>(bundle: AssetManager.Bundle, args: ILoadResArgs<T>): void {\r\n        if (args.dir) {\r\n            bundle.preloadDir(args.paths as string, args.type, args.onProgress, args.onComplete);\r\n        }\r\n        else {\r\n            if (typeof args.paths == 'string') {\r\n                bundle.preload(args.paths, args.type, args.onProgress, args.onComplete);\r\n            }\r\n            else {\r\n                bundle.preload(args.paths, args.type, args.onProgress, args.onComplete);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport const resLoader = new ResLoader();"]}