{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/resources/libs/utils/full_screen_adapter.ts"],"names":["_decorator","Component","CCBoolean","ResolutionPolicy","screen","view","ccclass","property","FullScreenAdapter","tooltip","type","onLoad","screenAdapter","on","showAll","setShowAll","screenRatio","computeScreenRatio","designRatio","computeDesignRatio","devicePixelRatio","setFitWidth","setFitHeight","windowSize","width","height","ds","getDesignResolutionSize","setExactFit","setDesignResolutionSize","EXACT_FIT","SHOW_ALL","FIXED_WIDTH","FIXED_HEIGHT"],"mappings":"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","sourcesContent":["import {_decorator, Component, CCBoolean, ResolutionPolicy, screen, view} from 'cc';\r\n\r\nconst {ccclass, property} = _decorator;\r\n\r\n@ccclass('full_screen_adapter')\r\nexport default class FullScreenAdapter extends Component {\r\n    @property({\r\n        tooltip: '等比适配开关',\r\n        type: CCBoolean,\r\n    })\r\n    protected showAll: boolean = false;  // 等比缩放\r\n\r\n    onLoad() {\r\n        this.screenAdapter();\r\n\r\n        //监听窗口大小变化时的回调，每次窗口变化都要自动适配\r\n        screen.on('window-resize', () => {\r\n            this.screenAdapter();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fit Height 模式：适用于宽大于高的屏幕\r\n     * Fit Width 模式：适用于高大于宽的屏幕\r\n     */\r\n    screenAdapter() {\r\n        if (this.showAll) {\r\n            this.setShowAll();\r\n            return;\r\n        }\r\n\r\n        const screenRatio = this.computeScreenRatio();\r\n        const designRatio = this.computeDesignRatio();\r\n        const devicePixelRatio = screen.devicePixelRatio;\r\n\r\n        if (screenRatio <= 1) {\r\n            // 屏幕高度大于或等于宽度,即竖屏\r\n            if (screenRatio <= designRatio) {\r\n                this.setFitWidth();\r\n            } else {\r\n                // 此时屏幕比例大于设计比例\r\n                // 为了保证纵向的游戏内容不受影响，应该使用 fitHeight 模式\r\n                this.setFitHeight();\r\n            }\r\n        } else {\r\n            // 屏幕宽度大于高度,即横屏\r\n            this.setFitHeight();\r\n        }\r\n\r\n        // log('screenAdapter', screenRatio, designRatio, devicePixelRatio, view.getResolutionPolicy());\r\n    }\r\n\r\n    /**\r\n     * 当前屏幕分辨率比例\r\n     */\r\n    computeScreenRatio(): number {\r\n        return screen.windowSize.width / screen.windowSize.height;\r\n    }\r\n\r\n    /**\r\n     * 设计稿分辨率比例\r\n     */\r\n    computeDesignRatio(): number {\r\n        const ds = view.getDesignResolutionSize();\r\n        return ds.width / ds.height;\r\n    }\r\n\r\n    /**\r\n     * 非等比拉伸\r\n     */\r\n    setExactFit() {\r\n        // view.setResolutionPolicy(ResolutionPolicy.FIXED_HEIGHT);\r\n        view.setDesignResolutionSize(view.getDesignResolutionSize().width, view.getDesignResolutionSize().height, ResolutionPolicy.EXACT_FIT);\r\n        // console.log('EXACT_FIT', view.getDesignResolutionSize().width, view.getDesignResolutionSize().height);\r\n    }\r\n\r\n    /**\r\n     * 等比缩放\r\n     */\r\n    setShowAll() {\r\n        // log('setShowAll: ', view.getDesignResolutionSize().width, view.getDesignResolutionSize().height);\r\n        view.setDesignResolutionSize(view.getDesignResolutionSize().width, view.getDesignResolutionSize().height, ResolutionPolicy.SHOW_ALL);\r\n        // console.log('SHOW_ALL', view.getDesignResolutionSize().width, view.getDesignResolutionSize().height);\r\n    }\r\n\r\n    /**\r\n     * 适应宽度\r\n     */\r\n    setFitWidth() {\r\n        // view.setResolutionPolicy(ResolutionPolicy.FIXED_WIDTH);\r\n        view.setDesignResolutionSize(view.getDesignResolutionSize().width, view.getDesignResolutionSize().height, ResolutionPolicy.FIXED_WIDTH);\r\n        // console.log('FIXED_WIDTH', view.getDesignResolutionSize().width, view.getDesignResolutionSize().height);\r\n    }\r\n\r\n    /**\r\n     * 适应高度\r\n     */\r\n    setFitHeight() {\r\n        // view.setResolutionPolicy(ResolutionPolicy.FIXED_HEIGHT);\r\n        view.setDesignResolutionSize(view.getDesignResolutionSize().width, view.getDesignResolutionSize().height, ResolutionPolicy.FIXED_HEIGHT);\r\n        // console.log('FIXED_HEIGHT', view.getDesignResolutionSize().width, view.getDesignResolutionSize().height);\r\n    }\r\n}\r\n"]}