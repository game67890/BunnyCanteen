{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/ton/TonManager.ts"],"names":["TonManager","sys","TelegramWebApp","oops","UtilMgr","TonGameMgr","_bTonInit","_connectUI","serverHost","_config","init","isHttps","http","server","platform","Platform","MOBILE_BROWSER","Instance","then","result","TelegramInitData","getTelegramInitData","console","log","TelegramInitDataUnsafe","getTelegramWebAppInitData","user","UserId","id","toString","UserName","first_name","last_name","TGHash","hash","IsTelegramUser","TelegramReferrer","catch","error","TonMgr"],"mappings":";;;+HAeaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;AAdQC,MAAAA,G,OAAAA,G;;AADZC,MAAAA,c,iBAAAA,c;;AAEAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,O,iBAAAA,O;;AAKAC,MAAAA,U,iBAAAA,U;;;;;;;gDAJT;AAEA;;;4BASaL,U,GAAN,MAAMA,UAAN,CAAiB;AAAA;AAAA,eAEZM,SAFY,GAES,KAFT;AAIpB;AAJoB,eAKZC,UALY;AAAA,eAOZC,UAPY,GAOS,oCAPT;AASpB;AAToB,eAUZC,OAVY;AAAA;;AAYpB;AACOC,QAAAA,IAAI,GAAG;AACV,cAAI,KAAKJ,SAAT,EAAoB;;AACpB,cAAI;AAAA;AAAA,kCAAQK,OAAR,CAAgB;AAAA;AAAA,4BAAKC,IAAL,CAAUC,MAA1B,CAAJ,EACA;AACI;AACA,gBAAI;AACA,kBAAIZ,GAAG,CAACa,QAAJ,KAAiBb,GAAG,CAACc,QAAJ,CAAaC,cAAlC,EAAkD;AAC9C;AAAA;AAAA,sDAAeC,QAAf,CAAwBP,IAAxB,GAA+BQ,IAA/B,CAAqCC,MAAD,IAAY;AAC5C;AAEA,sBAAIC,gBAAyB,GAAG;AAAA;AAAA,wDAAeH,QAAf,CAAwBI,mBAAxB,EAAhC;AACAC,kBAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAAmCH,gBAAnC;AAGA,sBAAII,sBAAsB,GAAG;AAAA;AAAA,wDAAeP,QAAf,CAAwBQ,yBAAxB,EAA7B;;AACA,sBAAID,sBAAsB,IAAIA,sBAAsB,CAACE,IAArD,EACA;AACIJ,oBAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CC,sBAAsB,CAACE,IAArE;AACA;AAAA;AAAA,kDAAWC,MAAX,GAAoBH,sBAAsB,CAACE,IAAvB,CAA4BE,EAA5B,CAA+BC,QAA/B,EAApB;AACA;AAAA;AAAA,kDAAWC,QAAX,GAAsBN,sBAAsB,CAACE,IAAvB,CAA4BK,UAA5B,GAAyCP,sBAAsB,CAACE,IAAvB,CAA4BM,SAA3F;AACA;AAAA;AAAA,kDAAWC,MAAX,GAAoBT,sBAAsB,CAACU,IAA3C;AACA;AAAA;AAAA,kDAAWC,cAAX,GAA4B,IAA5B;AAEA;AAAA;AAAA,kDAAWC,gBAAX,GAA8BZ,sBAAsB,CAAC,UAAD,CAApD,CAPJ,CAQI;AACH,mBAVD,MAYA;AACI;AAAA;AAAA,kDAAWW,cAAX,GAA4B,KAA5B;AACH;;AACD;AAAA;AAAA,gDAAWzB,IAAX;AACH,iBAxBD,EAwBG2B,KAxBH,CAwBUC,KAAD,IAAW;AAChB;AAAA;AAAA,gDAAW5B,IAAX;AACH,iBA1BD;AA2BH,eA5BD,MA8BA;AACI;AAAA;AAAA,8CAAWA,IAAX;AACH;AACJ,aAlCD,CAkCE,OAAO4B,KAAP,EAAc;AACZ;AAAA;AAAA,4CAAW5B,IAAX;AACH;AACJ,WAxCD,MA0CA;AACI;AAAA;AAAA,0CAAWA,IAAX;AACH;AACJ;;AA5DmB,O;;wBAgEb6B,M,GAAS,IAAIvC,UAAJ,E","sourcesContent":["import { TelegramWebApp } from '../../../cocos-telegram-miniapps/scripts/telegram-web';\r\nimport { _decorator, sys } from 'cc';\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\n//import { GameFi, TonConnectUI, Address, toNano, TonTransferRequest } from '@ton/cocos-sdk';\r\n\r\n//import {TonConnectUi , type Transaction} from '../../cocos-telegram-miniapps/scripts/telegram-ui';\r\n\r\nimport { TonGameMgr } from \"../../tongame/manager/TonGameManager\";\r\n\r\nexport interface TonAddressConfig {\r\n    tonAddress: string,\r\n    jettonAddress?: string;\r\n}\r\n\r\nexport class TonManager {\r\n\r\n    private _bTonInit: boolean = false;\r\n\r\n    //private _cocosGameFi: GameFi;\r\n    private _connectUI;\r\n\r\n    private serverHost: string = \"https://bunnycanteen.game67890.com\";\r\n    \r\n    //ton 和jetton地址， ton是买东西付款到的地址\r\n    private _config: TonAddressConfig;\r\n\r\n    /** 初始化 */\r\n    public init() {\r\n        if (this._bTonInit) return;\r\n        if (UtilMgr.isHttps(oops.http.server))\r\n        {\r\n            //初始化Telegram\r\n            try {\r\n                if (sys.platform === sys.Platform.MOBILE_BROWSER) {\r\n                    TelegramWebApp.Instance.init().then((result) => {\r\n                        //console.log(\"telegram web app init : \", res.success);\r\n            \r\n                        let TelegramInitData : string = TelegramWebApp.Instance.getTelegramInitData();\r\n                        console.log(\"TelegramInitData : \", TelegramInitData);\r\n                        \r\n            \r\n                        let TelegramInitDataUnsafe = TelegramWebApp.Instance.getTelegramWebAppInitData();\r\n                        if (TelegramInitDataUnsafe && TelegramInitDataUnsafe.user)\r\n                        {\r\n                            console.log(\"User data from initDataUnsafe:\", TelegramInitDataUnsafe.user);\r\n                            TonGameMgr.UserId = TelegramInitDataUnsafe.user.id.toString();\r\n                            TonGameMgr.UserName = TelegramInitDataUnsafe.user.first_name + TelegramInitDataUnsafe.user.last_name;\r\n                            TonGameMgr.TGHash = TelegramInitDataUnsafe.hash;\r\n                            TonGameMgr.IsTelegramUser = true;\r\n\r\n                            TonGameMgr.TelegramReferrer = TelegramInitDataUnsafe[\"referrer\"];     \r\n                            //oops.gui.toast(\"TelegramInitData: \" + TelegramInitDataUnsafe, true);             \r\n                        }\r\n                        else \r\n                        {\r\n                            TonGameMgr.IsTelegramUser = false;\r\n                        }\r\n                        TonGameMgr.init();\r\n                    }).catch((error) => {\r\n                        TonGameMgr.init();\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    TonGameMgr.init();\r\n                }\r\n            } catch (error) {\r\n                TonGameMgr.init();\r\n            }\r\n        }\r\n        else\r\n        {\r\n            TonGameMgr.init();\r\n        }\r\n    }   \r\n\r\n}\r\n\r\nexport var TonMgr = new TonManager();"]}