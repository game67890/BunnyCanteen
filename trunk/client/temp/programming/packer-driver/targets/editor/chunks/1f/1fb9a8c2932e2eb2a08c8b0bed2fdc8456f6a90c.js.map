{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/framework/account/bll/AccountNetData.ts"],"names":["oops","ecs","netConfig","AccountModelComp","AccountNetDataComp","register","Comp","reset","AccountNetDataSystem","ComblockSystem","filter","allOf","entityEnter","e","params","playerId","dbid","sessionKey","onComplete","target","callback","data","id","name","power","agile","physical","lv","jobId","remove","setLocalStorage","uid","storage","setUser","set"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQSA,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,G,iBAAAA,G;;AAEAC,MAAAA,S,iBAAAA,S;;AAGAC,MAAAA,gB,iBAAAA,gB;;;;;;;AAdT;AACA;AACA;AACA;AACA;AACA;iCAOA;;;AAIA;oCAEaC,kB,WADZ;AAAA;AAAA,sBAAIC,QAAJ,CAAa,gBAAb,C,gBAAD,MACaD,kBADb,SACwC;AAAA;AAAA,sBAAIE,IAD5C,CACiD;AAC7CC,QAAAA,KAAK,GAAG,CAAG;;AADkC,O;AAIjD;;;sCAEaC,oB,YADZ;AAAA;AAAA,sBAAIH,QAAJ,CAAa,SAAb,C,kBAAD,MACaG,oBADb,SAC0C;AAAA;AAAA,sBAAIC,cAD9C,CAC+F;AAC3FC,QAAAA,MAAM,GAAiB;AACnB,iBAAO;AAAA;AAAA,0BAAIC,KAAJ,CAAUP,kBAAV;AAAA;AAAA,mDAAP;AACH;;AAEDQ,QAAAA,WAAW,CAACC,CAAD,EAAmB;AAC1B,cAAIC,MAAW,GAAG;AACdC,YAAAA,QAAQ,EAAE;AAAA;AAAA,wCAAUC,IADN;AAEdC,YAAAA,UAAU,EAAE;AAAA;AAAA,wCAAUA;AAFR,WAAlB;AAKA,cAAIC,UAAU,GAAG;AACbC,YAAAA,MAAM,EAAE,IADK;AAEbC,YAAAA,QAAQ,EAAGC,IAAD,IAAe,CACrB;AACA;AAEA;AACA;AAEA;AACA;AACH;AAXY,WAAjB,CAN0B,CAmB1B;AACA;AAEA;;AACA,cAAIA,IAAI,GAAG;AACPC,YAAAA,EAAE,EAAE,CADG;AAEPC,YAAAA,IAAI,EAAE,MAFC;AAGPC,YAAAA,KAAK,EAAE,EAHA;AAIPC,YAAAA,KAAK,EAAE,EAJA;AAKPC,YAAAA,QAAQ,EAAE,EALH;AAMPC,YAAAA,EAAE,EAAE,CANG;AAOPC,YAAAA,KAAK,EAAE;AAPA,WAAX;AASAV,UAAAA,UAAU,CAACE,QAAX,CAAoBC,IAApB,EAhC0B,CAiC1B;;AAEAR,UAAAA,CAAC,CAACgB,MAAF,CAASzB,kBAAT;AACH;AAED;;AACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AASI;;;AACQ0B,QAAAA,eAAe,CAACC,GAAD,EAAc;AACjC;AAAA;AAAA,4BAAKC,OAAL,CAAaC,OAAb,CAAqBF,GAArB;AACA;AAAA;AAAA,4BAAKC,OAAL,CAAaE,GAAb,CAAiB,SAAjB,EAA4BH,GAA5B;AACH;;AAjF0F,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-11-23 15:51:15\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-07-25 17:03:54\r\n */\r\n\r\nimport { v3 } from \"cc\";\r\nimport { oops } from \"../../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { ecs } from \"../../../../../extensions/oops-plugin-framework/assets/libs/ecs/ECS\";\r\nimport { GameEvent } from \"../../common/config/GameEvent\";\r\nimport { netConfig } from \"../../common/net/NetConfig\";\r\n//import { Role } from \"../../role/Role\";\r\nimport { Account } from \"../Account\";\r\nimport { AccountModelComp } from \"../model/AccountModelComp\";\r\n\r\n/** 请求玩家游戏数据 */\r\n@ecs.register('AccountNetData')\r\nexport class AccountNetDataComp extends ecs.Comp {\r\n    reset() { }\r\n}\r\n\r\n/** 请求玩家游戏数据 */\r\n@ecs.register('Account')\r\nexport class AccountNetDataSystem extends ecs.ComblockSystem implements ecs.IEntityEnterSystem {\r\n    filter(): ecs.IMatcher {\r\n        return ecs.allOf(AccountNetDataComp, AccountModelComp);\r\n    }\r\n\r\n    entityEnter(e: Account): void {\r\n        var params: any = {\r\n            playerId: netConfig.dbid,\r\n            sessionKey: netConfig.sessionKey,\r\n        }\r\n\r\n        let onComplete = {\r\n            target: this,\r\n            callback: (data: any) => {\r\n                // 设置本地存储的用户标识（用于下次登录不输入帐号）\r\n                //this.setLocalStorage(data.id);\r\n\r\n                // 创建玩家角色对象\r\n                //this.createRole(e, data);\r\n\r\n                // 玩家登录成功事件\r\n                //oops.message.dispatchEvent(GameEvent.LoginSuccess);\r\n            }\r\n        }\r\n        // 请求登录游戏获取角色数据\r\n        // netChannel.game.req(\"LoginAction\", \"loadPlayer\", params, onComplete);\r\n\r\n        // 离线测试代码开始\r\n        var data = {\r\n            id: 1,\r\n            name: \"Oops\",\r\n            power: 10,\r\n            agile: 10,\r\n            physical: 10,\r\n            lv: 1,\r\n            jobId: 1\r\n        }\r\n        onComplete.callback(data);\r\n        // 离线测试代码结束\r\n\r\n        e.remove(AccountNetDataComp);\r\n    }\r\n\r\n    /** 创建角色对象（自定义逻辑） */\r\n    /*\r\n    private createRole(e: Account, data: any) {\r\n        var role = ecs.getEntity<Role>(Role);\r\n\r\n        // 角色数据\r\n        role.RoleModel.id = data.id;\r\n        role.RoleModel.name = data.name;\r\n\r\n        // 角色初始战斗属性\r\n        role.RoleModelBase.power = data.power;\r\n        role.RoleModelBase.agile = data.agile;\r\n        role.RoleModelBase.physical = data.physical;\r\n\r\n        // 角色等级数据\r\n        role.upgrade(data.lv);\r\n\r\n        // 角色职业数据\r\n        role.RoleModelJob.id = data.jobId;\r\n\r\n        // 角色基础属性绑定到界面上显示\r\n        role.RoleModel.vmAdd();\r\n        // 角色等级属性绑定到界面上显示\r\n        role.RoleModelLevel.vmAdd();\r\n        // 角色初始基础属性绑定到界面上显示\r\n        role.RoleModelBase.vmAdd();\r\n\r\n        // 角色动画显示对象\r\n        role.load(oops.gui.game, v3(0, -300, 0));\r\n\r\n        e.AccountModel.role = role;\r\n    }\r\n        */\r\n\r\n    /** 设置本地存储的用户标识 */\r\n    private setLocalStorage(uid: string) {\r\n        oops.storage.setUser(uid);\r\n        oops.storage.set(\"account\", uid);\r\n    }\r\n}"]}