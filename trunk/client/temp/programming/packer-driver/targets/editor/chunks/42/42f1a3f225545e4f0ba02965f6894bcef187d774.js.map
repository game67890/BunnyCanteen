{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/module/common/ModuleUtil.ts"],"names":["ModuleUtil","oops","ViewUtil","addViewUi","ent","ctor","uiId","uiArgs","uic","onAdded","node","params","comp","getComponent","add","gui","open","addViewUiAsync","Promise","resolve","reject","onLoadFailure","addView","parent","url","createPrefabNode","removeViewUi","isDestroy","remove"],"mappings":";;;+FASaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARLC,MAAAA,I,iBAAAA,I;;AAEAC,MAAAA,Q,iBAAAA,Q;;;;;;;;;4BAMKF,U,GAAN,MAAMA,UAAN,CAAiB;AACpB;AACJ;AACA;AACA;AACA;AACA;AACA;AAC2B,eAATG,SAAS,CACnBC,GADmB,EAEnBC,IAFmB,EAGnBC,IAHmB,EAInBC,MAAW,GAAG,IAJK,EAIC;AACpB,gBAAMC,GAAgB,GAAG;AACrBC,YAAAA,OAAO,EAAE,CAACC,IAAD,EAAaC,MAAb,KAA6B;AAClC,oBAAMC,IAAI,GAAGF,IAAI,CAACG,YAAL,CAAkBR,IAAlB,CAAb;AACAD,cAAAA,GAAG,CAACU,GAAJ,CAAQF,IAAR;AACH;AAJoB,WAAzB;AAMA;AAAA;AAAA,4BAAKG,GAAL,CAASC,IAAT,CAAcV,IAAd,EAAoBC,MAApB,EAA4BC,GAA5B;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;;AACgC,eAAdS,cAAc,CACxBb,GADwB,EAExBC,IAFwB,EAGxBC,IAHwB,EAIxBC,MAAW,GAAG,IAJU,EAIkB;AAC1C,iBAAO,IAAIW,OAAJ,CAAyB,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACjD,kBAAMZ,GAAgB,GAAG;AACrBC,cAAAA,OAAO,EAAE,CAACC,IAAD,EAAaC,MAAb,KAA6B;AAClC,sBAAMC,IAAI,GAAGF,IAAI,CAACG,YAAL,CAAkBR,IAAlB,CAAb;AACAD,gBAAAA,GAAG,CAACU,GAAJ,CAAQF,IAAR;AACAO,gBAAAA,OAAO,CAACT,IAAD,CAAP;AACH,eALoB;AAMrBW,cAAAA,aAAa,EAAE,MAAM;AACjBF,gBAAAA,OAAO,CAAC,IAAD,CAAP;AACH;AARoB,aAAzB;AAUA;AAAA;AAAA,8BAAKJ,GAAL,CAASC,IAAT,CAAcV,IAAd,EAAoBC,MAApB,EAA4BC,GAA5B;AACH,WAZM,CAAP;AAaH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACyB,eAAPc,OAAO,CACjBlB,GADiB,EAEjBC,IAFiB,EAGjBkB,MAHiB,EAIjBC,GAJiB,EAIJ;AACb,gBAAMd,IAAI,GAAG;AAAA;AAAA,oCAASe,gBAAT,CAA0BD,GAA1B,CAAb;AACA,gBAAMZ,IAAI,GAAGF,IAAI,CAACG,YAAL,CAAkBR,IAAlB,CAAb;AACAD,UAAAA,GAAG,CAACU,GAAJ,CAAQF,IAAR;AACAF,UAAAA,IAAI,CAACa,MAAL,GAAcA,MAAd;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AAC8B,eAAZG,YAAY,CAACtB,GAAD,EAAkBC,IAAlB,EAA6CC,IAA7C,EAA2DqB,SAAkB,GAAG,IAAhF,EAAsF;AAC5GvB,UAAAA,GAAG,CAACwB,MAAJ,CAAWvB,IAAX,EAAiBsB,SAAjB;AACA;AAAA;AAAA,4BAAKZ,GAAL,CAASa,MAAT,CAAgBtB,IAAhB,EAAsBqB,SAAtB;AACH;;AA9EmB,O","sourcesContent":["import {Node, __private} from \"cc\";\r\nimport {oops} from \"../../core/Oops\";\r\nimport {UICallbacks} from \"../../core/gui/layer/Defines\";\r\nimport {ViewUtil} from \"../../core/utils/ViewUtil\";\r\nimport {ecs} from \"../../libs/ecs/ECS\";\r\nimport {CompType} from \"../../libs/ecs/ECSModel\";\r\nimport {CCComp} from \"./CCComp\";\r\nimport {CCVMParentComp} from \"./CCVMParentComp\";\r\n\r\nexport class ModuleUtil {\r\n    /**\r\n     * 添加界面组件\r\n     * @param ent      模块实体\r\n     * @param ctor     界面逻辑组件\r\n     * @param uiId     界面资源编号\r\n     * @param uiArgs   界面参数\r\n     */\r\n    public static addViewUi<T extends CCVMParentComp | CCComp>(\r\n        ent: ecs.Entity,\r\n        ctor: __private.__types_globals__Constructor<T> | __private.__types_globals__AbstractedConstructor<T>,\r\n        uiId: number,\r\n        uiArgs: any = null) {\r\n        const uic: UICallbacks = {\r\n            onAdded: (node: Node, params: any) => {\r\n                const comp = node.getComponent(ctor) as ecs.Comp;\r\n                ent.add(comp);\r\n            }\r\n        };\r\n        oops.gui.open(uiId, uiArgs, uic);\r\n    }\r\n\r\n    /**\r\n     * 异步添加视图层组件\r\n     * @param ent      模块实体\r\n     * @param ctor     界面逻辑组件\r\n     * @param uiId     界面资源编号\r\n     * @param uiArgs   界面参数\r\n     * @returns 界面节点\r\n     */\r\n    public static addViewUiAsync<T extends CCVMParentComp | CCComp>(\r\n        ent: ecs.Entity,\r\n        ctor: __private.__types_globals__Constructor<T> | __private.__types_globals__AbstractedConstructor<T>,\r\n        uiId: number,\r\n        uiArgs: any = null): Promise<Node | null> {\r\n        return new Promise<Node | null>((resolve, reject) => {\r\n            const uic: UICallbacks = {\r\n                onAdded: (node: Node, params: any) => {\r\n                    const comp = node.getComponent(ctor) as ecs.Comp;\r\n                    ent.add(comp);\r\n                    resolve(node);\r\n                },\r\n                onLoadFailure: () => {\r\n                    resolve(null);\r\n                }\r\n            };\r\n            oops.gui.open(uiId, uiArgs, uic);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 通过资源内存中获取预制上的组件添加到ECS实体中\r\n     * @param ent      模块实体\r\n     * @param ctor     界面逻辑组件\r\n     * @param parent   显示对象父级\r\n     * @param url      显示资源地址\r\n     */\r\n    public static addView<T extends CCVMParentComp | CCComp>(\r\n        ent: ecs.Entity,\r\n        ctor: __private.__types_globals__Constructor<T> | __private.__types_globals__AbstractedConstructor<T>,\r\n        parent: Node,\r\n        url: string) {\r\n        const node = ViewUtil.createPrefabNode(url);\r\n        const comp = node.getComponent(ctor)!;\r\n        ent.add(comp);\r\n        node.parent = parent;\r\n    }\r\n\r\n    /**\r\n     * 业务实体上移除界面组件\r\n     * @param ent        模块实体\r\n     * @param ctor       界面逻辑组件\r\n     * @param uiId       界面资源编号\r\n     * @param isDestroy  是否释放界面缓存（默认为释放界面缓存）\r\n     */\r\n    public static removeViewUi(ent: ecs.Entity, ctor: CompType<ecs.IComp>, uiId: number, isDestroy: boolean = true) {\r\n        ent.remove(ctor, isDestroy);\r\n        oops.gui.remove(uiId, isDestroy);\r\n    }\r\n}"]}