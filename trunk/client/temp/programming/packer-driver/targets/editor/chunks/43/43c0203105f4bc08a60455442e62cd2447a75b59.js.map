{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/hecheng/HeChengManager.ts"],"names":["HeChengManager","oops","LayerType","GameEvent","TableRestaurantlevel","TableIngredients","TonGameMgr","AutoTypeEnum","StringUtil","LiWuMgr","HeChengComponent","GridComponent","UtilMgr","BoardMgr","JsonUtil","UIID","CarrotMgr","FeedMgr","GuideMgr","_tsRestaurantlevel","_tsIngredients","IsAutoHechenging","IsPlayHechengingAnim","IsAutoOpenLiwu","GridIsFullTipsTimes","TuZiCoinTipsTimes","IsDraging","onHuiShou","console","log","onGotoCarrots","gui","open","CarrotMain","SendOpenPanel","onCaiGou","isAuto","isHasEmptyGrid","hasUI","PopUp","Dialog","toast","init","CanTingLevel","Cost","GetMakeSucaiCost","TuZiCoin","IngredientsId","GetSucaiIdByCanTingLv","addGrid","updateRabbitCoin","BigInt","UpdateExtDishPrice","message","dispatchEvent","UpdateBaseData","UpdateTuziCoin","UpdateBoardGrid","Save","ExtDishPrice","Math","floor","cost1","GetMaxCantingLevel","MaxCantingLevel","jsonTabel","get","TableName","id","Number","level","resultIndex","foodlevel","resultLevel","resultIngredients","jsonIngredients","Ingredients","onAuto","AutoType","NoBuy","BuyAutoUI","HasBuyAndOpen","HasBuyButClose","UpdateAutoBtn","OnHandleAuto","ResetGuide","OnAutoHecheng","OnAutoOpenLiwu","OnAutoHuiShou","recoverylevel","index","board","length","cell","SuCaiId","HandleHuiShou","i","j","NextSuCaiId","GetNextLevelSuCaiId","params","SrcIndex","DestIndex","IsLiWu","IsLiWuFlying","openLiwu","HandleHecheng","srcIndex","destIndex","srcSuCaiId","destSuCaiId","HechengGUI","MainUI","HechengCom","getComponent","gridNode","getGridNode","gridComponent","srcGridNode","srcGridComponent","SuCaiSprite","node","active","PlaySoundEffect","addNodeAnimation","UpdateHechengMaxLevel","AddCanTingExp","CanTingExp","getexp","exp","nextLevel","updateFreeDishId","tips","substitute_1","language","getLangByID","curSuCaiType","type","nextSuCaiLevel","suCaiId","recovery","LastRecoverTuziCoin","HeChengMgr"],"mappings":";;;mPAkBaA,c;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAlBJC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,oB,iBAAAA,oB;;AACAC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,U,iBAAAA,U;AAAYC,MAAAA,Y,iBAAAA,Y;;AACZC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,gB,kBAAAA,gB;;AACAC,MAAAA,a,kBAAAA,a;;AACAC,MAAAA,O,kBAAAA,O;;AACAC,MAAAA,Q,kBAAAA,Q;;AACAC,MAAAA,Q,kBAAAA,Q;;AACAC,MAAAA,I,kBAAAA,I;;AACAC,MAAAA,S,kBAAAA,S;;AACAC,MAAAA,O,kBAAAA,O;;AACAC,MAAAA,Q,kBAAAA,Q;;;;;;;gCAEIlB,c,GAAN,MAAMA,cAAN,CAAqB;AAAA;AAAA,eAChBmB,kBADgB,GACK;AAAA;AAAA,6DADL;AAAA,eAEhBC,cAFgB,GAEC;AAAA;AAAA,qDAFD;AAAA,eAIjBC,gBAJiB,GAIY,KAJZ;AAAA,eAKjBC,oBALiB,GAKgB,KALhB;AAAA,eAMjBC,cANiB,GAMU,KANV;AAAA,eAOhBC,mBAPgB,GAOc,CAPd;AAAA,eAQhBC,iBARgB,GAQY,CARZ;AAAA,eAUjBC,SAViB,GAUK,KAVL;AAAA;;AAYxB;AACOC,QAAAA,SAAS,GAAG;AACfC,UAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACH;AAED;;;AACOC,QAAAA,aAAa,GAAG;AACnB;AAAA;AAAA,4BAAKC,GAAL,CAASC,IAAT,CAAc;AAAA;AAAA,4BAAKC,UAAnB;AACA;AAAA;AAAA,sCAAUC,aAAV,GAFmB,CAGnB;AACH;AAED;;;AACOC,QAAAA,QAAQ,CAACC,MAAD,EAAiB;AAC5B,cAAI,CAAC;AAAA;AAAA,oCAASC,cAAT,EAAL,EACA;AACI;AACA,gBAAID,MAAJ,EACA;AACI,kBAAI,CAAC;AAAA;AAAA,gCAAKL,GAAL,CAASO,KAAT,CAAe;AAAA;AAAA,0CAAUC,KAAzB,CAAD,IAAoC,CAAC;AAAA;AAAA,gCAAKR,GAAL,CAASO,KAAT,CAAe;AAAA;AAAA,0CAAUE,MAAzB,CAAzC,EACA;AACI,oBAAI,KAAKhB,mBAAL,IAA4B,CAAhC,EACA;AACI,uBAAKA,mBAAL,IAA4B,CAA5B;AACA;AAAA;AAAA,oCAAKO,GAAL,CAASU,KAAT,CAAe,eAAf,EAAgC,IAAhC;AACH;AAEJ;AACJ,aAXD,MAaA;AACI;AAAA;AAAA,gCAAKV,GAAL,CAASU,KAAT,CAAe,eAAf,EAAgC,IAAhC;AACH;;AAED;AACH;;AACD,eAAKtB,kBAAL,CAAwBuB,IAAxB,CAA6B;AAAA;AAAA,wCAAWC,YAAxC;;AACA,cAAIC,IAAI,GAAG,KAAKC,gBAAL,EAAX;;AACA,cAAI;AAAA;AAAA,wCAAWC,QAAX,GAAsB,KAAKD,gBAAL,EAA1B,EACA;AACI;AACA,gBAAIT,MAAJ,EACA;AACI,kBAAI,CAAC;AAAA;AAAA,gCAAKL,GAAL,CAASO,KAAT,CAAe;AAAA;AAAA,0CAAUC,KAAzB,CAAD,IAAoC,CAAC;AAAA;AAAA,gCAAKR,GAAL,CAASO,KAAT,CAAe;AAAA;AAAA,0CAAUE,MAAzB,CAAzC,EACA;AACI,oBAAI,KAAKf,iBAAL,IAA0B,CAA9B,EACA;AACI,uBAAKA,iBAAL,IAA0B,CAA1B;AACA;AAAA;AAAA,oCAAKM,GAAL,CAASU,KAAT,CAAe,eAAf,EAAgC,IAAhC;AACH;AACJ;AACJ,aAVD,MAYA;AACI;AAAA;AAAA,gCAAKV,GAAL,CAASU,KAAT,CAAe,eAAf,EAAgC,IAAhC;AACH;;AAED;AACH;;AAED,cAAI;AAAA;AAAA,wCAAWK,QAAX,IAAuBF,IAA3B,EACA;AACI,gBAAIG,aAAa,GAAG,KAAKC,qBAAL,CAA2B;AAAA;AAAA,0CAAWL,YAAtC,CAApB;;AACA,gBAAII,aAAa,GAAG,CAAhB,IAAqB;AAAA;AAAA,sCAASE,OAAT,CAAiBF,aAAjB,CAAzB,EACA;AACI;AAAA;AAAA,4CAAWG,gBAAX,CAA4B;AAAA;AAAA,4CAAWJ,QAAX,GAAsBK,MAAM,CAACP,IAAD,CAAxD;;AACA,mBAAKxB,cAAL,CAAoBsB,IAApB,CAAyBK,aAAzB;;AACA;AAAA;AAAA,sCAAQK,kBAAR,CAA2BL,aAA3B;AACA;AAAA;AAAA,gCAAKM,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUC,cAArC;AACA;AAAA;AAAA,gCAAKF,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUE,cAArC;AACA;AAAA;AAAA,gCAAKH,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUG,eAArC;AACA;AAAA;AAAA,gCAAKJ,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUI,IAArC;AAEA,mBAAKlC,mBAAL,GAA2B,CAA3B;AACA,mBAAKC,iBAAL,GAAyB,CAAzB;AACH;AACJ;AACJ;;AAEMoB,QAAAA,gBAAgB,GAAU;AAC7B,cAAIE,aAAa,GAAG,KAAKC,qBAAL,CAA2B;AAAA;AAAA,wCAAWL,YAAtC,CAApB;;AACA,cAAII,aAAa,GAAG,CAApB,EACA;AACI,iBAAK3B,cAAL,CAAoBsB,IAApB,CAAyBK,aAAzB;;AACA,gBAAI;AAAA;AAAA,oCAAQY,YAAR,CAAqBZ,aAArB,CAAJ,EAAyC;AACrC,qBAAOa,IAAI,CAACC,KAAL,CAAW,KAAKzC,cAAL,CAAoB0C,KAApB,IAA2B,IAAE;AAAA;AAAA,sCAAQH,YAAR,CAAqBZ,aAArB,CAA7B,CAAX,CAAP;AACH,aAFD,MAIA;AACI,qBAAO,KAAK3B,cAAL,CAAoB0C,KAA3B;AACH;AACJ;;AACD,iBAAO,CAAP;AACH;;AAEMC,QAAAA,kBAAkB,GAAY;AACjC,cAAIC,eAAe,GAAG,CAAtB;AACA,cAAIC,SAAS,GAAG;AAAA;AAAA,oCAASC,GAAT,CAAa;AAAA;AAAA,4DAAqBC,SAAlC,CAAhB;;AACA,cAAIF,SAAJ,EAAe;AACX,iBAAK,IAAIG,EAAT,IAAeH,SAAf,EAA0B;AACtB,kBAAII,MAAM,CAACD,EAAD,CAAN,GAAaJ,eAAjB,EACA;AACIA,gBAAAA,eAAe,GAAGK,MAAM,CAACD,EAAD,CAAxB;AACH;AACJ;AACJ;;AACD,iBAAOJ,eAAP;AACH;;AAEMhB,QAAAA,qBAAqB,CAACsB,KAAD,EAA0B;AAClD,cAAIC,WAAW,GAAG,CAAlB;;AACA,eAAKpD,kBAAL,CAAwBuB,IAAxB,CAA6B4B,KAA7B;;AACA,cAAIE,SAAS,GAAG,KAAKrD,kBAAL,CAAwBqD,SAAxC;AACA,cAAIC,WAAW,GAAGD,SAAlB;AACA,cAAIE,iBAA4B,GAAG,EAAnC;AACA,cAAIC,eAAe,GAAG;AAAA;AAAA,oCAAST,GAAT,CAAa;AAAA;AAAA,oDAAiBC,SAA9B,CAAtB;;AACA,cAAIQ,eAAJ,EAAqB;AACjB,iBAAK,IAAIP,EAAT,IAAeO,eAAf,EAAgC;AAC5B,kBAAIC,WAAW,GAAGD,eAAe,CAACP,EAAD,CAAjC;;AACA,kBAAIQ,WAAW,CAACN,KAAZ,IAAqBG,WAAzB,EAAsC;AAClC,uBAAOJ,MAAM,CAACD,EAAD,CAAb;AACH;AACJ;AACJ;;AACD,iBAAO,CAAP;AACH;AAED;;;AACOS,QAAAA,MAAM,GAAG;AACZ,cAAI;AAAA;AAAA,wCAAWC,QAAX,IAAuB;AAAA;AAAA,4CAAaC,KAAxC,EACA;AACI;AACA;AAAA;AAAA,8BAAKhD,GAAL,CAASC,IAAT,CAAc;AAAA;AAAA,8BAAKgD,SAAnB;AACH,WAJD,MAKK,IAAI;AAAA;AAAA,wCAAWF,QAAX,IAAuB;AAAA;AAAA,4CAAaG,aAAxC,EACL;AACI;AAAA;AAAA,0CAAWH,QAAX,GAAsB;AAAA;AAAA,8CAAaI,cAAnC;AACA;AAAA;AAAA,8BAAKnD,GAAL,CAASU,KAAT,CAAe,YAAf,EAA6B,IAA7B;AACA;AAAA;AAAA,8BAAKY,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,wCAAU6B,aAArC;AACH,WALI,MAMA,IAAI;AAAA;AAAA,wCAAWL,QAAX,IAAuB;AAAA;AAAA,4CAAaI,cAAxC,EACL;AACI;AAAA;AAAA,0CAAWJ,QAAX,GAAsB;AAAA;AAAA,8CAAaG,aAAnC;AACA;AAAA;AAAA,8BAAKlD,GAAL,CAASU,KAAT,CAAe,YAAf,EAA6B,IAA7B;AACA;AAAA;AAAA,8BAAKY,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,wCAAU6B,aAArC;AACH;AACJ;;AAEMC,QAAAA,YAAY,GACnB;AACI;AACA,cAAI;AAAA;AAAA,wCAAWN,QAAX,IAAuB;AAAA;AAAA,4CAAaG,aAAxC,EACA;AACI;AAAA;AAAA,sCAASI,UAAT;AACA,gBAAI,KAAKhE,gBAAT,EACI;AACJ,gBAAI,KAAKE,cAAT,EACI;;AACJ,gBAAI,KAAK+D,aAAL,EAAJ,EACA;AACI1D,cAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH,aAHD,MAKA;AACI,kBAAI,KAAK0D,cAAL,EAAJ,EACA,CAEC,CAHD,MAKA;AACI;AACA,qBAAKpD,QAAL,CAAc,IAAd,EAFJ,CAGI;;AACA,qBAAKqD,aAAL;AACH;AACJ;AACJ;AACJ;;AAEMA,QAAAA,aAAa,GACpB;AACI,eAAKrE,kBAAL,CAAwBuB,IAAxB,CAA6B;AAAA;AAAA,wCAAWC,YAAxC;;AACA,cAAI,KAAKxB,kBAAL,CAAwBsE,aAAxB,GAAwC,CAA5C,EACA;AACI,iBAAK,IAAIC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG;AAAA;AAAA,sCAASC,KAAT,CAAeC,MAA3C,EAAmDF,KAAK,EAAxD,EAA4D;AACxD,oBAAMG,IAAI,GAAG;AAAA;AAAA,wCAASF,KAAT,CAAeD,KAAf,CAAb;;AACA,mBAAKtE,cAAL,CAAoBsB,IAApB,CAAyBmD,IAAI,CAACC,OAA9B;;AACA,kBAAI,KAAK1E,cAAL,CAAoBkD,KAApB,IAA6B,KAAKnD,kBAAL,CAAwBsE,aAAzD,EACA;AACI,qBAAKM,aAAL,CAAmBL,KAAnB;AACH;AACJ;AACJ;AACJ;;AAGMJ,QAAAA,aAAa,GACpB;AACI,eAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG;AAAA;AAAA,oCAASL,KAAT,CAAeC,MAAnC,EAA2CI,CAAC,EAA5C,EAAgD;AAC5C,iBAAK,IAAIC,CAAC,GAAGD,CAAC,GAAG,CAAjB,EAAoBC,CAAC,GAAG;AAAA;AAAA,sCAASN,KAAT,CAAeC,MAAvC,EAA+CK,CAAC,EAAhD,EAAoD;AAChD,kBAAI;AAAA;AAAA,wCAASN,KAAT,CAAeK,CAAf,EAAkBF,OAAlB,GAA4B,CAA5B,IAAiC;AAAA;AAAA,wCAASH,KAAT,CAAeK,CAAf,EAAkBF,OAAlB,KAA8B;AAAA;AAAA,wCAASH,KAAT,CAAeM,CAAf,EAAkBH,OAArF,EAA8F;AAC1F,oBAAII,WAAW,GAAG,KAAKC,mBAAL,CAAyB;AAAA;AAAA,0CAASR,KAAT,CAAeK,CAAf,EAAkBF,OAA3C,CAAlB;;AACA,oBAAII,WAAW,GAAG,CAAlB,EACA;AACI;AACA,uBAAK7E,gBAAL,GAAwB,IAAxB;AACA,sBAAI+E,MAAY,GAAG,EAAnB;AACAA,kBAAAA,MAAM,CAACC,QAAP,GAAkBL,CAAlB;AACAI,kBAAAA,MAAM,CAACE,SAAP,GAAmBL,CAAnB;AACA;AAAA;AAAA,oCAAK5C,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,8CAAUgC,aAArC,EAAoDc,MAApD;AACA,yBAAO,IAAP;AACH;AACJ;AACJ;AACJ;;AACD,iBAAO,KAAP;AACH;;AAEMb,QAAAA,cAAc,GACrB;AACI,eAAK,IAAIS,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG;AAAA;AAAA,oCAASL,KAAT,CAAeC,MAAnC,EAA2CI,CAAC,EAA5C,EAAgD;AAC5C,gBAAI;AAAA;AAAA,sCAASL,KAAT,CAAeK,CAAf,EAAkBO,MAAlB,IAA4B,CAAC;AAAA;AAAA,sCAASZ,KAAT,CAAeK,CAAf,EAAkBQ,YAAnD,EACA;AACI,mBAAKjF,cAAL,GAAsB,IAAtB;AACA;AAAA;AAAA,sCAAQkF,QAAR,CAAiBT,CAAjB;AACA,qBAAO,IAAP;AACH;AACJ;;AACD,iBAAO,KAAP;AACH;;AAEMU,QAAAA,aAAa,CAACC,QAAD,EAAkBC,SAAlB,EACpB;AACI,cAAI;AAAA;AAAA,oCAASjB,KAAT,IAAkB;AAAA;AAAA,oCAASA,KAAT,CAAegB,QAAf,CAAlB,IAA8C;AAAA;AAAA,oCAAShB,KAAT,CAAeiB,SAAf,CAAlD,EACA;AACI,gBAAIC,UAAU,GAAG;AAAA;AAAA,sCAASlB,KAAT,CAAegB,QAAf,EAAyBb,OAA1C;AACA,gBAAIgB,WAAW,GAAG;AAAA;AAAA,sCAASnB,KAAT,CAAeiB,SAAf,EAA0Bd,OAA5C;;AACA,gBAAIe,UAAU,GAAG,CAAb,IAAkBC,WAAW,GAAG,CAAhC,IAAqCD,UAAU,KAAKC,WAAxD,EACA;AACI,kBAAIZ,WAAW,GAAG,KAAKC,mBAAL,CAAyBU,UAAzB,CAAlB;;AACA,kBAAIX,WAAW,GAAG,CAAlB,EACA;AACI,sBAAMa,UAAU,GAAG;AAAA;AAAA,kCAAKhF,GAAL,CAASmC,GAAT,CAAa;AAAA;AAAA,kCAAK8C,MAAlB,CAAnB;;AACA,oBAAID,UAAJ,EACA;AACI,wBAAME,UAAU,GAAGF,UAAU,CAACG,YAAX;AAAA;AAAA,2DAAnB;;AACA,sBAAID,UAAJ,EACA;AACI,wBAAIE,QAAQ,GAAGF,UAAU,CAACG,WAAX,CAAuBR,SAAvB,CAAf;;AACA,wBAAIO,QAAJ,EACA;AACI,4BAAME,aAAa,GAAGF,QAAQ,CAACD,YAAT;AAAA;AAAA,yDAAtB;;AACA,0BAAIG,aAAJ,EACA;AACI,4BAAIC,WAAW,GAAGL,UAAU,CAACG,WAAX,CAAuBT,QAAvB,CAAlB;;AACA,4BAAIW,WAAJ,EACA;AACI,gCAAMC,gBAAgB,GAAGD,WAAW,CAACJ,YAAZ;AAAA;AAAA,6DAAzB;;AACA,8BAAIK,gBAAJ,EACA;AACIA,4BAAAA,gBAAgB,CAACC,WAAjB,CAA6BC,IAA7B,CAAkCC,MAAlC,GAA2C,KAA3C;AACH;AACJ;;AACD;AAAA;AAAA,gDAAQC,eAAR,CAAwB,EAAxB;AACA,6BAAKrG,oBAAL,GAA4B,IAA5B;AACA;AAAA;AAAA,gDAAQsG,gBAAR,CAAyB,mBAAzB,EAA8CP,aAAa,CAACG,WAAd,CAA0BC,IAAxE,EAA8E,IAA9E,EAAoF,KAApF,EAA2F,MAAM;AAC7F;AAAA;AAAA,kDAAQI,qBAAR,CAA8B3B,WAA9B;AAEA;AAAA;AAAA,oDAASP,KAAT,CAAegB,QAAf,EAAyBb,OAAzB,GAAmC,CAAnC;AACA;AAAA;AAAA,oDAASH,KAAT,CAAeiB,SAAf,EAA0Bd,OAA1B,GAAoCI,WAApC;AAEA;AAAA;AAAA,kDAAQyB,eAAR,CAAwB,EAAxB;AACA,+BAAKtG,gBAAL,GAAwB,KAAxB;AACA,+BAAKC,oBAAL,GAA4B,KAA5B,CAR6F,CAS7F;;AACA,+BAAKwG,aAAL,CAAmB5B,WAAnB;AACA;AAAA;AAAA,4CAAK7C,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,sDAAUC,cAArC;AACA;AAAA;AAAA,4CAAKF,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,sDAAUG,eAArC;AACA;AAAA;AAAA,4CAAKJ,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,sDAAUI,IAArC;AACH,yBAdD;AAeH;AACJ;AACJ;AACJ;AAGJ;AACJ;AACJ,WAxDL,CAyDI;;;AACA,iBAAO,KAAP;AACH,SA/SuB,CAgTxB;;;AACOoE,QAAAA,aAAa,CAAC5B,WAAD,EAAqB;AACrC,eAAK9E,cAAL,CAAoBsB,IAApB,CAAyBwD,WAAzB;;AACA;AAAA;AAAA,wCAAW6B,UAAX,GAAwB;AAAA;AAAA,wCAAWA,UAAX,GAAwB,KAAK3G,cAAL,CAAoB4G,MAApE,CAFqC,CAGrC;;AACA,eAAK7G,kBAAL,CAAwBuB,IAAxB,CAA6B;AAAA;AAAA,wCAAWC,YAAxC;;AACA,cAAI,KAAKxB,kBAAL,CAAwB8G,GAAxB,GAA8B,CAAlC,EACA;AACI,gBAAI;AAAA;AAAA,0CAAWF,UAAX,IAAyB,KAAK5G,kBAAL,CAAwB8G,GAArD,EACA;AAAC;AACG,kBAAIC,SAAS,GAAG;AAAA;AAAA,4CAAWvF,YAAX,GAA0B,CAA1C;;AACA,kBAAIuF,SAAS,IAAI,KAAKnE,kBAAL,EAAjB,EACA;AACI;AAAA;AAAA,8CAAWgE,UAAX,GAAwB;AAAA;AAAA,8CAAWA,UAAX,GAAwB,KAAK5G,kBAAL,CAAwB8G,GAAxE;AACA;AAAA;AAAA,8CAAWtF,YAAX,GAA0B;AAAA;AAAA,8CAAWA,YAAX,GAA0B,CAApD;AACA;AAAA;AAAA,wCAAQwF,gBAAR;AACA;AAAA;AAAA,kCAAK9E,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,4CAAUC,cAArC;AACA;AAAA;AAAA,kCAAKF,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,4CAAUI,IAArC;AACA,oBAAI0E,IAAI,GAAG;AAAA;AAAA,8CAAWC,YAAX,CAAwB;AAAA;AAAA,kCAAKC,QAAL,CAAcC,WAAd,CAA0B,YAA1B,CAAxB,EAAiE;AAAA;AAAA,8CAAW5F,YAA5E,CAAX;AACA;AAAA;AAAA,kCAAKZ,GAAL,CAASU,KAAT,CAAe2F,IAAf,EAAqB,IAArB;AAEH;AACJ;AACJ;AACJ;;AAEMjC,QAAAA,mBAAmB,CAACL,OAAD,EAA0B;AAChD,eAAK1E,cAAL,CAAoBsB,IAApB,CAAyBoD,OAAzB;;AACA,cAAI0C,YAAY,GAAG,KAAKpH,cAAL,CAAoBqH,IAAvC;AACA,cAAIC,cAAc,GAAG,KAAKtH,cAAL,CAAoBkD,KAApB,GAA0B,CAA/C;AAEA,cAAIK,eAAe,GAAG;AAAA;AAAA,oCAAST,GAAT,CAAa;AAAA;AAAA,oDAAiBC,SAA9B,CAAtB;;AACA,cAAIQ,eAAJ,EACA;AACI,iBAAK,IAAIP,EAAT,IAAeO,eAAf,EAAgC;AAC5B,kBAAIC,WAAW,GAAGD,eAAe,CAACP,EAAD,CAAjC;;AACA,kBAAIQ,WAAW,CAAC6D,IAAZ,IAAoBD,YAApB,IAAqC5D,WAAW,CAACN,KAAZ,IAAqBoE,cAA9D,EACA;AACI,uBAAOrE,MAAM,CAACD,EAAD,CAAb;AACH;AACJ;AACJ;;AACD,iBAAO,CAAP;AACH;;AAEM2B,QAAAA,aAAa,CAACL,KAAD,EAAe;AAC/B,cAAI;AAAA;AAAA,oCAASC,KAAT,IAAkB;AAAA;AAAA,oCAASA,KAAT,CAAeD,KAAf,CAAtB,EACA;AACI,gBAAIiD,OAAO,GAAG;AAAA;AAAA,sCAAShD,KAAT,CAAeD,KAAf,EAAsBI,OAApC;;AACA,gBAAI6C,OAAO,GAAG,CAAd,EACA;AACI,mBAAKvH,cAAL,CAAoBsB,IAApB,CAAyBiG,OAAzB;;AACA;AAAA;AAAA,wCAAShD,KAAT,CAAeD,KAAf,EAAsBI,OAAtB,GAAgC,CAAhC;AACA;AAAA;AAAA,4CAAW5C,gBAAX,CAA4B;AAAA;AAAA,4CAAWJ,QAAX,GAAsBK,MAAM,CAAC,KAAK/B,cAAL,CAAoBwH,QAArB,CAAxD;AACA;AAAA;AAAA,4CAAWC,mBAAX,GAAiC,KAAKzH,cAAL,CAAoBwH,QAArD;AAEA;AAAA;AAAA,sCAAQjB,eAAR,CAAwB,EAAxB;AAEA;AAAA;AAAA,gCAAKtE,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUC,cAArC;AACA;AAAA;AAAA,gCAAKF,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUE,cAArC;AACA;AAAA;AAAA,gCAAKH,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUG,eAArC;AACA;AAAA;AAAA,gCAAKJ,OAAL,CAAaC,aAAb,CAA2B;AAAA;AAAA,0CAAUI,IAArC;AACH;AACJ;AACJ;;AAhXuB,O;;4BAmXjBoF,U,GAAa,IAAI9I,cAAJ,E","sourcesContent":["import { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { LayerType } from \"../../../../extensions/oops-plugin-framework/assets/core/gui/layer/LayerManager\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { TableRestaurantlevel } from \"../../framework/common/table/TableRestaurantlevel\";\r\nimport { TableIngredients } from \"../../framework/common/table/TableIngredients\";\r\nimport { TonGameMgr, AutoTypeEnum } from \"../manager/TonGameManager\";\r\nimport { StringUtil } from '../../../../extensions/oops-plugin-framework/assets/core/utils/StringUtil';\r\nimport { LiWuMgr } from \"../liwu/LiWuManager\";\r\nimport { HeChengComponent } from \"./HeChengComponent\";\r\nimport { GridComponent } from \"./GridComponent\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\nimport { BoardMgr } from \"../manager/BoardManager\";\r\nimport { JsonUtil } from \"../../../../extensions/oops-plugin-framework/assets/core/utils/JsonUtil\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { CarrotMgr } from \"../pullingcarrots/CarrotManager\";\r\nimport { FeedMgr } from \"../feed/FeedManager\";\r\nimport { GuideMgr } from \"../hecheng/GuideManager\";\r\n\r\nexport class HeChengManager {\r\n    private _tsRestaurantlevel = new TableRestaurantlevel();\r\n    private _tsIngredients = new TableIngredients();\r\n\r\n    public IsAutoHechenging : boolean = false;\r\n    public IsPlayHechengingAnim : boolean = false;\r\n    public IsAutoOpenLiwu : boolean = false;\r\n    private GridIsFullTipsTimes: number = 0;\r\n    private TuZiCoinTipsTimes: number = 0;\r\n\r\n    public IsDraging : boolean = false;\r\n\r\n    /** 回收 */\r\n    public onHuiShou() {\r\n        console.log(\"onHuiShou\");\r\n    }\r\n\r\n    /** 打开拔萝卜界面 */\r\n    public onGotoCarrots() {\r\n        oops.gui.open(UIID.CarrotMain);\r\n        CarrotMgr.SendOpenPanel();\r\n        // ShopMgr.SendAddCarrotCoin(1000000);\r\n    }\r\n\r\n    /** 采购 */\r\n    public onCaiGou(isAuto:boolean) {\r\n        if (!BoardMgr.isHasEmptyGrid())\r\n        {\r\n            //已经放不下更多食材啦，快去合成吧！\r\n            if (isAuto)\r\n            {\r\n                if (!oops.gui.hasUI(LayerType.PopUp) && !oops.gui.hasUI(LayerType.Dialog))\r\n                {\r\n                    if (this.GridIsFullTipsTimes == 0)\r\n                    {\r\n                        this.GridIsFullTipsTimes += 1;\r\n                        oops.gui.toast(\"stringres_002\", true);\r\n                    }\r\n                    \r\n                }\r\n            }\r\n            else\r\n            {\r\n                oops.gui.toast(\"stringres_002\", true);\r\n            }\r\n\r\n            return;\r\n        }\r\n        this._tsRestaurantlevel.init(TonGameMgr.CanTingLevel);\r\n        let Cost = this.GetMakeSucaiCost();\r\n        if (TonGameMgr.TuZiCoin < this.GetMakeSucaiCost())\r\n        {\r\n            //兔子币不足，无法采购\r\n            if (isAuto)\r\n            {\r\n                if (!oops.gui.hasUI(LayerType.PopUp) && !oops.gui.hasUI(LayerType.Dialog))\r\n                {\r\n                    if (this.TuZiCoinTipsTimes == 0)\r\n                    {\r\n                        this.TuZiCoinTipsTimes += 1;\r\n                        oops.gui.toast(\"stringres_003\", true);\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                oops.gui.toast(\"stringres_003\", true);\r\n            }\r\n            \r\n            return;\r\n        }\r\n        \r\n        if (TonGameMgr.TuZiCoin >= Cost)\r\n        {\r\n            let IngredientsId = this.GetSucaiIdByCanTingLv(TonGameMgr.CanTingLevel);\r\n            if (IngredientsId > 0 && BoardMgr.addGrid(IngredientsId))\r\n            {\r\n                TonGameMgr.updateRabbitCoin(TonGameMgr.TuZiCoin - BigInt(Cost));\r\n                this._tsIngredients.init(IngredientsId);\r\n                FeedMgr.UpdateExtDishPrice(IngredientsId);\r\n                oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                oops.message.dispatchEvent(GameEvent.UpdateTuziCoin);\r\n                oops.message.dispatchEvent(GameEvent.UpdateBoardGrid);\r\n                oops.message.dispatchEvent(GameEvent.Save);\r\n\r\n                this.GridIsFullTipsTimes = 0;\r\n                this.TuZiCoinTipsTimes = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    public GetMakeSucaiCost():number {\r\n        let IngredientsId = this.GetSucaiIdByCanTingLv(TonGameMgr.CanTingLevel);\r\n        if (IngredientsId > 0)\r\n        {\r\n            this._tsIngredients.init(IngredientsId);\r\n            if (FeedMgr.ExtDishPrice[IngredientsId]) {\r\n                return Math.floor(this._tsIngredients.cost1*(1+FeedMgr.ExtDishPrice[IngredientsId]));\r\n            }\r\n            else\r\n            {\r\n                return this._tsIngredients.cost1;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public GetMaxCantingLevel() : number {\r\n        let MaxCantingLevel = 1;\r\n        let jsonTabel = JsonUtil.get(TableRestaurantlevel.TableName);\r\n        if (jsonTabel) {\r\n            for (let id in jsonTabel) {\r\n                if (Number(id) > MaxCantingLevel)\r\n                {\r\n                    MaxCantingLevel = Number(id);\r\n                }\r\n            }\r\n        }\r\n        return MaxCantingLevel;\r\n    }\r\n\r\n    public GetSucaiIdByCanTingLv(level : number) : number {\r\n        let resultIndex = 0;\r\n        this._tsRestaurantlevel.init(level);\r\n        let foodlevel = this._tsRestaurantlevel.foodlevel;\r\n        let resultLevel = foodlevel;\r\n        let resultIngredients : number[] = [];\r\n        let jsonIngredients = JsonUtil.get(TableIngredients.TableName);\r\n        if (jsonIngredients) {\r\n            for (let id in jsonIngredients) {\r\n                let Ingredients = jsonIngredients[id];\r\n                if (Ingredients.level == resultLevel) {\r\n                    return Number(id);\r\n                }\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /** 自动 */\r\n    public onAuto() {\r\n        if (TonGameMgr.AutoType == AutoTypeEnum.NoBuy)\r\n        {\r\n            //打开购买界面\r\n            oops.gui.open(UIID.BuyAutoUI);\r\n        }\r\n        else if (TonGameMgr.AutoType == AutoTypeEnum.HasBuyAndOpen)\r\n        {\r\n            TonGameMgr.AutoType = AutoTypeEnum.HasBuyButClose;\r\n            oops.gui.toast(\"message_25\", true);\r\n            oops.message.dispatchEvent(GameEvent.UpdateAutoBtn);\r\n        }\r\n        else if (TonGameMgr.AutoType == AutoTypeEnum.HasBuyButClose)\r\n        {\r\n            TonGameMgr.AutoType = AutoTypeEnum.HasBuyAndOpen;\r\n            oops.gui.toast(\"message_24\", true);\r\n            oops.message.dispatchEvent(GameEvent.UpdateAutoBtn);\r\n        }\r\n    }\r\n\r\n    public OnHandleAuto()\r\n    {\r\n        //处理自动\r\n        if (TonGameMgr.AutoType == AutoTypeEnum.HasBuyAndOpen)\r\n        {\r\n            GuideMgr.ResetGuide();\r\n            if (this.IsAutoHechenging)\r\n                return;\r\n            if (this.IsAutoOpenLiwu)\r\n                return;\r\n            if (this.OnAutoHecheng())\r\n            {\r\n                console.log(\"OnAutoHecheng\");\r\n            }\r\n            else\r\n            {\r\n                if (this.OnAutoOpenLiwu())\r\n                {\r\n\r\n                }\r\n                else\r\n                {\r\n                    //自动采购\r\n                    this.onCaiGou(true);\r\n                    //自动回收\r\n                    this.OnAutoHuiShou();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public OnAutoHuiShou()\r\n    {\r\n        this._tsRestaurantlevel.init(TonGameMgr.CanTingLevel);\r\n        if (this._tsRestaurantlevel.recoverylevel > 0)\r\n        {\r\n            for (let index = 0; index < BoardMgr.board.length; index++) {\r\n                const cell = BoardMgr.board[index];\r\n                this._tsIngredients.init(cell.SuCaiId);\r\n                if (this._tsIngredients.level <= this._tsRestaurantlevel.recoverylevel)\r\n                {\r\n                    this.HandleHuiShou(index);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n    public OnAutoHecheng() : boolean\r\n    {\r\n        for (let i = 0; i < BoardMgr.board.length; i++) {\r\n            for (let j = i + 1; j < BoardMgr.board.length; j++) {\r\n                if (BoardMgr.board[i].SuCaiId > 0 && BoardMgr.board[i].SuCaiId === BoardMgr.board[j].SuCaiId) {\r\n                    let NextSuCaiId = this.GetNextLevelSuCaiId(BoardMgr.board[i].SuCaiId);\r\n                    if (NextSuCaiId > 0)\r\n                    {\r\n                        //找到可以合成的素材了\r\n                        this.IsAutoHechenging = true;\r\n                        let params : any = {};\r\n                        params.SrcIndex = i;\r\n                        params.DestIndex = j;\r\n                        oops.message.dispatchEvent(GameEvent.OnAutoHecheng, params);\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public OnAutoOpenLiwu() : boolean\r\n    {\r\n        for (let i = 0; i < BoardMgr.board.length; i++) {\r\n            if (BoardMgr.board[i].IsLiWu && !BoardMgr.board[i].IsLiWuFlying)\r\n            {\r\n                this.IsAutoOpenLiwu = true;\r\n                LiWuMgr.openLiwu(i);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public HandleHecheng(srcIndex:number, destIndex:number) :boolean\r\n    {\r\n        if (BoardMgr.board && BoardMgr.board[srcIndex] && BoardMgr.board[destIndex])\r\n        {\r\n            let srcSuCaiId = BoardMgr.board[srcIndex].SuCaiId;\r\n            let destSuCaiId = BoardMgr.board[destIndex].SuCaiId;\r\n            if (srcSuCaiId > 0 && destSuCaiId > 0 && srcSuCaiId === destSuCaiId)\r\n            {\r\n                let NextSuCaiId = this.GetNextLevelSuCaiId(srcSuCaiId);\r\n                if (NextSuCaiId > 0)\r\n                {\r\n                    const HechengGUI = oops.gui.get(UIID.MainUI);\r\n                    if (HechengGUI) \r\n                    {\r\n                        const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n                        if (HechengCom) \r\n                        {\r\n                            let gridNode = HechengCom.getGridNode(destIndex);\r\n                            if (gridNode)\r\n                            {\r\n                                const gridComponent = gridNode.getComponent(GridComponent);\r\n                                if (gridComponent) \r\n                                {\r\n                                    let srcGridNode = HechengCom.getGridNode(srcIndex);\r\n                                    if (srcGridNode)\r\n                                    {\r\n                                        const srcGridComponent = srcGridNode.getComponent(GridComponent);\r\n                                        if (srcGridComponent) \r\n                                        {\r\n                                            srcGridComponent.SuCaiSprite.node.active = false;\r\n                                        }\r\n                                    }\r\n                                    UtilMgr.PlaySoundEffect(29);\r\n                                    this.IsPlayHechengingAnim = true;\r\n                                    UtilMgr.addNodeAnimation(\"animation/hecheng\", gridComponent.SuCaiSprite.node, true, false, () => {\r\n                                        FeedMgr.UpdateHechengMaxLevel(NextSuCaiId);\r\n                \r\n                                        BoardMgr.board[srcIndex].SuCaiId = 0;\r\n                                        BoardMgr.board[destIndex].SuCaiId = NextSuCaiId;\r\n                    \r\n                                        UtilMgr.PlaySoundEffect(16);\r\n                                        this.IsAutoHechenging = false;\r\n                                        this.IsPlayHechengingAnim = false;\r\n                                        //合成加餐厅经验\r\n                                        this.AddCanTingExp(NextSuCaiId);\r\n                                        oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                                        oops.message.dispatchEvent(GameEvent.UpdateBoardGrid);\r\n                                        oops.message.dispatchEvent(GameEvent.Save);\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n\r\n                }\r\n            }\r\n        }\r\n        //处理合成\r\n        return false;\r\n    }\r\n    //增加餐厅经验\r\n    public AddCanTingExp(NextSuCaiId:number) {\r\n        this._tsIngredients.init(NextSuCaiId);\r\n        TonGameMgr.CanTingExp = TonGameMgr.CanTingExp + this._tsIngredients.getexp;\r\n        //判断是否升级\r\n        this._tsRestaurantlevel.init(TonGameMgr.CanTingLevel);\r\n        if (this._tsRestaurantlevel.exp > 0)\r\n        {\r\n            if (TonGameMgr.CanTingExp >= this._tsRestaurantlevel.exp)\r\n            {//餐厅可以升级了\r\n                let nextLevel = TonGameMgr.CanTingLevel + 1;\r\n                if (nextLevel <= this.GetMaxCantingLevel())\r\n                {\r\n                    TonGameMgr.CanTingExp = TonGameMgr.CanTingExp - this._tsRestaurantlevel.exp;\r\n                    TonGameMgr.CanTingLevel = TonGameMgr.CanTingLevel + 1;\r\n                    FeedMgr.updateFreeDishId();\r\n                    oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                    oops.message.dispatchEvent(GameEvent.Save);\r\n                    let tips = StringUtil.substitute_1(oops.language.getLangByID(\"message_27\"), TonGameMgr.CanTingLevel);\r\n                    oops.gui.toast(tips, true);\r\n\r\n                }      \r\n            }\r\n        }\r\n    }\r\n\r\n    public GetNextLevelSuCaiId(SuCaiId:number) : number {\r\n        this._tsIngredients.init(SuCaiId);\r\n        let curSuCaiType = this._tsIngredients.type;\r\n        let nextSuCaiLevel = this._tsIngredients.level+1;\r\n\r\n        let jsonIngredients = JsonUtil.get(TableIngredients.TableName);\r\n        if (jsonIngredients) \r\n        {\r\n            for (let id in jsonIngredients) {\r\n                let Ingredients = jsonIngredients[id];\r\n                if (Ingredients.type == curSuCaiType &&  Ingredients.level == nextSuCaiLevel) \r\n                {\r\n                    return Number(id);\r\n                }\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public HandleHuiShou(index:number) {\r\n        if (BoardMgr.board && BoardMgr.board[index])\r\n        {\r\n            let suCaiId = BoardMgr.board[index].SuCaiId;\r\n            if (suCaiId > 0)\r\n            {\r\n                this._tsIngredients.init(suCaiId);\r\n                BoardMgr.board[index].SuCaiId = 0;\r\n                TonGameMgr.updateRabbitCoin(TonGameMgr.TuZiCoin + BigInt(this._tsIngredients.recovery));\r\n                TonGameMgr.LastRecoverTuziCoin = this._tsIngredients.recovery;\r\n\r\n                UtilMgr.PlaySoundEffect(30);\r\n\r\n                oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                oops.message.dispatchEvent(GameEvent.UpdateTuziCoin);\r\n                oops.message.dispatchEvent(GameEvent.UpdateBoardGrid);\r\n                oops.message.dispatchEvent(GameEvent.Save);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport var HeChengMgr = new HeChengManager();"]}