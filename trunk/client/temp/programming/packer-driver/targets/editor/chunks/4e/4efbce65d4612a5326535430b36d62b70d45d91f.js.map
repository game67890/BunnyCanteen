{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/pullingcarrots/CarrotManager.ts"],"names":["RewardListData","CarrotManager","JsonUtil","ProtocolMgr","TableRadishAwardRank","UIID","oops","GameEvent","TonGameMgr","TableOtherParameter","time","config","speed","CurrentCarrotRank","CurrentCarrotWeight","LeftTimes","IsJumpAnim","CarrotRewardList","getCarrotRewardValueByID","Id","jsonTable","get","TableName","record","data","SendOpenPanel","completecpanel","ret","console","log","res","isSucc","idx","weight","message","dispatchEvent","OnMyRankChange","userID","UserId","param","JSON","stringify","sendopenluobopanel","SendBaLuoBo","times","completeCBaLuoBo","list","i","length","item","confId","GetRealCanTingGain","updateRabbitCoin","TuZiCoin","BigInt","Number","push","tablerecord","init","updateCarrotCoin","CarrotCoin","parameter","gui","open","CarrotReward","UpdateBaseData","UpdateTuziCoin","toString","sendcbaluobo","SendOpenRankPanel","completeCRankPanel","paramas","rankitemlist","CarrotRank","sendcrankpanel","CarrotMgr"],"mappings":"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","sourcesContent":["import { JsonUtil } from \"../../../../extensions/oops-plugin-framework/assets/core/utils/JsonUtil\";\r\nimport { HttpReturn } from \"../../../../extensions/oops-plugin-framework/assets/libs/network/HttpRequest\";\r\nimport { ProtocolMgr } from \"../manager/ProtocolManager\";\r\nimport { TableRadishAwardRank } from \"../../framework/common/table/TableRadishAwardRank\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { TonGameMgr } from \"../manager/TonGameManager\";\r\nimport { TableOtherParameter } from \"../../framework/common/table/TableOtherParameter\";\r\n\r\nclass RewardListData {\r\n    time: number = 0;\r\n    config: number = 0;\r\n    speed:number = 0;\r\n}\r\n\r\nexport class CarrotManager {\r\n    /** 拔萝卜的当前排名 */\r\n    public CurrentCarrotRank : number = 0;\r\n    /** 拔萝卜的总重量 */\r\n    public CurrentCarrotWeight : number = 0;\r\n    /** 剩余拔萝卜的次数 */\r\n    public LeftTimes : number = 0;\r\n    /** 是否跳过拔萝卜动画 */\r\n    public IsJumpAnim : boolean = false;\r\n    /** 收到的奖励列表 */\r\n    public CarrotRewardList: any[] = [];\r\n\r\n    public getCarrotRewardValueByID(Id: string): number {\r\n        let jsonTable = JsonUtil.get(TableRadishAwardRank.TableName);\r\n        if (jsonTable) \r\n        {\r\n            const record = jsonTable[Id];\r\n            if (record) {\r\n                return record.data;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public SendOpenPanel() {\r\n        var completecpanel = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n            if (ret && ret.isSucc) {\r\n                this.CurrentCarrotRank = ret.res.idx;\r\n                this.CurrentCarrotWeight = ret.res.weight;\r\n                oops.message.dispatchEvent(GameEvent.OnMyRankChange);\r\n            }\r\n        }\r\n    \r\n        const data: { [key: string]: any } = {};\r\n        data.userID = TonGameMgr.UserId;\r\n        // data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n    \r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendopenluobopanel(completecpanel, param);\r\n    }\r\n\r\n    public SendBaLuoBo(times:number) {\r\n        var completeCBaLuoBo = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n            if (ret.isSucc && ret.res && ret.res.list)\r\n            {\r\n                console.log(\"SendBaLuoBo-------- : \", ret.res);\r\n                for (let i=0; i<ret.res.list.length; i++) {\r\n                    const item: RewardListData = {\r\n                        time: ret.res.list[i].time,\r\n                        config: ret.res.list[i].confId,\r\n                        speed: TonGameMgr.GetRealCanTingGain(),\r\n                    }\r\n                    TonGameMgr.updateRabbitCoin(TonGameMgr.TuZiCoin + BigInt(TonGameMgr.GetRealCanTingGain()*Number(ret.res.list[i].time)*60));                \r\n                    this.CarrotRewardList.push(item);\r\n                }\r\n\r\n                this.CurrentCarrotRank = ret.res.idx;\r\n                this.CurrentCarrotWeight = ret.res.weight;\r\n                oops.message.dispatchEvent(GameEvent.OnMyRankChange);\r\n                \r\n                let tablerecord = new TableOtherParameter();\r\n                tablerecord.init(1);\r\n                TonGameMgr.updateCarrotCoin(TonGameMgr.CarrotCoin - Number(tablerecord.parameter)*ret.res.list.length);\r\n                oops.gui.open(UIID.CarrotReward);\r\n                oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                oops.message.dispatchEvent(GameEvent.UpdateTuziCoin);\r\n            }\r\n        }\r\n    \r\n        const data: { [key: string]: any } = {};\r\n        data.times = times.toString();\r\n        data.userID = TonGameMgr.UserId;\r\n        // data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n    \r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendcbaluobo(completeCBaLuoBo, param);\r\n    }\r\n\r\n    public SendOpenRankPanel() {\r\n        var completeCRankPanel = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n            if (ret.isSucc && ret.res && ret.res.list)\r\n            {\r\n                console.log(\"SendOpenRankPanel-------- : \", ret.res);\r\n                let paramas: any = {};\r\n                if (ret.res.list.length > 0) {\r\n                    paramas.rankitemlist = ret.res.list;\r\n                }\r\n                oops.gui.open(UIID.CarrotRank, paramas);\r\n            }\r\n        }\r\n    \r\n        const data: { [key: string]: any } = {};\r\n        data.userID = TonGameMgr.UserId;\r\n        // data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n    \r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendcrankpanel(completeCRankPanel, param);\r\n    }\r\n}\r\n\r\nexport var CarrotMgr = new CarrotManager();\r\n"]}