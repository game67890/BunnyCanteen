{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/core/gui/layer/LayerManager.ts"],"names":["LayerManager","Camera","Layers","Node","warn","Widget","Prefab","GUI","DelegateComponent","LayerDialog","LayerNotify","LayerPopUp","LayerUI","oops","TableSoundEffects","LayerType","portrait","root","getComponent","init","configs","setOpenFailure","callback","ui","onOpenFailure","popup","dialog","system","toast","content","useI18n","tablerecord","audio","playEffect","soundpath","volume","newContent","language","getLangByID","notify","waitOpen","waitClose","setConfig","uiId","config","open","uiArgs","callbacks","layer","UI","add","PopUp","Dialog","System","preLoad","res","preLoadAsync","defaultBundleName","prefab","loadAsync","openAsync","Promise","resolve","reject","onAdded","node","params","onLoadFailure","replace","removeUiId","openUiId","remove","replaceAsync","has","result","get","isDestroy","removeByNode","comp","vp","parent","removeCache","destroy","clear","constructor","camera","game","guide","getComponentInChildren","create_node","Game","Notify","Guide","addChild","name","Enum","UI_2D","w","addComponent","isAlignLeft","isAlignRight","isAlignTop","isAlignBottom","left","right","top","bottom","alignMode","enabled","hasUI","type"],"mappings":"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","sourcesContent":["import { Camera, Layers, Node, warn, Widget,Prefab } from \"cc\";\r\nimport { GUI } from \"../GUI\";\r\nimport { UICallbacks } from \"./Defines\";\r\nimport { DelegateComponent } from \"./DelegateComponent\";\r\nimport { LayerDialog } from \"./LayerDialog\";\r\nimport { LayerNotify } from \"./LayerNotify\";\r\nimport { LayerPopUp } from \"./LayerPopup\";\r\nimport { LayerUI } from \"./LayerUI\";\r\nimport { oops } from \"../../Oops\";\r\nimport { TableSoundEffects } from \"../../../../../../assets/scripts/framework/common/table/TableSoundEffects\";\r\nimport { table } from \"console\";\r\n\r\n/** 界面层类型 */\r\nexport enum LayerType {\r\n    /** 二维游戏层 */\r\n    Game = \"LayerGame\",\r\n    /** 主界面层 */\r\n    UI = \"LayerUI\",\r\n    /** 弹窗层 */\r\n    PopUp = \"LayerPopUp\",\r\n    /** 模式窗口层 */\r\n    Dialog = \"LayerDialog\",\r\n    /** 系统触发模式窗口层 */\r\n    System = \"LayerSystem\",\r\n    /** 滚动消息提示层 */\r\n    Notify = \"LayerNotify\",\r\n    /** 新手引导层 */\r\n    Guide = \"LayerGuide\"\r\n}\r\n\r\n/** \r\n * 界面配置结构体\r\n * @example\r\n// 界面唯一标识\r\nexport enum UIID {\r\n    Loading = 1,\r\n    Window,\r\n    Netinstable\r\n}\r\n\r\n// 打开界面方式的配置数据\r\nexport var UIConfigData: { [key: number]: UIConfig } = {\r\n    [UIID.Loading]: { layer: LayerType.UI, prefab: \"loading/prefab/loading\", bundle: \"resources\" },\r\n    [UIID.Netinstable]: { layer: LayerType.PopUp, prefab: \"common/prefab/netinstable\" },\r\n    [UIID.Window]: { layer: LayerType.Dialog, prefab: \"common/prefab/window\" }\r\n}\r\n */\r\nexport interface UIConfig {\r\n    /** -----公共属性----- */\r\n    /** 远程包名 */\r\n    bundle?: string;\r\n    /** 窗口层级 */\r\n    layer: LayerType;\r\n    /** 预制资源相对路径 */\r\n    prefab: string;\r\n    /** 是否自动施放（默认不自动释放） */\r\n    destroy?: boolean;\r\n\r\n    /** -----弹窗属性----- */\r\n    /** 是否触摸非窗口区域关闭（默认关闭） */\r\n    vacancy?: boolean,\r\n    /** 是否打开窗口后显示背景遮罩（默认关闭） */\r\n    mask?: boolean;\r\n}\r\n\r\n/** 界面层级管理器 */\r\nexport class LayerManager {\r\n    /** 界面根节点 */\r\n    root!: Node;\r\n    /** 界面摄像机 */\r\n    camera!: Camera;\r\n    /** 游戏界面特效层 */\r\n    game!: Node;\r\n    /** 新手引导层 */\r\n    guide!: Node;\r\n\r\n    /** 界面层 */\r\n    private readonly ui!: LayerUI;\r\n    /** 弹窗层 */\r\n    private readonly popup!: LayerPopUp;\r\n    /** 只能弹出一个的弹窗 */\r\n    private readonly dialog!: LayerDialog;\r\n    /** 游戏系统提示弹窗  */\r\n    private readonly system!: LayerDialog;\r\n    /** 消息提示控制器，请使用show方法来显示 */\r\n    private readonly notify!: LayerNotify;\r\n    /** UI配置 */\r\n    private configs: { [key: number]: UIConfig } = {};\r\n\r\n    /** 是否为竖屏显示 */\r\n    get portrait() {\r\n        return this.root.getComponent(GUI)!.portrait;\r\n    }\r\n\r\n    /**\r\n     * 初始化所有UI的配置对象\r\n     * @param configs 配置对象\r\n     */\r\n    init(configs: { [key: number]: UIConfig }): void {\r\n        this.configs = configs;\r\n    }\r\n\r\n    /**\r\n     * 设置窗口打开失败回调\r\n     * @param callback  回调方法\r\n     */\r\n    setOpenFailure(callback: Function) {\r\n        this.ui.onOpenFailure = this.popup.onOpenFailure = this.dialog.onOpenFailure = this.system.onOpenFailure = callback;\r\n    }\r\n\r\n    /**\r\n     * 渐隐飘过提示\r\n     * @param content 文本表示\r\n     * @param useI18n 是否使用多语言\r\n     * @example \r\n     * oops.gui.toast(\"提示内容\");\r\n     */\r\n    toast(content: string, useI18n: boolean = false) {\r\n        let tablerecord = new TableSoundEffects()\r\n        tablerecord.init(26);\r\n        oops.audio.playEffect(tablerecord.soundpath, tablerecord.volume);\r\n        let newContent = oops.language.getLangByID(content);\r\n        this.notify.toast(newContent, useI18n)\r\n    }\r\n\r\n    /** 打开等待提示 */\r\n    waitOpen() {\r\n        this.notify.waitOpen();\r\n    }\r\n\r\n    /** 关闭等待提示 */\r\n    waitClose() {\r\n        this.notify.waitClose();\r\n    }\r\n\r\n    /**\r\n     * 设置界面配置\r\n     * @param uiId   要设置的界面id\r\n     * @param config 要设置的配置\r\n     */\r\n    setConfig(uiId: number, config: UIConfig): void {\r\n        this.configs[uiId] = config;\r\n    }\r\n\r\n    /**\r\n     * 同步打开一个窗口\r\n     * @param uiId          窗口唯一编号\r\n     * @param uiArgs        窗口参数\r\n     * @param callbacks     回调对象\r\n     * @example\r\n    var uic: UICallbacks = {\r\n        onAdded: (node: Node, params: any) => {\r\n            var comp = node.getComponent(LoadingViewComp) as ecs.Comp;\r\n        }\r\n        onRemoved:(node: Node | null, params: any) => {\r\n                    \r\n        }\r\n    };\r\n    oops.gui.open(UIID.Loading, null, uic);\r\n     */\r\n    open(uiId: number, uiArgs: any = null, callbacks?: UICallbacks): void {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`打开编号为【${uiId}】的界面失败，配置信息不存在`);\r\n            return;\r\n        }\r\n\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                this.ui.add(config, uiArgs, callbacks);\r\n                break;\r\n            case LayerType.PopUp:\r\n                this.popup.add(config, uiArgs, callbacks);\r\n                break;\r\n            case LayerType.Dialog:\r\n                this.dialog.add(config, uiArgs, callbacks);\r\n                break;\r\n            case LayerType.System:\r\n                this.system.add(config, uiArgs, callbacks);\r\n                break;\r\n        }\r\n    }\r\n\r\n    preLoad(uiId: number): void {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`打开编号为【${uiId}】的界面失败，配置信息不存在`);\r\n            return;\r\n        }\r\n\r\n        oops.res.preLoadAsync(oops.res.defaultBundleName, config.prefab, Prefab);\r\n        oops.res.loadAsync(oops.res.defaultBundleName, config.prefab, Prefab);\r\n    }\r\n\r\n    /**\r\n     * 异步打开一个窗口\r\n     * @param uiId          窗口唯一编号\r\n     * @param uiArgs        窗口参数\r\n     * @example \r\n     * var node = await oops.gui.openAsync(UIID.Loading);\r\n     */\r\n    async openAsync(uiId: number, uiArgs: any = null): Promise<Node | null> {\r\n        return new Promise<Node | null>((resolve, reject) => {\r\n            const callbacks: UICallbacks = {\r\n                onAdded: (node: Node, params: any) => {\r\n                    resolve(node);\r\n                },\r\n                onLoadFailure: () => {\r\n                    resolve(null);\r\n                }\r\n            };\r\n            this.open(uiId, uiArgs, callbacks);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 场景替换\r\n     * @param removeUiId  移除场景编号\r\n     * @param openUiId    新打开场景编号\r\n     * @param uiArgs      新打开场景参数\r\n     */\r\n    replace(removeUiId: number, openUiId: number, uiArgs: any = null) {\r\n        this.open(openUiId, uiArgs);\r\n        this.remove(removeUiId);\r\n    }\r\n\r\n    /**\r\n     * 异步场景替换\r\n     * @param removeUiId  移除场景编号\r\n     * @param openUiId    新打开场景编号\r\n     * @param uiArgs      新打开场景参数\r\n     */\r\n    replaceAsync(removeUiId: number, openUiId: number, uiArgs: any = null): Promise<Node | null> {\r\n        return new Promise<Node | null>(async (resolve, reject) => {\r\n            const node = await this.openAsync(openUiId, uiArgs);\r\n            if (node) {\r\n                this.remove(removeUiId);\r\n                resolve(node);\r\n            }\r\n            else {\r\n                resolve(null);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 缓存中是否存在指定标识的窗口\r\n     * @param uiId 窗口唯一标识\r\n     * @example\r\n     * oops.gui.has(UIID.Loading);\r\n     */\r\n    has(uiId: number): boolean {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`编号为【${uiId}】的界面配置不存在，配置信息不存在`);\r\n            return false;\r\n        }\r\n\r\n        var result = false;\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                result = this.ui.has(config.prefab);\r\n                break;\r\n            case LayerType.PopUp:\r\n                result = this.popup.has(config.prefab);\r\n                break;\r\n            case LayerType.Dialog:\r\n                result = this.dialog.has(config.prefab);\r\n                break;\r\n            case LayerType.System:\r\n                result = this.system.has(config.prefab);\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 缓存中是否存在指定标识的窗口\r\n     * @param uiId 窗口唯一标识\r\n     * @example\r\n     * oops.gui.has(UIID.Loading);\r\n     */\r\n    get(uiId: number): Node {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`编号为【${uiId}】的界面配置不存在，配置信息不存在`);\r\n            return null!;\r\n        }\r\n\r\n        let result: Node = null!;\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                result = this.ui.get(config.prefab);\r\n                break;\r\n            case LayerType.PopUp:\r\n                result = this.popup.get(config.prefab);\r\n                break;\r\n            case LayerType.Dialog:\r\n                result = this.dialog.get(config.prefab);\r\n                break;\r\n            case LayerType.System:\r\n                result = this.system.get(config.prefab);\r\n                break;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 移除指定标识的窗口\r\n     * @param uiId         窗口唯一标识\r\n     * @param isDestroy    移除后是否释放\r\n     * @example\r\n     * oops.gui.remove(UIID.Loading);\r\n     */\r\n    remove(uiId: number, isDestroy: boolean = false) {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`删除编号为【${uiId}】的界面失败，配置信息不存在`);\r\n            return;\r\n        }\r\n\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                this.ui.remove(config.prefab, isDestroy);\r\n                break;\r\n            case LayerType.PopUp:\r\n                this.popup.remove(config.prefab, isDestroy);\r\n                break;\r\n            case LayerType.Dialog:\r\n                this.dialog.remove(config.prefab, isDestroy);\r\n                break;\r\n            case LayerType.System:\r\n                this.system.remove(config.prefab, isDestroy);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除一个通过this框架添加进来的节点\r\n     * @param node          窗口节点\r\n     * @param isDestroy     移除后是否释放资源\r\n     * @example\r\n     * oops.gui.removeByNode(cc.Node);\r\n     */\r\n    removeByNode(node: Node, isDestroy?: boolean) {\r\n        if (node instanceof Node) {\r\n            let comp = node.getComponent(DelegateComponent);\r\n            if (comp && comp.vp) {\r\n                // 释放显示的界面\r\n                if (node.parent) {\r\n                    (node.parent as LayerUI).remove(comp.vp.config.prefab, isDestroy);\r\n                }\r\n                // 释放缓存中的界面\r\n                else if (isDestroy) {\r\n                    switch (comp.vp.config.layer) {\r\n                        case LayerType.UI:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.ui.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                        case LayerType.PopUp:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.popup.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                        case LayerType.Dialog:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.dialog.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                        case LayerType.System:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.system.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                warn(`当前删除的node不是通过界面管理器添加到舞台上`);\r\n                node.destroy();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清除所有窗口\r\n     * @param isDestroy 移除后是否释放\r\n     * @example\r\n     * oops.gui.clear();\r\n     */\r\n    clear(isDestroy: boolean = false) {\r\n        this.ui.clear(isDestroy);\r\n        this.popup.clear(isDestroy);\r\n        this.dialog.clear(isDestroy);\r\n        this.system.clear(isDestroy);\r\n    }\r\n\r\n    /**\r\n     * 构造函数\r\n     * @param root  界面根节点\r\n     */\r\n    constructor(root: Node) {\r\n        this.root = root;\r\n        this.camera = this.root.getComponentInChildren(Camera)!;\r\n\r\n        this.game = this.create_node(LayerType.Game);\r\n\r\n        this.ui = new LayerUI(LayerType.UI);\r\n        this.popup = new LayerPopUp(LayerType.PopUp);\r\n        this.dialog = new LayerDialog(LayerType.Dialog);\r\n        this.system = new LayerDialog(LayerType.System);\r\n        this.notify = new LayerNotify(LayerType.Notify);\r\n\r\n        this.guide = this.create_node(LayerType.Guide);\r\n\r\n        root.addChild(this.game);\r\n        root.addChild(this.ui);\r\n        root.addChild(this.popup);\r\n        root.addChild(this.dialog);\r\n        root.addChild(this.system);\r\n        root.addChild(this.notify);\r\n        root.addChild(this.guide);\r\n    }\r\n\r\n    private create_node(name: string) {\r\n        const node = new Node(name);\r\n        node.layer = Layers.Enum.UI_2D;\r\n        const w: Widget = node.addComponent(Widget);\r\n        w.isAlignLeft = w.isAlignRight = w.isAlignTop = w.isAlignBottom = true;\r\n        w.left = w.right = w.top = w.bottom = 0;\r\n        w.alignMode = 2;\r\n        w.enabled = true;\r\n        return node;\r\n    }\r\n\r\n    hasUI(type: LayerType): boolean {\r\n        let result : boolean = false;\r\n        switch (type) {\r\n            case LayerType.UI:\r\n                result = this.ui.hasUI();\r\n                break;\r\n            case LayerType.PopUp:\r\n                result = this.popup.hasUI();\r\n                break;\r\n            case LayerType.Dialog:\r\n                result = this.dialog.hasUI();\r\n                break;\r\n            case LayerType.System:\r\n                result = this.system.hasUI();\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n}"]}