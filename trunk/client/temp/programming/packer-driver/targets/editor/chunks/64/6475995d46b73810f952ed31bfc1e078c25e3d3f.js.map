{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/framework/common/net/NetChannelManager.ts"],"names":["GameProtocol","NetChannelManager","oops","NetProtocolPako","WebSock","netConfig","NetGameTips","NetNodeGame","NetChannelType","getHearbeat","channelid","game","gameCreate","init","tcp","setNetNode","Game","gameConnect","connect","url","gameIp","gamePort","autoReconnect","gameClose","close","undefined","netChannel"],"mappings":";;;mGAmBMA,Y,EAOOC,iB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AArBJC,MAAAA,I,iBAAAA,I;;AAEAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,W,iBAAAA,W;;;;;;AAXT;AACA;AACA;AACA;AACA;;;gCASYC,c,0BAAAA,c;AAAAA,QAAAA,c,CAAAA,c;eAAAA,c;;AAKZ;;;AACMR,MAAAA,Y,GAAN,MAAMA,YAAN;AAAA;AAAA,8CAA2C;AACvC;AACAS,QAAAA,WAAW,GAAY;AACnB,iBAAQ,yFAAwF;AAAA;AAAA,sCAAUC,SAAU,kCAApH;AACH;;AAJsC,O;;mCAO9BT,iB,GAAN,MAAMA,iBAAN,CAAwB;AAAA;AAAA,eACpBU,IADoB;AAAA;;AAG3B;AACAC,QAAAA,UAAU,GAAG;AACT,eAAKD,IAAL,GAAY;AAAA;AAAA,2CAAZ,CADS,CAET;;AACA,eAAKA,IAAL,CAAUE,IAAV,CAAe;AAAA;AAAA,mCAAf,EAA8B,IAAIb,YAAJ,EAA9B,EAAkD;AAAA;AAAA,2CAAlD;AACA;AAAA;AAAA,4BAAKc,GAAL,CAASC,UAAT,CAAoB,KAAKJ,IAAzB,EAA+BH,cAAc,CAACQ,IAA9C;AACH;AAED;;;AACAC,QAAAA,WAAW,GAAG;AACV;AAAA;AAAA,4BAAKH,GAAL,CAASI,OAAT,CAAiB;AACbC,YAAAA,GAAG,EAAG,QAAO;AAAA;AAAA,wCAAUC,MAAO,IAAG;AAAA;AAAA,wCAAUC,QAAS,EADvC;AAEbC,YAAAA,aAAa,EAAE,CAFF,CAEW;;AAFX,WAAjB,EAGGd,cAAc,CAACQ,IAHlB;AAIH;AAED;;;AACAO,QAAAA,SAAS,GAAG;AACR;AAAA;AAAA,4BAAKT,GAAL,CAASU,KAAT,CAAeC,SAAf,EAA0BA,SAA1B,EAAqCjB,cAAc,CAACQ,IAApD;AACH;;AAtB0B,O;;4BAyBpBU,U,GAAa,IAAIzB,iBAAJ,E","sourcesContent":["/*\r\n * @Date: 2021-08-12 09:33:37\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-06-14 17:53:02\r\n */\r\nimport { oops } from \"../../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { NetData } from \"../../../../../extensions/oops-plugin-framework/assets/libs/network/NetInterface\";\r\nimport { NetProtocolPako } from \"../../../../../extensions/oops-plugin-framework/assets/libs/network/NetProtocolPako\";\r\nimport { WebSock } from \"../../../../../extensions/oops-plugin-framework/assets/libs/network/WebSock\";\r\nimport { netConfig } from \"./NetConfig\";\r\nimport { NetGameTips } from \"./NetGameTips\";\r\nimport { NetNodeGame } from \"./NetNodeGame\";\r\n\r\nexport enum NetChannelType {\r\n    /** 游戏服务器 */\r\n    Game = 0,\r\n}\r\n\r\n/** 游戏服务器心跳协议 */\r\nclass GameProtocol extends NetProtocolPako {\r\n    /** 心跳协议 */\r\n    getHearbeat(): NetData {\r\n        return `{\"action\":\"LoginAction\",\"method\":\"heart\",\"data\":\"null\",\"isCompress\":false,\"channelid\":${netConfig.channelid},\"callback\":\"LoginAction_heart\"}`;\r\n    }\r\n}\r\n\r\nexport class NetChannelManager {\r\n    public game!: NetNodeGame;\r\n\r\n    /** 创建游戏服务器 */\r\n    gameCreate() {\r\n        this.game = new NetNodeGame();\r\n        // 游戏网络事件逻辑统一在 NetGameTips 里写\r\n        this.game.init(new WebSock(), new GameProtocol(), new NetGameTips());\r\n        oops.tcp.setNetNode(this.game, NetChannelType.Game);\r\n    }\r\n\r\n    /** 连接游戏服务器 */\r\n    gameConnect() {\r\n        oops.tcp.connect({\r\n            url: `ws://${netConfig.gameIp}:${netConfig.gamePort}`,\r\n            autoReconnect: 0        // 手动重连接\r\n        }, NetChannelType.Game);\r\n    }\r\n\r\n    /** 断开游戏服务器 */\r\n    gameClose() {\r\n        oops.tcp.close(undefined, undefined, NetChannelType.Game);\r\n    }\r\n}\r\n\r\nexport var netChannel = new NetChannelManager();"]}