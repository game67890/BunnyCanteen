{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/libs/gui/button/ButtonSimple.ts"],"names":["AudioClip","Component","Node","_decorator","game","oops","ccclass","property","menu","ButtonSimple","tooltip","type","touchCount","touchtEndTime","onLoad","node","on","EventType","TOUCH_END","onTouchEnd","TOUCH_CANCEL","event","once","propagationStopped","totalTime","interval","playEffect","effect","audio","onDestroy","off","releaseEffect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,S,OAAAA,S;AAAuBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,I,OAAAA,I;;AACpDC,MAAAA,I,iBAAAA,I;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA;AAArB,O,GAA8BL,U;AAEpC;;yBAGqBM,Y,WAFpBH,OAAO,CAAC,cAAD,C,UACPE,IAAI,CAAC,wBAAD,C,UAEAD,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE;AADH,OAAD,C,UAKRH,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE;AADH,OAAD,C,UAKRH,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE,MADH;AAENC,QAAAA,IAAI,EAAEX;AAFA,OAAD,C,0CAbb,MAEqBS,YAFrB,SAE0CR,SAF1C,CAEoD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAiBxCW,UAjBwC,GAiB3B,CAjB2B;AAAA,eAkBxCC,aAlBwC,GAkBxB,CAlBwB;AAAA;;AAoBhDC,QAAAA,MAAM,GAAG;AACL,eAAKC,IAAL,CAAUC,EAAV,CAAad,IAAI,CAACe,SAAL,CAAeC,SAA5B,EAAuC,KAAKC,UAA5C,EAAwD,IAAxD;AACA,eAAKJ,IAAL,CAAUC,EAAV,CAAad,IAAI,CAACe,SAAL,CAAeG,YAA5B,EAA0C,KAAKD,UAA/C,EAA2D,IAA3D;AACH;AAED;;;AACUA,QAAAA,UAAU,CAACE,KAAD,EAAoB;AACpC,cAAI,KAAKC,IAAT,EAAe;AACX,gBAAI,KAAKV,UAAL,GAAkB,CAAtB,EAAyB;AACrBS,cAAAA,KAAK,CAACE,kBAAN,GAA2B,IAA3B;AACA;AACH;;AACD,iBAAKX,UAAL;AACH,WAPmC,CASpC;;;AACA,cAAI,KAAKC,aAAL,IAAsBT,IAAI,CAACoB,SAAL,GAAiB,KAAKX,aAAtB,GAAsC,KAAKY,QAArE,EAA+E;AAC3EJ,YAAAA,KAAK,CAACE,kBAAN,GAA2B,IAA3B;AACH,WAFD,MAGK;AACD,iBAAKV,aAAL,GAAqBT,IAAI,CAACoB,SAA1B,CADC,CAGD;;AACA,iBAAKE,UAAL;AACH;AACJ;AAED;;;AACUA,QAAAA,UAAU,GAAG;AACnB,cAAI,KAAKC,MAAT,EAAiB;AAAA;AAAA,4BAAKC,KAAL,CAAWF,UAAX,CAAsB,KAAKC,MAA3B;AACpB;;AAEDE,QAAAA,SAAS,GAAG;AACR,eAAKd,IAAL,CAAUe,GAAV,CAAc5B,IAAI,CAACe,SAAL,CAAeC,SAA7B,EAAwC,KAAKC,UAA7C,EAAyD,IAAzD;AACA,eAAKJ,IAAL,CAAUe,GAAV,CAAc5B,IAAI,CAACe,SAAL,CAAeG,YAA7B,EAA2C,KAAKD,UAAhD,EAA4D,IAA5D;AAEA,cAAI,KAAKQ,MAAT,EAAiB;AAAA;AAAA,4BAAKC,KAAL,CAAWG,aAAX,CAAyB,KAAKJ,MAA9B;AACpB;;AAzD+C,O;;;;;iBAIxB,K;;;;;;;iBAKG,G;;;;;;;iBAMC,I","sourcesContent":["import { AudioClip, Component, EventTouch, Node, _decorator, game } from \"cc\";\r\nimport { oops } from \"../../../core/Oops\";\r\n\r\nconst { ccclass, property, menu } = _decorator;\r\n\r\n/** 短按按钮 */\r\n@ccclass(\"ButtonSimple\")\r\n@menu('ui/button/ButtonSimple')\r\nexport default class ButtonSimple extends Component {\r\n    @property({\r\n        tooltip: \"是否只触发一次\"\r\n    })\r\n    private once: boolean = false;\r\n\r\n    @property({\r\n        tooltip: \"每次触发间隔\"\r\n    })\r\n    private interval: number = 500;\r\n\r\n    @property({\r\n        tooltip: \"触摸音效\",\r\n        type: AudioClip\r\n    })\r\n    private effect: AudioClip = null!;\r\n\r\n    private touchCount = 0;\r\n    private touchtEndTime = 0;\r\n\r\n    onLoad() {\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n    }\r\n\r\n    /** 触摸结束 */\r\n    protected onTouchEnd(event: EventTouch) {\r\n        if (this.once) {\r\n            if (this.touchCount > 0) {\r\n                event.propagationStopped = true;\r\n                return;\r\n            }\r\n            this.touchCount++;\r\n        }\r\n\r\n        // 防连点500毫秒出发一次事件\r\n        if (this.touchtEndTime && game.totalTime - this.touchtEndTime < this.interval) {\r\n            event.propagationStopped = true;\r\n        }\r\n        else {\r\n            this.touchtEndTime = game.totalTime;\r\n\r\n            // 短按触摸音效\r\n            this.playEffect();\r\n        }\r\n    }\r\n\r\n    /** 短按触摸音效 */\r\n    protected playEffect() {\r\n        if (this.effect) oops.audio.playEffect(this.effect);\r\n    }\r\n\r\n    onDestroy() {\r\n        this.node.off(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.off(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n\r\n        if (this.effect) oops.audio.releaseEffect(this.effect);\r\n    }\r\n}\r\n"]}