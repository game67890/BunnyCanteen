{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/libs/animator-effect/Effect2DFollow3D.ts"],"names":["_decorator","Component","Node","Vec3","oops","MathUtil","ccclass","property","Effect2DFollow3D","type","camera","pos","setTarget","node","node3d","start","scale","zoom","setScale","lateUpdate","dt","lerp","x","convertToUINode","worldPosition","gui","game","nodeUi","setPosition","transformMat4","_camera","matView","ratio","distance","Math","abs","z","floor"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAOQA,MAAAA,U,OAAAA,U;AAAoBC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AACrCC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,Q,iBAAAA,Q;;;;;;AATR;AACA;AACA;AACA;AACA;AACA;;;;;OAMM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;AAE9B;;kCAEaQ,gB,WADZF,OAAO,CAAC,kBAAD,C,UAGHC,QAAQ,CAAC;AAAEE,QAAAA,IAAI,EAAEP;AAAR,OAAD,C,UAIRK,QAAQ,CAAC;AAAEE,QAAAA,IAAI,EAAEP;AAAR,OAAD,C,2BAPb,MACaM,gBADb,SACsCP,SADtC,CACgD;AAAA;AAAA;;AAC5C;AAD4C;;AAK5C;AAL4C;;AAS5C;AAT4C;;AAa5C;AAb4C,eAc5CS,MAd4C,GAc3B,IAd2B;AAAA,eAgBpCC,GAhBoC,GAgB9B,IAAIR,IAAJ,EAhB8B;AAAA;;AAkB5C;AACJ;AACA;AACA;AACIS,QAAAA,SAAS,CAACC,IAAD,EAAa;AAClB,eAAKC,MAAL,GAAcD,IAAd;AACH;;AAEDE,QAAAA,KAAK,GAAG;AACJ,gBAAMC,KAAK,GAAG,KAAKC,IAAL,EAAd;AACA,eAAKJ,IAAL,CAAUK,QAAV,CAAmBF,KAAnB,EAA0BA,KAA1B,EAAiC,CAAjC;AACH;;AAESG,QAAAA,UAAU,CAACC,EAAD,EAAa;AAC7B,cAAIJ,KAAK,GAAG,KAAKC,IAAL,EAAZ;AACAD,UAAAA,KAAK,GAAG;AAAA;AAAA,oCAASK,IAAT,CAAc,KAAKR,IAAL,CAAUG,KAAV,CAAgBM,CAA9B,EAAiCN,KAAjC,EAAwC,GAAxC,CAAR;AACA,eAAKH,IAAL,CAAUK,QAAV,CAAmBF,KAAnB,EAA0BA,KAA1B,EAAiC,CAAjC;AACH;;AAEOC,QAAAA,IAAI,GAAW;AACnB,eAAKP,MAAL,CAAYa,eAAZ,CAA4B,KAAKT,MAAL,CAAYU,aAAxC,EAAuD;AAAA;AAAA,4BAAKC,GAAL,CAASC,IAAhE,EAAsE,KAAKf,GAA3E;AACA,eAAKgB,MAAL,CAAYC,WAAZ,CAAwB,KAAKjB,GAA7B,EAFmB,CAInB;;AACAR,UAAAA,IAAI,CAAC0B,aAAL,CAAmB,KAAKlB,GAAxB,EAA6B,KAAKG,MAAL,CAAYU,aAAzC,EAAwD,KAAKd,MAAL,CAAYoB,OAAZ,CAAqBC,OAA7E;AACA,gBAAMC,KAAK,GAAG,KAAKC,QAAL,GAAgBC,IAAI,CAACC,GAAL,CAAS,KAAKxB,GAAL,CAASyB,CAAlB,CAA9B;AACA,iBAAOF,IAAI,CAACG,KAAL,CAAWL,KAAK,GAAG,GAAnB,IAA0B,GAAjC;AACH;;AA7C2C,O;;;;;iBAG7B,I;;;;;;;iBAIA,I;;mFAGdzB,Q;;;;;iBACkB,E","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-03-31 18:03:50\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-09-22 14:53:47\r\n */\r\n\r\nimport {_decorator, Camera, Component, Node, Vec3} from \"cc\";\r\nimport {oops} from \"../../core/Oops\";\r\nimport {MathUtil} from \"../../core/utils/MathUtil\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n/** 2D节点跟随3D节点 */\r\n@ccclass(\"Effect2DFollow3D\")\r\nexport class Effect2DFollow3D extends Component {\r\n    /** 3D世界节点 */\r\n    @property({ type: Node })\r\n    node3d: Node = null!;\r\n\r\n    /** 2D界面界面 */\r\n    @property({ type: Node })\r\n    nodeUi: Node = null!;\r\n\r\n    /** 距离 */\r\n    @property\r\n    distance: number = 10;\r\n\r\n    /** 3D摄像机 */\r\n    camera: Camera = null!;\r\n\r\n    private pos = new Vec3();\r\n\r\n    /**\r\n     * 设3D定位参考点，并更新位置\r\n     * @param node 3D世界节点\r\n     */\r\n    setTarget(node: Node) {\r\n        this.node3d = node;\r\n    }\r\n\r\n    start() {\r\n        const scale = this.zoom();\r\n        this.node.setScale(scale, scale, 1);\r\n    }\r\n\r\n    protected lateUpdate(dt: number) {\r\n        let scale = this.zoom();\r\n        scale = MathUtil.lerp(this.node.scale.x, scale, 0.1);\r\n        this.node.setScale(scale, scale, 1);\r\n    }\r\n\r\n    private zoom(): number {\r\n        this.camera.convertToUINode(this.node3d.worldPosition, oops.gui.game, this.pos);\r\n        this.nodeUi.setPosition(this.pos);\r\n\r\n        // @ts-ignore\r\n        Vec3.transformMat4(this.pos, this.node3d.worldPosition, this.camera._camera!.matView);\r\n        const ratio = this.distance / Math.abs(this.pos.z);\r\n        return Math.floor(ratio * 100) / 100;\r\n    }\r\n}\r\n\r\n"]}