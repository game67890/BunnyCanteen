{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/acceleratedbuff/AcceleratedBuffManager.ts"],"names":["AcceleratedBuffData","AcceleratedBuffManager","oops","GameEvent","UIID","TableAccelerate","HeChengComponent","ProtocolMgr","TonGameMgr","UtilMgr","AcceleratedBuffMain","acceleratetime","acceleratevalue","IsGetFreeBuff","GetFreeBuffTimeStamp","IsGetShareBuff","GetShareBuffTimeStamp","AcceleratedList_1","AcceleratedList_2","AccelerateTime","OfflineAccelerateGain","usetime","lixiangain","i","length","item","AcceAddtionGain_1","splice","AcceAddtionGain_2","GetRealCanTingGain","getAccelerateTime","message","dispatchEvent","UpdateBaseData","onUpdataAccelerateInfo","HechengGUI","gui","get","MainUI","HechengCom","getComponent","RefreshBuffIcon","buffGUI","AcceleratedBuffBuyMain","buffCom","UpdateAccelerateTime","CurBGM","StopBgMusic","PlayBgMusic","addAccelerateInfoById","configid","tablerecord","init","addAccelerateInfo","type","time","effect","acceleratetype","value","push","isAccelerating","time_1","time_2","SendBuyBuff","confId","completeCBuyBuff","ret","console","log","res","isSucc","Number","cost","AcceleratedBuffMgr","timer","getServerTime","updateCarrotCoin","CarrotCoin","costnum","Save","data","toString","userID","UserId","token","param","JSON","stringify","sendcbuybuff"],"mappings":"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","sourcesContent":["import { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { HttpReturn } from \"../../../../extensions/oops-plugin-framework/assets/libs/network/HttpRequest\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { TableAccelerate } from \"../../framework/common/table/TableAccelerate\";\r\nimport { HeChengComponent } from \"../hecheng/HeChengComponent\";\r\nimport { ProtocolMgr } from \"../manager/ProtocolManager\";\r\nimport { TonGameMgr } from \"../manager/TonGameManager\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\nimport { AcceleratedBuffMain } from \"./AcceleratedBuffMain\";\r\n\r\nclass AcceleratedBuffData {\r\n    acceleratetime : number = 0;\r\n    acceleratevalue : number = 0;\r\n}\r\n\r\nexport class AcceleratedBuffManager {\r\n    public IsGetFreeBuff = false;   // 是否已领取免费buff\r\n    public GetFreeBuffTimeStamp = 0;// 领取免费buff的时间戳\r\n    public IsGetShareBuff = false;   // 是否已领取分享buff\r\n    public GetShareBuffTimeStamp = 0;// 领取分享buff的时间戳\r\n    public AcceleratedList_1: any[] = [];\r\n    public AcceleratedList_2: any[] = [];\r\n\r\n    public AccelerateTime : number = 0;     // 剩余加速时长\r\n\r\n        // 用来计算离线时的收益\r\n        public OfflineAccelerateGain(usetime : number) : number{\r\n            let lixiangain = 0;\r\n            for (let i=0; i<usetime; i++) {\r\n                if (this.AcceleratedList_1.length > 0) {\r\n                    const item = this.AcceleratedList_1[0];\r\n                    if (this.AcceleratedList_1[0].acceleratetime > 0) {\r\n                        this.AcceleratedList_1[0].acceleratetime = this.AcceleratedList_1[0].acceleratetime - 1;\r\n                        TonGameMgr.AcceAddtionGain_1 = this.AcceleratedList_1[0].acceleratevalue/100;\r\n                        if (this.AcceleratedList_1[0].acceleratetime <= 0) {\r\n                            TonGameMgr.AcceAddtionGain_1 = 0;\r\n                            this.AcceleratedList_1.splice(0, 1);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    TonGameMgr.AcceAddtionGain_1 = 0;\r\n                }\r\n        \r\n                if (this.AcceleratedList_2.length > 0) {\r\n                    const item = this.AcceleratedList_2[0];\r\n                    if (this.AcceleratedList_2[0].acceleratetime > 0) {\r\n                        this.AcceleratedList_2[0].acceleratetime = this.AcceleratedList_2[0].acceleratetime - 1;\r\n                        TonGameMgr.AcceAddtionGain_2 = this.AcceleratedList_2[0].acceleratevalue;\r\n                        if (this.AcceleratedList_2[0].acceleratetime <= 0) {\r\n                            TonGameMgr.AcceAddtionGain_2 = 0;\r\n                            this.AcceleratedList_2.splice(0, 1);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    TonGameMgr.AcceAddtionGain_2 = 0;\r\n                }\r\n                lixiangain = lixiangain + TonGameMgr.GetRealCanTingGain();\r\n            }\r\n\r\n            this.AccelerateTime = this.getAccelerateTime();\r\n\r\n            oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n            return lixiangain;\r\n        }\r\n\r\n    // 每秒更新加速信息\r\n    public onUpdataAccelerateInfo() {\r\n        if (this.AcceleratedList_1.length > 0) {\r\n            const item = this.AcceleratedList_1[0];\r\n            if (this.AcceleratedList_1[0].acceleratetime > 0) {\r\n                this.AcceleratedList_1[0].acceleratetime = this.AcceleratedList_1[0].acceleratetime - 1;\r\n                if (TonGameMgr.AcceAddtionGain_1 != this.AcceleratedList_1[0].acceleratevalue/100) {\r\n                    TonGameMgr.AcceAddtionGain_1 = this.AcceleratedList_1[0].acceleratevalue/100;\r\n                    oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                }\r\n                TonGameMgr.AcceAddtionGain_1 = this.AcceleratedList_1[0].acceleratevalue/100;\r\n                if (this.AcceleratedList_1[0].acceleratetime <= 0) {\r\n                    TonGameMgr.AcceAddtionGain_1 = 0;\r\n                    oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                    this.AcceleratedList_1.splice(0, 1);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            TonGameMgr.AcceAddtionGain_1 = 0;\r\n        }\r\n\r\n        if (this.AcceleratedList_2.length > 0) {\r\n            const item = this.AcceleratedList_2[0];\r\n            if (this.AcceleratedList_2[0].acceleratetime > 0) {\r\n                this.AcceleratedList_2[0].acceleratetime = this.AcceleratedList_2[0].acceleratetime - 1;\r\n                if (TonGameMgr.AcceAddtionGain_2 != this.AcceleratedList_2[0].acceleratevalue) {\r\n                    TonGameMgr.AcceAddtionGain_2 = this.AcceleratedList_2[0].acceleratevalue;\r\n                    oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                }\r\n                if (this.AcceleratedList_2[0].acceleratetime <= 0) {\r\n                    TonGameMgr.AcceAddtionGain_2 = 0;\r\n                    oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                    this.AcceleratedList_2.splice(0, 1);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            TonGameMgr.AcceAddtionGain_2 = 0;\r\n        }\r\n\r\n        const HechengGUI = oops.gui.get(UIID.MainUI);\r\n        if (HechengGUI) {\r\n            const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n            if (HechengCom) {\r\n                HechengCom.RefreshBuffIcon();\r\n            }\r\n        }\r\n        const buffGUI = oops.gui.get(UIID.AcceleratedBuffBuyMain);\r\n        if (buffGUI) {\r\n            const buffCom = buffGUI.getComponent(AcceleratedBuffMain);\r\n            if (buffCom) {\r\n                buffCom.RefreshBuffIcon();\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    public UpdateAccelerateTime() {\r\n        if (this.AccelerateTime > 0) {\r\n            if (TonGameMgr.CurBGM == 22 || TonGameMgr.CurBGM == 0) {\r\n                UtilMgr.StopBgMusic();\r\n                UtilMgr.PlayBgMusic(23);\r\n            }\r\n            this.AccelerateTime = this.AccelerateTime - 1;\r\n            if (this.AccelerateTime <= 0) {\r\n                this.AccelerateTime =  0\r\n                if (TonGameMgr.CurBGM == 23 || TonGameMgr.CurBGM == 0) {\r\n                    UtilMgr.StopBgMusic();\r\n                    UtilMgr.PlayBgMusic(22);\r\n                }\r\n            }\r\n        } else {\r\n            if (TonGameMgr.CurBGM == 23 || TonGameMgr.CurBGM == 0) {\r\n                UtilMgr.StopBgMusic();\r\n                UtilMgr.PlayBgMusic(22);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 根据配置信息添加一条buff信息\r\n    public addAccelerateInfoById(configid:number) {\r\n        let tablerecord = new TableAccelerate();\r\n        tablerecord.init(configid)\r\n        this.addAccelerateInfo(tablerecord.type, tablerecord.time, tablerecord.effect);\r\n        this.AccelerateTime = this.getAccelerateTime();\r\n    }\r\n\r\n    // 添加一条buff信息\r\n    public addAccelerateInfo(acceleratetype:number, time:number, value:number) {\r\n        const item: AcceleratedBuffData = {\r\n            acceleratetime : time,\r\n            acceleratevalue : value,\r\n        }\r\n\r\n        if (acceleratetype == 1) {\r\n            this.AcceleratedList_1.push(item);\r\n        }\r\n        else if (acceleratetype == 2) {\r\n            this.AcceleratedList_2.push(item);\r\n        }\r\n        this.AccelerateTime = this.getAccelerateTime();\r\n    }\r\n\r\n    // 判断当前是否有加成buff\r\n    public isAccelerating() : boolean {\r\n        for (let i=0; i<this.AcceleratedList_1.length; i++) {\r\n            if (this.AcceleratedList_1[i].acceleratetime > 0) {\r\n                return true;\r\n            }\r\n        }\r\n        for (let i=0; i<this.AcceleratedList_2.length; i++) {\r\n            if (this.AcceleratedList_2[i].acceleratetime > 0) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // 获取剩余加速时间\r\n    public getAccelerateTime() : number {\r\n        let time_1 = 0\r\n        let time_2 = 0\r\n        for (let i=0; i<this.AcceleratedList_1.length; i++) {\r\n            if (this.AcceleratedList_1[i].acceleratetime > 0) {\r\n                time_1 = time_1 + this.AcceleratedList_1[i].acceleratetime;\r\n            }\r\n        }\r\n        for (let i=0; i<this.AcceleratedList_2.length; i++) {\r\n            if (this.AcceleratedList_2[i].acceleratetime > 0) {\r\n                time_2 = time_2 + this.AcceleratedList_2[i].acceleratetime;\r\n            }\r\n        }\r\n        if (time_1 > time_2) {\r\n            return time_1;\r\n        }\r\n        else {\r\n            return time_2;\r\n        }\r\n    }\r\n\r\n    public SendBuyBuff(confId:number) {\r\n        var completeCBuyBuff = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n            if (ret.isSucc && Number(ret.res.confId)!=-1)\r\n            {\r\n                let tablerecord = new TableAccelerate();\r\n                tablerecord.init(Number(ret.res.confId));\r\n                this.addAccelerateInfoById(confId);\r\n                if (tablerecord.cost == 1) {\r\n                    AcceleratedBuffMgr.IsGetFreeBuff = true;\r\n                    AcceleratedBuffMgr.GetFreeBuffTimeStamp = oops.timer.getServerTime();\r\n                }\r\n                else if (tablerecord.cost == 2) {\r\n                    AcceleratedBuffMgr.IsGetShareBuff = true;\r\n                    AcceleratedBuffMgr.GetShareBuffTimeStamp = oops.timer.getServerTime();\r\n                }\r\n                else if (tablerecord.cost == 3) {\r\n                    TonGameMgr.updateCarrotCoin(TonGameMgr.CarrotCoin - tablerecord.costnum);\r\n                }\r\n                oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                oops.message.dispatchEvent(GameEvent.Save);\r\n            }\r\n        }\r\n    \r\n        const data: { [key: string]: any } = {};\r\n        data.confId = confId.toString();\r\n        data.userID = TonGameMgr.UserId;\r\n        data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n    \r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendcbuybuff(completeCBuyBuff, param);\r\n    }\r\n}\r\n\r\nexport var AcceleratedBuffMgr = new AcceleratedBuffManager();"]}