{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/shop/ShopItemCell.ts"],"names":["Animation","_decorator","Label","Sprite","Button","Widget","IVirtualGridListItem","oops","TableShop","TonGameMgr","ShopMgr","GameEvent","UIID","HeChengComponent","UtilMgr","PaymentMgr","ccclass","property","ShopItemCell","tablerecord","state","animCtrl","animation","onSelect","console","log","itemIndex","updateSelectionStatus","onUnselect","onDataChanged","data","init","configid","RabbitName","string","language","getLangByID","name","RabbitIcon","getComponent","GetRandomAnimation","addNodeAnimation","node","ShowTxt","AdditionEffectTxt","effect","toString","unlocktype","CanTingLevel","unlockpara","TuZiCoin","CarrotCoin","LockWnd","active","BuyBtn","IsHaveRabbitId","ChangeBtn","CurRabbitId","ChangeBtnTxt","InUseTxt","CostCarrotIcon","paytype","CostRabbitIcon","PriceTxt","formatNumber","BigInt","price","TuijianIcon","onDestroy","onBuyBtnClick","gui","toast","message","SendBuyRabbit","OpenPaymentUI","onChangeBtnClick","PlaySoundEffect","CurRabbitAnimation","HechengGUI","get","MainUI","HechengCom","RefreshRabbitIcon","dispatchEvent","OnShopListChange"],"mappings":"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","sourcesContent":["import { Animation, _decorator, Label, Sprite, Button, Widget} from 'cc';\r\nimport {IVirtualGridListItem} from \"../../../resources/libs/virtual_grid_list/interface\";\r\nimport { oops } from '../../../../extensions/oops-plugin-framework/assets/core/Oops';\r\nimport { TableShop } from '../../framework/common/table/TableShop';\r\nimport { TonGameMgr } from '../manager/TonGameManager';\r\nimport { ShopMgr } from './ShopManager';\r\nimport { GameEvent } from '../../framework/common/config/GameEvent';\r\nimport { UIID } from '../../framework/common/config/GameUIConfig';\r\nimport { HeChengComponent } from '../hecheng/HeChengComponent';\r\nimport { UtilMgr } from '../manager/UtilManager';\r\nimport { PaymentMgr } from '../payment/PaymentManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ShopItemCell')\r\nexport class ShopItemCell extends IVirtualGridListItem {\r\n    @property(Label)\r\n    RabbitName: Label;\r\n    @property(Sprite)\r\n    RabbitIcon: Sprite;\r\n    @property(Label)\r\n    ShowTxt: Label;\r\n    @property(Label)\r\n    AdditionEffectTxt: Label;\r\n    @property(Widget)\r\n    LockWnd: Widget;\r\n    @property(Sprite)\r\n    CostCarrotIcon: Sprite;\r\n    @property(Sprite)\r\n    CostRabbitIcon: Sprite;\r\n    @property(Label)\r\n    PriceTxt: Label;\r\n    @property(Sprite)\r\n    TuijianIcon: Sprite;\r\n\r\n    @property(Button)\r\n    BuyBtn: Button;\r\n    @property(Button)\r\n    ChangeBtn: Button;\r\n    @property(Label)\r\n    ChangeBtnTxt: Label;\r\n    @property(Label)\r\n    InUseTxt: Label;\r\n\r\n    private tablerecord = new TableShop();\r\n    private state : boolean = true;\r\n    private animCtrl:any = {};\r\n    private animation:string = null;\r\n\r\n    /** 点击触发选择事件 */\r\n    onSelect() {\r\n        console.log('select _' + this.itemIndex);\r\n\r\n        this.updateSelectionStatus();\r\n    }\r\n\r\n    onUnselect() {\r\n        console.log('unselect _' + this.itemIndex);\r\n\r\n        this.updateSelectionStatus();\r\n    }\r\n\r\n    onDataChanged() {\r\n        const data = this.data;\r\n        this.tablerecord.init(data.configid);\r\n        if (!this.tablerecord) {\r\n            return;\r\n        }\r\n\r\n        // 兔子名称\r\n        this.RabbitName.string = oops.language.getLangByID(this.tablerecord.name);\r\n        // 兔子造型图标\r\n        this.animCtrl = this.RabbitIcon.getComponent(Animation);\r\n        if (this.animation == null) {\r\n            this.animation = ShopMgr.GetRandomAnimation(data.configid)\r\n        }\r\n        UtilMgr.addNodeAnimation(this.animation, this.RabbitIcon.node, true, true);\r\n\r\n        // 加成收益\r\n        this.ShowTxt.string = oops.language.getLangByID(\"stringres_197\");\r\n        this.AdditionEffectTxt.string = this.tablerecord.effect.toString() + \"%\";\r\n\r\n        // 锁头图标\r\n        if (this.tablerecord.unlocktype == 1) {     \r\n            this.state = (TonGameMgr.CanTingLevel < this.tablerecord.unlockpara)\r\n        }\r\n        else if (this.tablerecord.unlocktype == 2) {\r\n            this.state = (TonGameMgr.TuZiCoin < this.tablerecord.unlockpara);\r\n        } \r\n        else if (this.tablerecord.unlocktype == 3) {\r\n            this.state = (TonGameMgr.CarrotCoin < this.tablerecord.unlockpara);\r\n        }\r\n        this.LockWnd.node.active = this.state;\r\n\r\n        // 按钮显示\r\n        this.BuyBtn.node.active = (ShopMgr.IsHaveRabbitId(data.configid) == false);\r\n        this.ChangeBtn.node.active = (ShopMgr.IsHaveRabbitId(data.configid) && TonGameMgr.CurRabbitId != data.configid);\r\n        this.ChangeBtnTxt.string = oops.language.getLangByID(\"stringres_195\");\r\n        this.InUseTxt.string = oops.language.getLangByID(\"stringres_196\");\r\n        this.InUseTxt.node.active = (TonGameMgr.CurRabbitId == data.configid)\r\n\r\n        // 货币图标\r\n        this.CostCarrotIcon.node.active = (this.tablerecord.paytype == 2);\r\n        this.CostRabbitIcon.node.active = (this.tablerecord.paytype == 1);\r\n\r\n        // 价格\r\n        if (this.tablerecord.paytype == 1)\r\n        {\r\n            this.PriceTxt.string = UtilMgr.formatNumber(BigInt(this.tablerecord.price));\r\n        }\r\n        else\r\n        {\r\n            this.PriceTxt.string = this.tablerecord.price.toString();\r\n        }\r\n\r\n        // 推荐按钮显示\r\n        this.TuijianIcon.node.active = (ShopMgr.IsHaveRabbitId(data.configid) == false && this.state == false);\r\n\r\n        this.updateSelectionStatus();\r\n    }\r\n\r\n    updateSelectionStatus() {\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n\r\n    public onBuyBtnClick() {\r\n        if (this.state == true) {\r\n            oops.gui.toast(this.tablerecord.message, true);\r\n            return;\r\n        }\r\n        if (this.tablerecord.paytype == 1) {    // 兔子币支付\r\n            if (TonGameMgr.TuZiCoin < this.tablerecord.price) {\r\n                oops.gui.toast(\"message_10\", true);\r\n                return;\r\n            }\r\n            ShopMgr.SendBuyRabbit(this.data.configid);\r\n        }\r\n        else {     // 萝卜币支付 \r\n            if (TonGameMgr.CarrotCoin < this.tablerecord.price) {\r\n                PaymentMgr.OpenPaymentUI();\r\n                oops.gui.toast(\"message_07\", true);\r\n                return;\r\n            }\r\n            ShopMgr.SendBuyRabbit(this.data.configid);\r\n        }\r\n    }\r\n\r\n    public onChangeBtnClick() {\r\n        if (this.state == true) {\r\n            return;\r\n        }\r\n        UtilMgr.PlaySoundEffect(18);\r\n        oops.gui.toast(\"message_29\", true);\r\n        TonGameMgr.CurRabbitId = this.data.configid;\r\n        TonGameMgr.CurRabbitAnimation = ShopMgr.GetRandomAnimation(this.data.configid);\r\n        const HechengGUI = oops.gui.get(UIID.MainUI);\r\n        if (HechengGUI) {\r\n            const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n            if (HechengCom) {\r\n                HechengCom.RefreshRabbitIcon();\r\n            }\r\n        }\r\n        oops.message.dispatchEvent(GameEvent.OnShopListChange);\r\n    }\r\n}\r\n\r\n\r\n"]}