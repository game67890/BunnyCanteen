{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/rank/RankComponent.ts"],"names":["_decorator","Component","Node","Sprite","Label","oops","UIID","GameEvent","StringUtil","RankMgr","UtilMgr","TonGameMgr","RankVirtualGridList","ProtocolMgr","RankTabController","ccclass","property","RankComponent","_tuziRankDataList","_cantingRankDataList","onAdded","params","rankTabController","node","getComponentInChildren","selectTab","dailyRank","string","language","getLangByID","canteenRank","ShowAllUserNum","RankList","RankData","compositeKey","rankType","rankConfId","ShowRank","GetRankData","GetRankDataBack","ShowUserHead","data","param","JSON","stringify","completeRank","ret","isSucc","res","allUserNumber","rankTyppe","list","myInfoTuzi","myInfo","myInfoCanting","sendRankList","message","on","SwitchRank","onUpdateData","allUserNum","toString","userHeadImageBacks","forEach","BackNode","index","active","userList","GetUserImageList","i","length","userHeadImages","onDestroy","off","event","args","OnSwitchRank","curRankConfId","rankList","Data","GetRankDataByLevel","SetImage","duanweiIcon","bigrankicon","duanweiBackImage","rankpic","duanweiName","rankname","duanweiNum","substitute_1","lower","ShowTuziRank","canteenranklower","ShowCantingRank","RankConfId","curRankType","IsRankListHasMyInfo","id","userId","undefined","Array","isArray","push","UserId","refreshTuziRankGridList","tuziRankGridList","clearList","initGridList","paddingTop","paddingBottom","spacingX","spacingY","columnNum","useVirtualLayout","emptyTip","cacheImage","appendItemsToDisplayList","refreshCantingRankGridList","cantingRankGridList","onLeft","PlaySoundEffect","GetMaxRankLevelId","onRight","onClose","gui","remove","Rank"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,K,OAAAA,K;;AACrCC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,O,iBAAAA,O;;AAEAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,mB,iBAAAA,mB;;AACAC,MAAAA,W,kBAAAA,W;;AACAC,MAAAA,iB,kBAAAA,iB;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBhB,U;;+BAKjBiB,a,WADZF,OAAO,CAAC,eAAD,C,UAGHC,QAAQ,CAAC,CAACd,IAAD,CAAD,C,UAERc,QAAQ,CAAC,CAACb,MAAD,CAAD,C,UAERa,QAAQ,CAACZ,KAAD,C,UAIRY,QAAQ,CAACb,MAAD,C,UAERa,QAAQ,CAACb,MAAD,C,UAGRa,QAAQ,CAACZ,KAAD,C,UAERY,QAAQ,CAACZ,KAAD,C,UAGRY,QAAQ,CAACZ,KAAD,C,WAERY,QAAQ,CAACZ,KAAD,C,WAGRY,QAAQ;AAAA;AAAA,qD,WAGRA,QAAQ;AAAA;AAAA,qD,2BA7Bb,MACaC,aADb,SACmChB,SADnC,CAC6C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eA+BjCiB,iBA/BiC,GA+BN,EA/BM;AAAA,eAgCjCC,oBAhCiC,GAgCH,EAhCG;AAAA;;AAmCzCC,QAAAA,OAAO,CAACC,MAAD,EAAuB;AAC1B,gBAAMC,iBAAiB,GAAG,KAAKC,IAAL,CAAUC,sBAAV;AAAA;AAAA,qDAA1B;;AACA,cAAIF,iBAAJ,EACA;AACIA,YAAAA,iBAAiB,CAACG,SAAlB,CAA4B,CAA5B;AACH;;AAED,eAAKC,SAAL,CAAeC,MAAf,GAAwB;AAAA;AAAA,4BAAKC,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAAxB;AACA,eAAKC,WAAL,CAAiBH,MAAjB,GAA0B;AAAA;AAAA,4BAAKC,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAA1B;AACA,eAAKE,cAAL;AAEA,cAAIC,QAAQ,GAAG;AAAA;AAAA,kCAAQC,QAAR,CAAiB;AAAA;AAAA,kCAAQC,YAAR,CAAqBb,MAAM,CAACc,QAA5B,EAAsCd,MAAM,CAACe,UAA7C,CAAjB,CAAf;;AACA,cAAIJ,QAAJ,EACA;AACI,iBAAKK,QAAL,CAAchB,MAAM,CAACc,QAArB,EAA+Bd,MAAM,CAACe,UAAtC,EAAkDJ,QAAlD;AACA;AAAA;AAAA,oCAAQM,WAAR,CAAoBjB,MAAM,CAACc,QAA3B,EAAqCd,MAAM,CAACe,UAA5C;AACA;AAAA;AAAA,oCAAQG,eAAR;AACA,iBAAKC,YAAL;AACH,WAND,MAQA;AACI,kBAAMC,IAA4B,GAAG,EAArC;AACAA,YAAAA,IAAI,CAACN,QAAL,GAAgBd,MAAM,CAACc,QAAvB;AACAM,YAAAA,IAAI,CAACL,UAAL,GAAkBf,MAAM,CAACe,UAAzB;AACA,kBAAMM,KAAK,GAAGC,IAAI,CAACC,SAAL,CAAeH,IAAf,CAAd;;AACA,gBAAII,YAAY,GAAIC,GAAD,IAAqB;AACpC,kBAAIA,GAAG,CAACC,MAAJ,IAAcD,GAAG,CAACE,GAAtB,EACA;AACI;AAAA;AAAA,wCAAQC,aAAR,GAAwBH,GAAG,CAACE,GAAJ,CAAQC,aAAhC;AACA,qBAAKlB,cAAL;AACA;AAAA;AAAA,wCAAQE,QAAR,CAAiB;AAAA;AAAA,wCAAQC,YAAR,CAAqBY,GAAG,CAACE,GAAJ,CAAQE,SAA7B,EAAwCJ,GAAG,CAACE,GAAJ,CAAQZ,UAAhD,CAAjB,IAAgFU,GAAG,CAACE,GAAJ,CAAQG,IAAxF;;AACA,oBAAIL,GAAG,CAACE,GAAJ,CAAQE,SAAR,IAAqB,GAAzB,EACA;AACI;AAAA;AAAA,0CAAQE,UAAR,GAAqBN,GAAG,CAACE,GAAJ,CAAQK,MAA7B;AACH,iBAHD,MAIK,IAAIP,GAAG,CAACE,GAAJ,CAAQE,SAAR,IAAqB,GAAzB,EACL;AACI;AAAA;AAAA,0CAAQI,aAAR,GAAwBR,GAAG,CAACE,GAAJ,CAAQK,MAAhC;AACH;;AACD,qBAAKhB,QAAL,CAAcS,GAAG,CAACE,GAAJ,CAAQE,SAAtB,EAAiCJ,GAAG,CAACE,GAAJ,CAAQZ,UAAzC,EAAqDU,GAAG,CAACE,GAAJ,CAAQG,IAA7D;AACA;AAAA;AAAA,wCAAQZ,eAAR;AACA,qBAAKC,YAAL;AACH;AACJ,aAlBD;;AAmBA;AAAA;AAAA,4CAAYe,YAAZ,CAAyBV,YAAzB,EAAuCH,KAAvC;AACH;;AACD;AAAA;AAAA,4BAAKc,OAAL,CAAaC,EAAb,CAAgB;AAAA;AAAA,sCAAUC,UAA1B,EAAsC,KAAKC,YAA3C,EAAyD,IAAzD;AACA,iBAAO,IAAP;AACH;;AACO5B,QAAAA,cAAc,GACtB;AACI,cAAI;AAAA;AAAA,kCAAQkB,aAAR,GAAwB,CAA5B,EACA;AACI,gBAAI;AAAA;AAAA,oCAAQA,aAAR,GAAwB,GAA5B,EACA;AACI,mBAAKW,UAAL,CAAgBjC,MAAhB,GAAyB;AAAA;AAAA,gCAAKC,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAAzB;AACH,aAHD,MAKA;AACI,mBAAK+B,UAAL,CAAgBjC,MAAhB,GAAyB;AAAA;AAAA,sCAAQsB,aAAR,CAAsBY,QAAtB,EAAzB;AACH;AACJ;AACJ;;AAEOrB,QAAAA,YAAY,GAAG;AACnB,eAAKsB,kBAAL,CAAwBC,OAAxB,CAAgC,CAACC,QAAD,EAAWC,KAAX,KAAqB;AACjDD,YAAAA,QAAQ,CAACE,MAAT,GAAkB,KAAlB;AACH,WAFD;AAIA,cAAIC,QAAQ,GAAG;AAAA;AAAA,kCAAQC,gBAAR,EAAf;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,QAAQ,CAACG,MAA7B,EAAqCD,CAAC,EAAtC,EACA;AACI,iBAAKP,kBAAL,CAAwBO,CAAxB,EAA2BH,MAA3B,GAAoC,IAApC;AACA;AAAA;AAAA,oCAAQ1B,YAAR,CAAqB2B,QAAQ,CAACE,CAAD,CAA7B,EAAkC,KAAKE,cAAL,CAAoBF,CAApB,CAAlC;AACH;AACJ;;AAEDG,QAAAA,SAAS,GAAG;AACR;AAAA;AAAA,4BAAKhB,OAAL,CAAaiB,GAAb,CAAiB;AAAA;AAAA,sCAAUf,UAA3B,EAAuC,KAAKC,YAA5C,EAA0D,IAA1D;AACH;;AAEOA,QAAAA,YAAY,CAACe,KAAD,EAAgBC,IAAhB,EAA2B;AAC3C,kBAAQD,KAAR;AACI,iBAAK;AAAA;AAAA,wCAAUhB,UAAf;AACI,mBAAKkB,YAAL,CAAkB;AAAA;AAAA,sCAAQC,aAA1B;AACA;AAHR;AAKH;;AACOxC,QAAAA,QAAQ,CAACF,QAAD,EAAkBC,UAAlB,EAAsC0C,QAAtC,EAChB;AACI,cAAI3C,QAAQ,IAAI,CAAhB,EACA;AAAC;AACG,gBAAI4C,IAAI,GAAG;AAAA;AAAA,oCAAQC,kBAAR,CAA2B5C,UAA3B,CAAX;;AACA,gBAAI2C,IAAJ,EACA;AACI;AAAA;AAAA,sCAAQE,QAAR,CAAiB,KAAKC,WAAtB,EAAmCH,IAAI,CAACI,WAAxC;AACA;AAAA;AAAA,sCAAQF,QAAR,CAAiB,KAAKG,gBAAtB,EAAwCL,IAAI,CAACM,OAA7C;AACA,mBAAKC,WAAL,CAAiB3D,MAAjB,GAA0B;AAAA;AAAA,gCAAKC,QAAL,CAAcC,WAAd,CAA0BkD,IAAI,CAACQ,QAA/B,CAA1B;AACA,mBAAKC,UAAL,CAAgB7D,MAAhB,GAAyB;AAAA;AAAA,4CAAW8D,YAAX,CAAwB;AAAA;AAAA,gCAAK7D,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAAxB,EAAoEkD,IAAI,CAACW,KAAL,CAAW7B,QAAX,EAApE,CAAzB;AACA,mBAAK8B,YAAL,CAAkBvD,UAAlB,EAA8B0C,QAA9B;AACH;AACJ,WAXD,MAYK,IAAI3C,QAAQ,IAAI,CAAhB,EACL;AAAC;AACG,gBAAI4C,IAAI,GAAG;AAAA;AAAA,oCAAQC,kBAAR,CAA2B5C,UAA3B,CAAX;;AACA,gBAAI2C,IAAJ,EACA;AACI;AAAA;AAAA,sCAAQE,QAAR,CAAiB,KAAKC,WAAtB,EAAmCH,IAAI,CAACI,WAAxC;AACA;AAAA;AAAA,sCAAQF,QAAR,CAAiB,KAAKG,gBAAtB,EAAwCL,IAAI,CAACM,OAA7C;AACA,mBAAKC,WAAL,CAAiB3D,MAAjB,GAA0B;AAAA;AAAA,gCAAKC,QAAL,CAAcC,WAAd,CAA0BkD,IAAI,CAACQ,QAA/B,CAA1B;AACA,mBAAKC,UAAL,CAAgB7D,MAAhB,GAAyB;AAAA;AAAA,4CAAW8D,YAAX,CAAwB;AAAA;AAAA,gCAAK7D,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAAxB,EAAoEkD,IAAI,CAACa,gBAAL,CAAsB/B,QAAtB,EAApE,CAAzB;AACA,mBAAKgC,eAAL,CAAqBzD,UAArB,EAAiC0C,QAAjC;AACH;AACJ;AACJ;;AAEOF,QAAAA,YAAY,CAACkB,UAAD,EAAoB;AACpC,cAAI9D,QAAQ,GAAG;AAAA;AAAA,kCAAQC,QAAR,CAAiB;AAAA;AAAA,kCAAQC,YAAR,CAAqB;AAAA;AAAA,kCAAQ6D,WAA7B,EAA0CD,UAA1C,CAAjB,CAAf;;AACA,cAAI9D,QAAJ,EACA;AACI,iBAAKD,cAAL;AACA,iBAAKM,QAAL,CAAc;AAAA;AAAA,oCAAQ0D,WAAtB,EAAmCD,UAAnC,EAA+C9D,QAA/C;AACH,WAJD,MAMA;AACI;AAAA;AAAA,oCAAQM,WAAR,CAAoB;AAAA;AAAA,oCAAQyD,WAA5B,EAAyCD,UAAzC;AACH;AACJ;;AAEOE,QAAAA,mBAAmB,CAAClB,QAAD,EAAWzB,MAAX,EAC3B;AACI,eAAK,MAAM4C,EAAX,IAAiBnB,QAAjB,EAA2B;AACvB,gBAAI7C,QAAQ,GAAG6C,QAAQ,CAACmB,EAAD,CAAvB;;AACA,gBAAIhE,QAAQ,CAACiE,MAAT,IAAmB7C,MAAM,CAAC6C,MAA9B,EACA;AACI,qBAAO,IAAP;AACH;AACJ;;AACD,iBAAO,KAAP;AACH;;AAEOP,QAAAA,YAAY,CAACvD,UAAD,EAAa0C,QAAb,EAAuB;AACvC,cAAIA,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAKqB,SAAlC,IAA+CC,KAAK,CAACC,OAAN,CAAcvB,QAAd,CAA/C,IAA0EA,QAAQ,CAACR,MAAnF,IAA6FQ,QAAQ,CAACR,MAAT,GAAkB,CAAnH,EACA;AACI,iBAAKpD,iBAAL,GAAyB,EAAzB;;AACA,iBAAK,MAAM+E,EAAX,IAAiBnB,QAAjB,EAA2B;AACvB,kBAAI7C,QAAQ,GAAG6C,QAAQ,CAACmB,EAAD,CAAvB;;AACA,mBAAK/E,iBAAL,CAAuBoF,IAAvB,CAA4BrE,QAA5B;AACH;;AACD,gBAAI;AAAA;AAAA,oCAAQmB,UAAR,CAAmBhB,UAAnB,IAAiCA,UAAjC,IAA+C,KAAK4D,mBAAL,CAAyBlB,QAAzB,EAAmC;AAAA;AAAA,oCAAQ1B,UAA3C,CAAnD,EACA;AACI;AAAA;AAAA,sCAAQA,UAAR,CAAmB8C,MAAnB,GAA4B;AAAA;AAAA,4CAAWK,MAAvC;;AACA,mBAAKrF,iBAAL,CAAuBoF,IAAvB,CAA4B;AAAA;AAAA,sCAAQlD,UAApC;AACH;;AACD,iBAAKoD,uBAAL;AACH,WAbD,MAcI;AACA,iBAAKA,uBAAL;AACA,iBAAKC,gBAAL,CAAsBC,SAAtB;AACH;AACJ;;AAEDF,QAAAA,uBAAuB,GAAG;AACtB;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEQ,cAAI,KAAKC,gBAAT,EAA2B;AACvB,iBAAKA,gBAAL,CAAsBC,SAAtB;AACA,iBAAKD,gBAAL,CAAsBE,YAAtB,CAAmC;AAC/BC,cAAAA,UAAU,EAAE,EADmB;AAE/BC,cAAAA,aAAa,EAAE,EAFgB;AAG/BC,cAAAA,QAAQ,EAAE,EAHqB;AAI/BC,cAAAA,QAAQ,EAAE,CAJqB;AAK/BC,cAAAA,SAAS,EAAE,CALoB;AAM/BC,cAAAA,gBAAgB,EAAE,IANa;AAO/BC,cAAAA,QAAQ,EAAE;AAAA;AAAA,gCAAKtF,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAPqB;AAQ/BsF,cAAAA,UAAU,EAAE;AARmB,aAAnC;AAUA,iBAAKV,gBAAL,CAAsBW,wBAAtB,CAA+C,KAAKlG,iBAApD;AACH;AACJ;;AAEO2E,QAAAA,eAAe,CAACzD,UAAD,EAAa0C,QAAb,EAAuB;AAC1C,cAAIA,QAAQ,KAAK,IAAb,IAAqBA,QAAQ,KAAKqB,SAAlC,IAA+CC,KAAK,CAACC,OAAN,CAAcvB,QAAd,CAA/C,IAA0EA,QAAQ,CAACR,MAAnF,IAA6FQ,QAAQ,CAACR,MAAT,GAAkB,CAAnH,EACA;AACI,iBAAKnD,oBAAL,GAA4B,EAA5B;;AACA,iBAAK,MAAM8E,EAAX,IAAiBnB,QAAjB,EAA2B;AACvB,kBAAI7C,QAAQ,GAAG6C,QAAQ,CAACmB,EAAD,CAAvB;;AACA,mBAAK9E,oBAAL,CAA0BmF,IAA1B,CAA+BrE,QAA/B;AACH;;AACD,gBAAI;AAAA;AAAA,oCAAQqB,aAAR,CAAsBlB,UAAtB,IAAoCA,UAApC,IAAkD,KAAK4D,mBAAL,CAAyBlB,QAAzB,EAAmC;AAAA;AAAA,oCAAQxB,aAA3C,CAAtD,EACA;AACI;AAAA;AAAA,sCAAQA,aAAR,CAAsB4C,MAAtB,GAA+B;AAAA;AAAA,4CAAWK,MAA1C;;AACA,mBAAKrF,iBAAL,CAAuBoF,IAAvB,CAA4B;AAAA;AAAA,sCAAQhD,aAApC;AACH;;AACD,iBAAK+D,0BAAL;AACH,WAbD,MAcI;AACA,iBAAKA,0BAAL;AACA,iBAAKC,mBAAL,CAAyBZ,SAAzB;AACH;AAEJ;;AAEDW,QAAAA,0BAA0B,GAAG;AACzB;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEQ,cAAI,KAAKC,mBAAT,EAA8B;AAC1B,iBAAKA,mBAAL,CAAyBZ,SAAzB;AACA,iBAAKY,mBAAL,CAAyBX,YAAzB,CAAsC;AAClCC,cAAAA,UAAU,EAAE,EADsB;AAElCC,cAAAA,aAAa,EAAE,EAFmB;AAGlCC,cAAAA,QAAQ,EAAE,EAHwB;AAIlCC,cAAAA,QAAQ,EAAE,CAJwB;AAKlCC,cAAAA,SAAS,EAAE,CALuB;AAMlCC,cAAAA,gBAAgB,EAAE,IANgB;AAOlCC,cAAAA,QAAQ,EAAE;AAAA;AAAA,gCAAKtF,QAAL,CAAcC,WAAd,CAA0B,eAA1B,CAPwB;AAQlCsF,cAAAA,UAAU,EAAE;AARsB,aAAtC;AAUA,iBAAKG,mBAAL,CAAyBF,wBAAzB,CAAkD,KAAKjG,oBAAvD;AACH;AACJ;;AAEMoG,QAAAA,MAAM,GAAG;AACZ;AAAA;AAAA,kCAAQC,eAAR,CAAwB,EAAxB;AACA,cAAIvF,QAAQ,GAAG;AAAA;AAAA,kCAAQ+C,kBAAR,CAA2B;AAAA;AAAA,kCAAQH,aAAR,GAAsB,CAAjD,CAAf;;AACA,cAAI5C,QAAJ,EACA;AACI;AAAA;AAAA,oCAAQ4C,aAAR,GAAwB;AAAA;AAAA,oCAAQA,aAAR,GAAwB,CAAhD;AACA,iBAAKD,YAAL,CAAkB;AAAA;AAAA,oCAAQC,aAA1B;AACH,WAJD,MAMA;AACI;AAAA;AAAA,oCAAQA,aAAR,GAAwB;AAAA;AAAA,oCAAQ4C,iBAAR,EAAxB;AACA,iBAAK7C,YAAL,CAAkB;AAAA;AAAA,oCAAQC,aAA1B;AACH;AACJ;;AAEM6C,QAAAA,OAAO,GAAG;AACb;AAAA;AAAA,kCAAQF,eAAR,CAAwB,EAAxB;AACA,cAAIvF,QAAQ,GAAG;AAAA;AAAA,kCAAQ+C,kBAAR,CAA2B;AAAA;AAAA,kCAAQH,aAAR,GAAsB,CAAjD,CAAf;;AACA,cAAI5C,QAAJ,EACA;AACI;AAAA;AAAA,oCAAQ4C,aAAR,GAAwB;AAAA;AAAA,oCAAQA,aAAR,GAAwB,CAAhD;AACA,iBAAKD,YAAL,CAAkB;AAAA;AAAA,oCAAQC,aAA1B;AACH,WAJD,MAMA;AACI;AAAA;AAAA,oCAAQA,aAAR,GAAwB,CAAxB;AACA,iBAAKD,YAAL,CAAkB;AAAA;AAAA,oCAAQC,aAA1B;AACH;AACJ;;AAEM8C,QAAAA,OAAO,GAAG;AACb;AAAA;AAAA,kCAAQH,eAAR,CAAwB,EAAxB;AACA;AAAA;AAAA,4BAAKI,GAAL,CAASC,MAAT,CAAgB;AAAA;AAAA,4BAAKC,IAArB;AACH;;AAlTwC,O;;;;;iBAGZ,E;;;;;;;iBAEF,E;;;;;;;iBAEP,I;;;;;;;iBAIE,I;;;;;;;iBAEK,I;;;;;;;iBAGN,I;;;;;;;iBAED,I;;;;;;;iBAGD,I;;;;;;;iBAEE,I;;;;;;;iBAG6B,I;;;;;;;iBAGG,I","sourcesContent":["import { _decorator, Component, Node, Sprite, Label, ScrollView, instantiate, UITransform, Prefab, Vec3 } from 'cc';\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { StringUtil } from '../../../../extensions/oops-plugin-framework/assets/core/utils/StringUtil';\r\nimport { RankMgr } from \"./RankManager\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\nimport { HttpReturn } from \"../../../../extensions/oops-plugin-framework/assets/libs/network/HttpRequest\";\r\nimport { TonGameMgr } from \"../manager/TonGameManager\";\r\nimport { RankVirtualGridList } from \"./RankVirtualGridList\";\r\nimport { ProtocolMgr } from \"../manager/ProtocolManager\";\r\nimport { RankTabController } from \"./RankTabController\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n@ccclass('RankComponent')\r\nexport class RankComponent extends Component {\r\n\r\n    @property([Node])\r\n    userHeadImageBacks: Node[] = [];\r\n    @property([Sprite])\r\n    userHeadImages: Sprite[] = [];\r\n    @property(Label)\r\n    allUserNum: Label = null;\r\n\r\n   \r\n    @property(Sprite)\r\n    duanweiIcon: Sprite = null;\r\n    @property(Sprite)\r\n    duanweiBackImage: Sprite = null;\r\n\r\n    @property(Label)\r\n    duanweiName: Label = null;\r\n    @property(Label)\r\n    duanweiNum: Label = null;\r\n\r\n    @property(Label)\r\n    dailyRank: Label = null;\r\n    @property(Label)\r\n    canteenRank: Label = null;\r\n\r\n    @property(RankVirtualGridList)\r\n    protected tuziRankGridList: RankVirtualGridList = null;\r\n\r\n    @property(RankVirtualGridList)\r\n    protected cantingRankGridList: RankVirtualGridList = null;\r\n\r\n    private _tuziRankDataList: any[] = [];\r\n    private _cantingRankDataList: any[] = [];\r\n\r\n    \r\n    onAdded(params: any): boolean {\r\n        const rankTabController = this.node.getComponentInChildren(RankTabController);\r\n        if (rankTabController) \r\n        {\r\n            rankTabController.selectTab(0);\r\n        }\r\n\r\n        this.dailyRank.string = oops.language.getLangByID(\"stringres_086\");\r\n        this.canteenRank.string = oops.language.getLangByID(\"stringres_087\");\r\n        this.ShowAllUserNum();\r\n\r\n        let RankList = RankMgr.RankData[RankMgr.compositeKey(params.rankType, params.rankConfId)]\r\n        if (RankList) \r\n        {\r\n            this.ShowRank(params.rankType, params.rankConfId, RankList);\r\n            RankMgr.GetRankData(params.rankType, params.rankConfId);\r\n            RankMgr.GetRankDataBack();\r\n            this.ShowUserHead();\r\n        }\r\n        else\r\n        {\r\n            const data: { [key: string]: any } = {};\r\n            data.rankType = params.rankType;\r\n            data.rankConfId = params.rankConfId;\r\n            const param = JSON.stringify(data);\r\n            var completeRank = (ret: HttpReturn) => {\r\n                if (ret.isSucc && ret.res)\r\n                {\r\n                    RankMgr.allUserNumber = ret.res.allUserNumber;\r\n                    this.ShowAllUserNum();\r\n                    RankMgr.RankData[RankMgr.compositeKey(ret.res.rankTyppe, ret.res.rankConfId)] = ret.res.list;\r\n                    if (ret.res.rankTyppe == '1')\r\n                    {\r\n                        RankMgr.myInfoTuzi = ret.res.myInfo\r\n                    }\r\n                    else if (ret.res.rankTyppe == '2')\r\n                    {\r\n                        RankMgr.myInfoCanting = ret.res.myInfo\r\n                    }\r\n                    this.ShowRank(ret.res.rankTyppe, ret.res.rankConfId, ret.res.list);\r\n                    RankMgr.GetRankDataBack();\r\n                    this.ShowUserHead();\r\n                }\r\n            }\r\n            ProtocolMgr.sendRankList(completeRank, param);\r\n        }\r\n        oops.message.on(GameEvent.SwitchRank, this.onUpdateData, this);\r\n        return true;\r\n    }\r\n    private ShowAllUserNum()\r\n    {\r\n        if (RankMgr.allUserNumber > 0)\r\n        {\r\n            if (RankMgr.allUserNumber > 999)\r\n            {\r\n                this.allUserNum.string = oops.language.getLangByID(\"stringres_206\");\r\n            }\r\n            else\r\n            {\r\n                this.allUserNum.string = RankMgr.allUserNumber.toString();\r\n            }    \r\n        }\r\n    }\r\n\r\n    private ShowUserHead() {\r\n        this.userHeadImageBacks.forEach((BackNode, index) => {\r\n            BackNode.active = false;\r\n        });\r\n\r\n        let userList = RankMgr.GetUserImageList()\r\n        for (let i = 0; i < userList.length; i++)\r\n        {\r\n            this.userHeadImageBacks[i].active = true;\r\n            UtilMgr.ShowUserHead(userList[i], this.userHeadImages[i]);\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        oops.message.off(GameEvent.SwitchRank, this.onUpdateData, this);\r\n    }\r\n\r\n    private onUpdateData(event: string, args: any) {\r\n        switch (event) {\r\n            case GameEvent.SwitchRank:\r\n                this.OnSwitchRank(RankMgr.curRankConfId);\r\n                break;\r\n        }\r\n    }\r\n    private ShowRank(rankType:number, rankConfId: number, rankList:any) \r\n    {\r\n        if (rankType == 1)\r\n        {//兔子币榜\r\n            let Data = RankMgr.GetRankDataByLevel(rankConfId);\r\n            if (Data)\r\n            {\r\n                UtilMgr.SetImage(this.duanweiIcon, Data.bigrankicon);\r\n                UtilMgr.SetImage(this.duanweiBackImage, Data.rankpic);\r\n                this.duanweiName.string = oops.language.getLangByID(Data.rankname);\r\n                this.duanweiNum.string = StringUtil.substitute_1(oops.language.getLangByID(\"stringres_184\"), Data.lower.toString());\r\n                this.ShowTuziRank(rankConfId, rankList);\r\n            }\r\n        }\r\n        else if (rankType == 2)\r\n        {//餐厅等级榜\r\n            let Data = RankMgr.GetRankDataByLevel(rankConfId);\r\n            if (Data)\r\n            {\r\n                UtilMgr.SetImage(this.duanweiIcon, Data.bigrankicon);\r\n                UtilMgr.SetImage(this.duanweiBackImage, Data.rankpic);\r\n                this.duanweiName.string = oops.language.getLangByID(Data.rankname);\r\n                this.duanweiNum.string = StringUtil.substitute_1(oops.language.getLangByID(\"stringres_198\"), Data.canteenranklower.toString());\r\n                this.ShowCantingRank(rankConfId, rankList);\r\n            }\r\n        }\r\n    }\r\n\r\n    private OnSwitchRank(RankConfId:number) {\r\n        let RankList = RankMgr.RankData[RankMgr.compositeKey(RankMgr.curRankType, RankConfId)]\r\n        if (RankList) \r\n        {\r\n            this.ShowAllUserNum();\r\n            this.ShowRank(RankMgr.curRankType, RankConfId, RankList);\r\n        }\r\n        else\r\n        {\r\n            RankMgr.GetRankData(RankMgr.curRankType, RankConfId);\r\n        }\r\n    }\r\n\r\n    private IsRankListHasMyInfo(rankList, myInfo)\r\n    {\r\n        for (const id in rankList) {\r\n            let RankData = rankList[id];\r\n            if (RankData.userId == myInfo.userId)\r\n            {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private ShowTuziRank(rankConfId, rankList) {\r\n        if (rankList !== null && rankList !== undefined && Array.isArray(rankList) && rankList.length && rankList.length > 0)\r\n        {\r\n            this._tuziRankDataList = [];\r\n            for (const id in rankList) {\r\n                let RankData = rankList[id];\r\n                this._tuziRankDataList.push(RankData);\r\n            }\r\n            if (RankMgr.myInfoTuzi.rankConfId == rankConfId && this.IsRankListHasMyInfo(rankList, RankMgr.myInfoTuzi))\r\n            {\r\n                RankMgr.myInfoTuzi.userId = TonGameMgr.UserId;\r\n                this._tuziRankDataList.push(RankMgr.myInfoTuzi);\r\n            }\r\n            this.refreshTuziRankGridList();\r\n        }\r\n        else{\r\n            this.refreshTuziRankGridList();\r\n            this.tuziRankGridList.clearList();\r\n        }\r\n    }\r\n\r\n    refreshTuziRankGridList() {\r\n        /*  paddingTop: 列表距离上边缘距离 默认为0\r\n        paddingBottom: 列表距离下边缘距离 默认为0\r\n        spacingX: 列间距 默认为3\r\n        spacingY: 行间距 默认为3\r\n        columnNum: 列数 默认为0，自动适配容器宽度\r\n        useVirtualLayout: 是否启用虚拟列表 默认为true\r\n        emptyTip: 没有数据显示提示\r\n        cacheImage: 是否缓存列表中加载过的图片，控件回收后，图片缓存将被全部释放。\r\n     */\r\n\r\n        if (this.tuziRankGridList) {\r\n            this.tuziRankGridList.clearList();\r\n            this.tuziRankGridList.initGridList({\r\n                paddingTop: 10,\r\n                paddingBottom: 10,\r\n                spacingX: 10,\r\n                spacingY: 5,\r\n                columnNum: 1,\r\n                useVirtualLayout: true,\r\n                emptyTip: oops.language.getLangByID(\"stringres_088\"),\r\n                cacheImage: true\r\n            });\r\n            this.tuziRankGridList.appendItemsToDisplayList(this._tuziRankDataList);\r\n        }\r\n    }\r\n\r\n    private ShowCantingRank(rankConfId, rankList) {\r\n        if (rankList !== null && rankList !== undefined && Array.isArray(rankList) && rankList.length && rankList.length > 0)\r\n        {\r\n            this._cantingRankDataList = [];\r\n            for (const id in rankList) {\r\n                let RankData = rankList[id];\r\n                this._cantingRankDataList.push(RankData);\r\n            }\r\n            if (RankMgr.myInfoCanting.rankConfId == rankConfId && this.IsRankListHasMyInfo(rankList, RankMgr.myInfoCanting))\r\n            {\r\n                RankMgr.myInfoCanting.userId = TonGameMgr.UserId;\r\n                this._tuziRankDataList.push(RankMgr.myInfoCanting);\r\n            }\r\n            this.refreshCantingRankGridList();\r\n        }\r\n        else{\r\n            this.refreshCantingRankGridList();\r\n            this.cantingRankGridList.clearList();\r\n        }\r\n\r\n    }\r\n\r\n    refreshCantingRankGridList() {\r\n        /*  paddingTop: 列表距离上边缘距离 默认为0\r\n        paddingBottom: 列表距离下边缘距离 默认为0\r\n        spacingX: 列间距 默认为3\r\n        spacingY: 行间距 默认为3\r\n        columnNum: 列数 默认为0，自动适配容器宽度\r\n        useVirtualLayout: 是否启用虚拟列表 默认为true\r\n        emptyTip: 没有数据显示提示\r\n        cacheImage: 是否缓存列表中加载过的图片，控件回收后，图片缓存将被全部释放。\r\n     */\r\n\r\n        if (this.cantingRankGridList) {\r\n            this.cantingRankGridList.clearList();\r\n            this.cantingRankGridList.initGridList({\r\n                paddingTop: 10,\r\n                paddingBottom: 10,\r\n                spacingX: 10,\r\n                spacingY: 5,\r\n                columnNum: 1,\r\n                useVirtualLayout: true,\r\n                emptyTip: oops.language.getLangByID(\"stringres_088\"),\r\n                cacheImage: true\r\n            });\r\n            this.cantingRankGridList.appendItemsToDisplayList(this._cantingRankDataList);\r\n        }\r\n    }\r\n\r\n    public onLeft() {\r\n        UtilMgr.PlaySoundEffect(25);\r\n        let RankData = RankMgr.GetRankDataByLevel(RankMgr.curRankConfId-1);\r\n        if (RankData)\r\n        {\r\n            RankMgr.curRankConfId = RankMgr.curRankConfId - 1;\r\n            this.OnSwitchRank(RankMgr.curRankConfId);\r\n        }\r\n        else\r\n        {\r\n            RankMgr.curRankConfId = RankMgr.GetMaxRankLevelId();\r\n            this.OnSwitchRank(RankMgr.curRankConfId);\r\n        }\r\n    }\r\n\r\n    public onRight() {\r\n        UtilMgr.PlaySoundEffect(25);\r\n        let RankData = RankMgr.GetRankDataByLevel(RankMgr.curRankConfId+1);\r\n        if (RankData)\r\n        {\r\n            RankMgr.curRankConfId = RankMgr.curRankConfId + 1;\r\n            this.OnSwitchRank(RankMgr.curRankConfId);\r\n        }\r\n        else\r\n        {\r\n            RankMgr.curRankConfId = 1;\r\n            this.OnSwitchRank(RankMgr.curRankConfId);\r\n        }\r\n    }\r\n\r\n    public onClose() {\r\n        UtilMgr.PlaySoundEffect(19);\r\n        oops.gui.remove(UIID.Rank);\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}