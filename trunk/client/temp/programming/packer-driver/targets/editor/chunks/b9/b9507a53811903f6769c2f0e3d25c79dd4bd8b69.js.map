{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/manager/TonGameManager.ts"],"names":["TonGameManager","director","Node","oops","UIID","GameEvent","EncryptUtil","TonTimerManager","BoardMgr","UtilMgr","HeChengMgr","HeChengComponent","RoleMgr","LiWuMgr","GuideMgr","ProtocolMgr","WebSocketMgr","TableIngredients","AcceleratedBuffMgr","GameUtils","FeedMgr","AcceleratedBuffMain","ShopMgr","GAME_STORE_KEY","GAME_Board_KEY","DAILY_REWARD_DATA","USER_UniqueID","GAME_DEFAULT_TUZICOIN","AutoTypeEnum","IsMute","CurBGM","IsEnglish","IsTelegramUser","TGHash","TelegramReferrer","DataVersionNum","UserId","UserName","CanTingLevel","TuZiCoin","CarrotCoin","CanTingGain","AddtionGain","AcceAddtionGain_1","AcceAddtionGain_2","CurRabbitId","CurRabbitAnimation","RabbitIdList","TuZiTotalCoin","CarrotTotalCoin","LastRecoverTuziCoin","CanTingExp","GiftNum","AutoType","NoBuy","LastSavedTimestamp","ramdonToken","TgBotToken","rankConfId","tuZiCoinRankIds","persist","save_data","save_data_local","_key","_iv","totaltimes","_tsIngredients","init","setDataDefault","initKey","config","game","localDataKey","localDataIv","addPersistRootNode","completeLogin","ret","isSucc","Func","parseMapString","res","func","HasBuyButClose","userName","serverTimeStamp","timer","setServerTime","TonGameMgr","updateCarrotCoin","carrotCoin","message","dispatchEvent","LoginSuccess","timerMgr","addComponent","on","UpdateBoardGrid","onUpdateData","Save","onLogin","connectWebSocket","getTgBotToken","keepScreenAwake","getOrCreateUniqueID","substring","storage","setUser","data","userID","channel","token","inviter","param","JSON","stringify","sendLogin","event","args","updateCanTingGain","save","serverData","load","canTingGain","index","board","length","cell","SuCaiId","getmoney","HechengGUI","gui","get","MainUI","HechengCom","getComponent","ShowCanTingGainNum","UpdateBaseData","GetSuCaiLevel","suCaiId","level","GetRealCanTingGain","Math","floor","OnOneSecondUpdate","tempgain","OfflineAccelerateGain","updateRabbitCoin","BigInt","UpdateAccelerateTime","UpdateNextFreeDishTime","RefreshBuffIcon","buffGUI","AcceleratedBuffBuyMain","buffCom","OnTwoSecondUpdate","OnHandleAuto","OnFiveSecondUpdate","UpdateTuziCoin","UpdateLiWu","UpdateGuide","UpdateVisitors","OnTenSecondUpdate","sendPing","OnSixtySecondUpdate","key","iv","md5","generateUUID","pattern","replace","c","r","random","v","toString","uniqueID","set","GetFreeBuffTimeStamp","IsGetFreeBuff","GetShareBuffTimeStamp","IsGetShareBuff","AcceleratedList_1","AcceleratedList_2","FreeDishId","NextFreeDishTime","HechengMaxLevel","ExtDishPrice","currentTimestampInSeconds","getServerTime","saveToServer","value","e","completeSave","console","log","baseData","boardData","getBoardListString","sendSave","loadFromServer","parse","setData","loadFromLocal","clearLocalData","remove","getJson","GetRandomAnimation","newdate","Date","istoday","isToday","lixianTime","usetime","RefreshData","lixianShouyi","params","LixianTime","LixianShouyi","open","UpdateCarrotCoin","modifyGiftNum","checkMidnight","now","getServerDate","hours","getHours","minutes","getMinutes","completeTgBotToken","sendGetTgBotToken","switchLanguage","language","setLanguage"],"mappings":"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","sourcesContent":["\r\nimport { director, Node } from \"cc\";\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { EncryptUtil } from \"../../../../extensions/oops-plugin-framework/assets/core/utils/EncryptUtil\";\r\n\r\nimport { TonTimerManager } from \"./TonTimerManager\";\r\nimport { BoardMgr } from \"./BoardManager\";\r\nimport { UtilMgr } from \"./UtilManager\";\r\nimport { HeChengMgr } from \"../hecheng/HeChengManager\";\r\nimport { HeChengComponent } from \"../hecheng/HeChengComponent\";\r\nimport { RoleMgr } from \"../role/RoleManager\";\r\nimport { LiWuMgr } from \"../liwu/LiWuManager\";\r\nimport { GuideMgr } from \"../hecheng/GuideManager\";\r\nimport { ProtocolMgr } from \"./ProtocolManager\";\r\nimport { WebSocketMgr } from \"./WebSocketManager\";\r\nimport { HttpReturn } from \"../../../../extensions/oops-plugin-framework/assets/libs/network/HttpRequest\";\r\n\r\nimport { TableIngredients } from \"../../framework/common/table/TableIngredients\";\r\nimport { AcceleratedBuffMgr } from \"../acceleratedbuff/AcceleratedBuffManager\";\r\nimport GameUtils from \"../../../resources/libs/utils/utils\";\r\nimport { FeedMgr } from \"../feed/FeedManager\";\r\nimport { AcceleratedBuffMain } from \"../acceleratedbuff/AcceleratedBuffMain\";\r\nimport { ShopMgr } from \"../shop/ShopManager\";\r\n\r\nconst GAME_STORE_KEY = \"ton_game\";\r\nconst GAME_Board_KEY = \"ton_board\";\r\nconst DAILY_REWARD_DATA = \"dailyRewardData\";\r\n\r\nconst USER_UniqueID = \"uniqueID\";\r\n\r\nconst GAME_DEFAULT_TUZICOIN = 10000n;\r\n\r\nexport enum AutoTypeEnum {\r\n    NoBuy,                  //没有购买自动功能\r\n    HasBuyAndOpen,          //已经购买自动功能，并且开启自动\r\n    HasBuyButClose,         //已经购买自动功能，但是关闭自动\r\n}\r\n\r\nexport class TonGameManager {\r\n    // 是否静音\r\n    public IsMute : boolean = false;\r\n    // 当前播放的BGM\r\n    public CurBGM = 0;\r\n\r\n    private IsEnglish : boolean = true;\r\n    //是否是telegram的用户\r\n    public IsTelegramUser : boolean = false;\r\n\r\n    public TGHash : string = \"\";\r\n    public TelegramReferrer : string = \"\";\r\n\r\n    /** 数据版本号 */\r\n    public DataVersionNum : bigint = 0n;\r\n\r\n    /** 用户 */\r\n    public UserId : string = \"\";\r\n\r\n    /** 用户名字 */\r\n    public UserName : string = \"\";\r\n\r\n    /** 餐厅等级 */\r\n    public CanTingLevel : number = 1;\r\n\r\n    /** 兔子币 */\r\n    public TuZiCoin : bigint = 0n;\r\n\r\n    /** 萝卜币 */\r\n    public CarrotCoin : number = 0;\r\n\r\n    /** 餐厅收益(每秒获得的兔子币数量) */\r\n    public CanTingGain : number = 0;\r\n\r\n    /** 餐厅收益的加成百分比 0.3为30% （通过从商城购买兔子添加） */\r\n    public AddtionGain : number = 0;\r\n\r\n    /** 餐厅收益的加成百分比 0.3为30% （通过加速功能添加包括免费领取，直接购买和分享领取） */\r\n    public AcceAddtionGain_1 : number = 0;\r\n\r\n    /** 每秒额外获得的兔子币 （通过加速功能添加包括免费领取，直接购买和分享领取） */\r\n    public AcceAddtionGain_2 : number = 0;\r\n\r\n    /** 当前装备的兔子 */\r\n    public CurRabbitId : number = 0;\r\n    public CurRabbitAnimation : string = null;\r\n\r\n    /** 当前已购买的兔子 */\r\n    public RabbitIdList: any[] = [];\r\n\r\n    /** 累计获得兔子币 */\r\n    public TuZiTotalCoin : bigint = 0n;\r\n\r\n    /** 累积获得萝卜币 */\r\n    public CarrotTotalCoin : number = 0;\r\n\r\n    /** 上次回收获得的兔子币的值 */\r\n    public LastRecoverTuziCoin : number = 0;\r\n\r\n    /** 餐厅经验 */\r\n    public CanTingExp : number = 0;\r\n\r\n    /** 商店购买的礼盒数量 */\r\n    public GiftNum : number = 0;\r\n\r\n    /** 自动类型 */\r\n    public AutoType:AutoTypeEnum = AutoTypeEnum.NoBuy;\r\n\r\n    //上次存盘时间戳\r\n    private LastSavedTimestamp : number = 0;\r\n\r\n    public ramdonToken : string = \"\";\r\n    public TgBotToken : string = \"\";\r\n\r\n    //玩家兔子币的段位\r\n    public rankConfId : number = 1;\r\n    //玩家兔子币榜的排名\r\n    public tuZiCoinRankIds : number = 0;\r\n\r\n\r\n    private persist: Node = null!\r\n    static timerMgr: TonTimerManager;\r\n\r\n    private save_data: any = {};\r\n    private save_data_local: any = {};\r\n    private _key: string | null = null;\r\n    private _iv: string | null = null;\r\n\r\n    public totaltimes : number = 0;\r\n\r\n    private _tsIngredients = new TableIngredients();\r\n\r\n    public init() {\r\n        BoardMgr.setDataDefault();\r\n        this.initKey(oops.config.game.localDataKey, oops.config.game.localDataIv);\r\n        this.persist = new Node(\"TonGameManagerNode\");\r\n        director.addPersistRootNode(this.persist);\r\n\r\n        var completeLogin = (ret: HttpReturn) => {\r\n            if (ret.isSucc)\r\n            {\r\n                let Func = UtilMgr.parseMapString(ret.res.func);\r\n                if (Func[1] && Func[1] > 0)\r\n                {\r\n                    this.AutoType = AutoTypeEnum.HasBuyButClose;\r\n                }\r\n                else\r\n                {\r\n                    this.AutoType = AutoTypeEnum.NoBuy;\r\n                }\r\n\r\n                this.UserName = ret.res.userName;\r\n                this.ramdonToken = ret.res.ramdonToken;\r\n                this.LastSavedTimestamp = ret.res.serverTimeStamp/1000;\r\n                oops.timer.setServerTime(ret.res.serverTimeStamp);\r\n\r\n                TonGameMgr.updateCarrotCoin(ret.res.carrotCoin);\r\n                TonGameMgr.rankConfId = ret.res.rankConfId;\r\n                TonGameMgr.tuZiCoinRankIds = ret.res.tuZiCoinRankIds;\r\n                oops.message.dispatchEvent(GameEvent.LoginSuccess);\r\n                TonGameManager.timerMgr = this.persist.addComponent(TonTimerManager)!;\r\n                oops.message.on(GameEvent.UpdateBoardGrid, this.onUpdateData, this);\r\n                oops.message.on(GameEvent.Save, this.onUpdateData, this);\r\n\r\n                TonGameMgr.onLogin(ret.res);\r\n                //建立websocket 连接\r\n                WebSocketMgr.connectWebSocket(this.UserId);\r\n\r\n                this.getTgBotToken();\r\n                UtilMgr.keepScreenAwake();\r\n            }\r\n        }\r\n\r\n        //获取唯一账号id\r\n        if (!this.IsTelegramUser)\r\n        {\r\n            this.UserId = this.getOrCreateUniqueID();\r\n            this.UserName = \"User_\"+ this.UserId.substring(0, 8);\r\n            oops.storage.setUser(this.UserId);\r\n        }\r\n\r\n        const data: { [key: string]: any } = {};\r\n        data.userID = this.UserId;\r\n        data.channel = 1;\r\n        data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n        /* 分享者Id */\r\n        data.inviter = TonGameMgr.TelegramReferrer;\r\n\r\n        const param = JSON.stringify(data);\r\n\r\n        //oops.gui.toast(\"userid: \" + data.userID + \"\\ninviterID:\" + data.inviter, true);\r\n\r\n        ProtocolMgr.sendLogin(completeLogin, param);\r\n    }\r\n\r\n    private onUpdateData(event: string, args: any) {\r\n        switch (event) {\r\n            case GameEvent.UpdateBoardGrid:\r\n                this.updateCanTingGain();\r\n                break;\r\n            case GameEvent.Save:\r\n                this.save();\r\n                break;\r\n        }\r\n    }\r\n\r\n    public onLogin(serverData)\r\n    {\r\n        this.load(serverData);\r\n    }\r\n\r\n    //更新餐厅收益\r\n    public updateCanTingGain()\r\n    {\r\n        let canTingGain = 0;\r\n        for (let index = 0; index < BoardMgr.board.length; index++) {\r\n            const cell = BoardMgr.board[index];\r\n            if (cell.SuCaiId > 0)\r\n            {\r\n                this._tsIngredients.init(cell.SuCaiId);\r\n                canTingGain = canTingGain + this._tsIngredients.getmoney;\r\n            }\r\n        }\r\n        if (canTingGain > this.CanTingGain)\r\n        {\r\n            const HechengGUI = oops.gui.get(UIID.MainUI);\r\n            if (HechengGUI) {\r\n                const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n                if (HechengCom) {\r\n                    HechengCom.ShowCanTingGainNum();\r\n                }\r\n            }\r\n        }\r\n        this.CanTingGain = canTingGain;\r\n        oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n    }\r\n\r\n    public GetSuCaiLevel(suCaiId) : number {\r\n        this._tsIngredients.init(suCaiId);\r\n        return this._tsIngredients.level;\r\n    }\r\n\r\n    // 获取实际餐厅收益 速率*(1+速率加成) \r\n    public GetRealCanTingGain() {\r\n        return Math.floor((this.CanTingGain+this.AcceAddtionGain_2)*(1+this.AddtionGain+this.AcceAddtionGain_1)+0.5);\r\n    }\r\n\r\n    //每1秒执行一次\r\n    public OnOneSecondUpdate() {\r\n        let tempgain = AcceleratedBuffMgr.OfflineAccelerateGain(1);\r\n        this.updateRabbitCoin(this.TuZiCoin + BigInt(tempgain));\r\n\r\n        AcceleratedBuffMgr.UpdateAccelerateTime();\r\n        FeedMgr.UpdateNextFreeDishTime();\r\n\r\n        const HechengGUI = oops.gui.get(UIID.MainUI);\r\n        if (HechengGUI) {\r\n            const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n            if (HechengCom) {\r\n                HechengCom.RefreshBuffIcon();\r\n            }\r\n        }\r\n        const buffGUI = oops.gui.get(UIID.AcceleratedBuffBuyMain);\r\n        if (buffGUI) {\r\n            const buffCom = buffGUI.getComponent(AcceleratedBuffMain);\r\n            if (buffCom) {\r\n                buffCom.RefreshBuffIcon();\r\n            }\r\n        }\r\n    }\r\n\r\n    //每2秒执行一次\r\n    public OnTwoSecondUpdate() {\r\n        HeChengMgr.OnHandleAuto();\r\n    }\r\n\r\n    //每5秒执行一次\r\n    public OnFiveSecondUpdate() {\r\n        oops.message.dispatchEvent(GameEvent.UpdateTuziCoin);\r\n        this.save();\r\n        \r\n        LiWuMgr.UpdateLiWu();\r\n        GuideMgr.UpdateGuide();\r\n\r\n        RoleMgr.UpdateVisitors();\r\n    }\r\n    \r\n    //每10秒执行一次\r\n    public OnTenSecondUpdate() {\r\n        WebSocketMgr.sendPing();\r\n\r\n    }\r\n\r\n    //每60秒执行一次\r\n    public OnSixtySecondUpdate() {\r\n        \r\n    }\r\n\r\n    initKey(key: string, iv: string) {\r\n        this._key = EncryptUtil.md5(key);\r\n        this._iv = EncryptUtil.md5(iv);\r\n    }\r\n\r\n    private generateUUID() {\r\n        const pattern = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\r\n        return pattern.replace(/[xy]/g, (c) => {\r\n            const r = Math.random() * 16 | 0;\r\n            const v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    }\r\n\r\n    private getOrCreateUniqueID() {\r\n        let uniqueID = oops.storage.get(USER_UniqueID);\r\n        if (!uniqueID || uniqueID == \"\") {\r\n            uniqueID = this.generateUUID();\r\n            oops.storage.set(USER_UniqueID, uniqueID);\r\n        }\r\n        return uniqueID;\r\n    }\r\n\r\n    public save() {\r\n        this.DataVersionNum = this.DataVersionNum + BigInt(1);\r\n        this.save_data.DataVersionNum = this.DataVersionNum.toString();\r\n        this.save_data.CanTingLevel = this.CanTingLevel;\r\n        this.save_data.TuZiCoin = this.TuZiCoin.toString();\r\n        this.save_data.CanTingGain = this.CanTingGain;\r\n        this.save_data.CanTingExp = this.CanTingExp;\r\n        this.save_data.GiftNum = this.GiftNum;\r\n        this.save_data.AddtionGain = this.AddtionGain;\r\n        this.save_data.CurRabbitId = this.CurRabbitId;\r\n        this.save_data.RabbitIdList = this.RabbitIdList;\r\n        this.save_data.GetFreeBuffTimeStamp = AcceleratedBuffMgr.GetFreeBuffTimeStamp;\r\n        this.save_data.IsGetFreeBuff = AcceleratedBuffMgr.IsGetFreeBuff;\r\n        this.save_data.GetShareBuffTimeStamp = AcceleratedBuffMgr.GetShareBuffTimeStamp;\r\n        this.save_data.IsGetShareBuff = AcceleratedBuffMgr.IsGetShareBuff;\r\n        this.save_data.AcceleratedList_1 = AcceleratedBuffMgr.AcceleratedList_1;\r\n        this.save_data.AcceleratedList_2 = AcceleratedBuffMgr.AcceleratedList_2;\r\n        this.save_data.FreeDishId = FeedMgr.FreeDishId;\r\n        this.save_data.NextFreeDishTime = FeedMgr.NextFreeDishTime;\r\n        this.save_data.HechengMaxLevel = FeedMgr.HechengMaxLevel;\r\n        this.save_data.ExtDishPrice = FeedMgr.ExtDishPrice;\r\n        this.save_data.LastRecoverTuziCoin = TonGameMgr.LastRecoverTuziCoin\r\n\r\n        const currentTimestampInSeconds: number = Math.floor(oops.timer.getServerTime() / 1000);\r\n        this.save_data.LastSavedTimestamp = currentTimestampInSeconds;\r\n\r\n        this.saveToServer(this.save_data);\r\n\r\n        oops.storage.set(GAME_STORE_KEY, this.save_data);\r\n        BoardMgr.save();\r\n    }\r\n\r\n    saveToServer(value: any) {\r\n        try {\r\n            value = JSON.stringify(value);\r\n        }\r\n        catch (e) {\r\n            return;\r\n        }\r\n\r\n        var completeSave = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n        }\r\n\r\n        const data: { [key: string]: any } = {};\r\n        data.userID = this.UserId;\r\n        data.carrotCoin = this.CarrotCoin;\r\n        data.baseData = value;\r\n        data.boardData = BoardMgr.getBoardListString();\r\n        data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n\r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendSave(completeSave, param);\r\n    }\r\n\r\n    load(serverData) {\r\n        this.loadFromServer(serverData);\r\n    }\r\n\r\n    loadFromServer(serverData) {\r\n        if (serverData)\r\n        {\r\n            if (serverData.userID == this.UserId)\r\n            {\r\n                try {\r\n                    this.save_data = JSON.parse(serverData.baseData);\r\n                    this.setData();\r\n                    BoardMgr.load(serverData);\r\n                    this.loadFromLocal();\r\n                } catch (e) {\r\n                    this.clearLocalData();\r\n                    this.setDataDefault();\r\n                    BoardMgr.load(serverData);\r\n                }   \r\n            }\r\n            else\r\n            {\r\n                this.setDataDefault();\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.setDataDefault();\r\n        }\r\n    }\r\n\r\n    clearLocalData()\r\n    {\r\n        oops.storage.remove(DAILY_REWARD_DATA);\r\n        oops.storage.remove(GAME_Board_KEY);\r\n        oops.storage.remove(GAME_STORE_KEY);\r\n    }\r\n\r\n    loadFromLocal(){\r\n        this.save_data_local = oops.storage.getJson(GAME_STORE_KEY);\r\n        if (this.save_data_local) {\r\n           if (this.save_data_local.DataVersionNum > this.save_data.DataVersionNum)\r\n           {\r\n                this.save_data = this.save_data_local;\r\n                this.setData();\r\n                BoardMgr.loadFromLocal();\r\n           }\r\n        }\r\n    }\r\n\r\n    private setData() {\r\n        this.DataVersionNum = BigInt(this.save_data.DataVersionNum);\r\n        this.CanTingLevel = this.save_data.CanTingLevel;\r\n        this.TuZiCoin = BigInt(this.save_data.TuZiCoin);\r\n        this.CanTingGain = this.save_data.CanTingGain;\r\n        this.CanTingExp = this.save_data.CanTingExp;\r\n        this.GiftNum = this.save_data.GiftNum;\r\n        this.AddtionGain = this.save_data.AddtionGain;\r\n        if (!this.save_data.AddtionGain) {\r\n            this.AddtionGain = 0;\r\n        }\r\n        this.CurRabbitId = this.save_data.CurRabbitId;\r\n        if (!this.save_data.CurRabbitId) {\r\n            this.CurRabbitId = 0;\r\n            this.CurRabbitId = null;\r\n        } else {\r\n            this.CurRabbitAnimation = ShopMgr.GetRandomAnimation(this.save_data.CurRabbitId);\r\n        }\r\n        this.RabbitIdList = this.save_data.RabbitIdList;\r\n        if (!this.save_data.RabbitIdList) {\r\n            this.RabbitIdList = [];\r\n        }\r\n\r\n        AcceleratedBuffMgr.IsGetFreeBuff = this.save_data.IsGetFreeBuff;\r\n        if (!this.save_data.IsGetFreeBuff) {\r\n            AcceleratedBuffMgr.IsGetFreeBuff = false;\r\n        }\r\n        AcceleratedBuffMgr.GetFreeBuffTimeStamp = this.save_data.GetFreeBuffTimeStamp;\r\n        if (!this.save_data.GetFreeBuffTimeStamp) {\r\n            AcceleratedBuffMgr.GetFreeBuffTimeStamp = 0;\r\n        }\r\n        AcceleratedBuffMgr.IsGetShareBuff = this.save_data.IsGetShareBuff;\r\n        if (!this.save_data.IsGetShareBuff) {\r\n            AcceleratedBuffMgr.IsGetShareBuff = false;\r\n        }\r\n        AcceleratedBuffMgr.GetShareBuffTimeStamp = this.save_data.GetShareBuffTimeStamp;\r\n        if (!this.save_data.GetShareBuffTimeStamp) {\r\n            AcceleratedBuffMgr.GetShareBuffTimeStamp = 0;\r\n        }\r\n        AcceleratedBuffMgr.AcceleratedList_1 = this.save_data.AcceleratedList_1;\r\n        if (!this.save_data.AcceleratedList_1) {\r\n            AcceleratedBuffMgr.AcceleratedList_1 = [];\r\n        }\r\n        AcceleratedBuffMgr.AcceleratedList_2 = this.save_data.AcceleratedList_2;\r\n        if (!this.save_data.AcceleratedList_2) {\r\n            AcceleratedBuffMgr.AcceleratedList_2 = [];\r\n        }\r\n\r\n        FeedMgr.FreeDishId = this.save_data.FreeDishId;\r\n        if (!this.save_data.FreeDishId) {\r\n            FeedMgr.FreeDishId = 0;\r\n        }\r\n        FeedMgr.NextFreeDishTime = this.save_data.NextFreeDishTime;\r\n        if (!this.save_data.NextFreeDishTime) {\r\n            FeedMgr.NextFreeDishTime = 0;\r\n        }\r\n        FeedMgr.HechengMaxLevel = this.save_data.HechengMaxLevel;\r\n        if (!this.save_data.HechengMaxLevel) {\r\n            FeedMgr.HechengMaxLevel = [];\r\n        }\r\n        FeedMgr.ExtDishPrice = this.save_data.ExtDishPrice;\r\n        if (!this.save_data.ExtDishPrice) {\r\n            FeedMgr.ExtDishPrice = [];\r\n        }\r\n\r\n        this.LastRecoverTuziCoin = this.save_data.LastRecoverTuziCoin;\r\n        if (!this.save_data.LastRecoverTuziCoin) {\r\n            this.LastRecoverTuziCoin = 0;\r\n        }\r\n\r\n        if (this.save_data.LastSavedTimestamp)\r\n        {\r\n            this.LastSavedTimestamp = this.save_data.LastSavedTimestamp;\r\n        }\r\n\r\n        \r\n        if (AcceleratedBuffMgr.IsGetFreeBuff) {\r\n            let newdate = new Date(AcceleratedBuffMgr.GetFreeBuffTimeStamp);\r\n            let istoday = GameUtils.isToday(newdate);\r\n            if (!istoday) {\r\n                AcceleratedBuffMgr.IsGetFreeBuff = false;\r\n                AcceleratedBuffMgr.GetFreeBuffTimeStamp = 0;\r\n            }\r\n        }\r\n        if (AcceleratedBuffMgr.IsGetShareBuff) {\r\n            let newdate = new Date(AcceleratedBuffMgr.GetShareBuffTimeStamp);\r\n            let istoday = GameUtils.isToday(newdate);\r\n            if (!istoday) {\r\n                AcceleratedBuffMgr.IsGetShareBuff = false;\r\n                AcceleratedBuffMgr.GetShareBuffTimeStamp = 0;\r\n            }\r\n        }\r\n        \r\n        //计算离线收益\r\n        const currentTimestampInSeconds: number = Math.floor(oops.timer.getServerTime() / 1000);\r\n        let lixianTime = currentTimestampInSeconds - this.LastSavedTimestamp;\r\n        let usetime = lixianTime;\r\n        if (lixianTime > 14400)\r\n        {\r\n            //最多可累计4小时\r\n            usetime = 14400;\r\n        }\r\n\r\n        FeedMgr.RefreshData(usetime);\r\n\r\n        // let lixianShouyi = this.GetRealCanTingGain() * usetime;\r\n        let lixianShouyi = AcceleratedBuffMgr.OfflineAccelerateGain(usetime);\r\n        if (lixianShouyi > 0)\r\n        {\r\n            this.updateRabbitCoin(this.TuZiCoin + BigInt(lixianShouyi));\r\n\r\n            // 打开游戏主界面\r\n            let params: any = {};\r\n            params.LixianTime = lixianTime;\r\n            params.LixianShouyi = lixianShouyi;\r\n            oops.gui.open(UIID.MainUI, params);\r\n        }\r\n        else\r\n        {\r\n            // 打开游戏主界面\r\n            let params: any = {};\r\n            params.LixianTime = 0;\r\n            params.LixianShouyi = 0;\r\n            oops.gui.open(UIID.MainUI, params);\r\n        }\r\n    }\r\n\r\n    private setDataDefault() {\r\n        this.save_data = {};\r\n        //初始餐厅等级\r\n        this.CanTingLevel = 1;\r\n        //初始兔子币\r\n        this.TuZiCoin = GAME_DEFAULT_TUZICOIN;\r\n\r\n        this.CanTingExp = 0;\r\n        this.GiftNum = 0;\r\n        this.AddtionGain = 0;\r\n        this.CurRabbitId = 0;\r\n        this.RabbitIdList = [];\r\n\r\n        this.LastSavedTimestamp = 0;\r\n        // 打开游戏主界面\r\n        let params: any = {};\r\n        params.LixianTime = 0;\r\n        params.LixianShouyi = 0;\r\n        oops.gui.open(UIID.MainUI);\r\n    }\r\n\r\n    public updateRabbitCoin(value:bigint) {\r\n        if (value > this.TuZiTotalCoin) {\r\n            this.TuZiTotalCoin = value;\r\n        }\r\n        this.TuZiCoin = value;\r\n    }\r\n\r\n    public updateCarrotCoin(value:number) {\r\n        if (value > this.CarrotTotalCoin) {\r\n            this.CarrotTotalCoin = value;\r\n        }\r\n        this.CarrotCoin = value;\r\n        oops.message.dispatchEvent(GameEvent.UpdateCarrotCoin);\r\n    }\r\n\r\n    public modifyGiftNum(value:number) {\r\n        this.GiftNum = this.GiftNum + value;\r\n    }\r\n\r\n    //检测是否0点\r\n    private checkMidnight(): boolean {\r\n        const now = oops.timer.getServerDate();\r\n        const hours = now.getHours();\r\n        const minutes = now.getMinutes();\r\n    \r\n        // 如果当前时间是 00:00\r\n        return hours === 0 && minutes === 0;\r\n    }\r\n\r\n    private getTgBotToken() {\r\n        var completeTgBotToken = (ret: HttpReturn) => {\r\n            if (ret.isSucc)\r\n            {\r\n                this.TgBotToken = ret.res;\r\n            }\r\n        }\r\n\r\n        ProtocolMgr.sendGetTgBotToken(completeTgBotToken, \"\");\r\n    }\r\n\r\n    public switchLanguage()\r\n    {\r\n        if (this.IsEnglish) {\r\n            this.IsEnglish = false;\r\n            oops.language.setLanguage(\"zh\", () => { });\r\n        }\r\n        else {\r\n            this.IsEnglish = true;\r\n            oops.language.setLanguage(\"en\", () => { });\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport var TonGameMgr = new TonGameManager();"]}