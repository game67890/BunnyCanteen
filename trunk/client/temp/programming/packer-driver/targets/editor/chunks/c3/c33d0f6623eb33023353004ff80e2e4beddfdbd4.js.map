{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/cocos-telegram-miniapps/scripts/telegram-web.ts"],"names":["_decorator","sys","ccclass","property","tgLoadPromise","Promise","resolve","reject","platform","Platform","MOBILE_BROWSER","DESKTOP_BROWSER","script","document","createElement","src","async","onload","intervalId","setInterval","window","Telegram","WebApp","clearInterval","onerror","Error","head","appendChild","TelegramWebApp","constructor","_tgWebAppJS","Instance","_instance","init","success","openTelegramLink","url","console","error","share","text","shareUrl","URLSearchParams","toString","shareToStory","media_url","shareText","widget_link_url","widget_link_name","widget_link","name","getTelegramWebApp","getTelegramWebAppInitData","initDataUnsafe","getTelegramUser","user","getTelegramInitData","initData","openInvoice","callback","alert","message","showAlert"],"mappings":"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","sourcesContent":["import { _decorator, sys } from 'cc';\nconst { ccclass, property } = _decorator;\n\n\nconst tgLoadPromise = new Promise<any>((resolve, reject) => {\n    if (sys.platform === sys.Platform.MOBILE_BROWSER || sys.platform === sys.Platform.DESKTOP_BROWSER) {\n        const script = document.createElement(\"script\");\n        script.src = \"https://telegram.org/js/telegram-web-app.js\";\n        script.async = true;\n        script.onload = () => {\n            const intervalId = setInterval(() => {\n                if ((window as any).Telegram && (window as any).Telegram.WebApp) {\n                    resolve((window as any).Telegram.WebApp);\n                    clearInterval(intervalId);\n                }\n            }, 100);\n        };\n        script.onerror = () => reject(new Error(\"Unable to load TelegramWebApp SDK, please check logs.\"));\n        document.head.appendChild(script);\n    }\n});\n\nexport interface WebAppUser {\n    id: number;\n    is_bot: boolean;\n    first_name: string;\n    last_name?: string;\n    username?: string;\n    language_code?: string;\n    is_premium?: boolean;\n    added_to_attachment_menu?: boolean;\n    allows_write_to_pm?: boolean;\n    photo_url?: string;\n}\nexport interface WebAppChat {\n    id: number;\n    type: 'private' | 'group' | 'supergroup' | 'channel';\n    title: string;\n    username?: string;\n    photo_url?: string;\n}\nexport interface WebAppInitData {\n    query_id?: string;\n    user?: WebAppUser;\n    receiver?: WebAppUser;\n    chat?: WebAppChat;\n    chat_type?: 'private' | 'group' | 'supergroup' | 'channel';\n    chat_instance?: string;\n    start_param?: string;\n    can_send_after?: number;\n    auth_data: number;\n    hash: string;\n}\n\n@ccclass('TelegramWebApp')\nexport class TelegramWebApp {\n    private static _instance: TelegramWebApp;\n    private constructor() {\n\n    }\n    public static get Instance(): TelegramWebApp {\n        if (!TelegramWebApp._instance) {\n            TelegramWebApp._instance = new TelegramWebApp();\n        }\n        return TelegramWebApp._instance;\n    }\n\n    private _tgWebAppJS: any = null;\n    public async init(): Promise<{ success: boolean }> {\n        this._tgWebAppJS = await tgLoadPromise;\n\n        if (this._tgWebAppJS) {\n            return Promise.resolve({ success: true });\n        } else {\n            return Promise.resolve({ success: false });\n        }\n    }\n\n    public openTelegramLink(url: string) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        this._tgWebAppJS.openTelegramLink(url);\n    }\n\n    public share(url: string, text?: string) {\n        const shareUrl = 'https://t.me/share/url?url=' + url + '&' + new URLSearchParams({ text: text || '' }).toString();\n        this.openTelegramLink(shareUrl);\n    }\n\n    public shareToStory(media_url: string, shareText?: string, widget_link_url?: string, widget_link_name?: string) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return;\n        }\n        const widget_link = {\n            text: shareText,\n            widget_link: {\n                url: widget_link_url,\n                name: widget_link_name,\n            },\n        };\n        this._tgWebAppJS.shareToStory(media_url, widget_link);\n    }\n\n    public getTelegramWebApp() {\n        return this._tgWebAppJS;\n    }\n\n    public getTelegramWebAppInitData(): WebAppInitData {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initDataUnsafe;\n    }\n\n\n    public getTelegramUser(): WebAppUser {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initDataUnsafe.user;\n    }\n\n    public getTelegramInitData(): string {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        return this._tgWebAppJS.initData;\n    }\n\n    public openInvoice(url: string, callback: any) {\n        if (!this._tgWebAppJS) {\n            console.error(\"telegram web app is not inited!\");\n            return null;\n        }\n        this._tgWebAppJS.openInvoice(url, callback);\n    }\n\n    public alert(message: string) {\n        this._tgWebAppJS.showAlert(message);\n    }\n}\n\n\n"]}