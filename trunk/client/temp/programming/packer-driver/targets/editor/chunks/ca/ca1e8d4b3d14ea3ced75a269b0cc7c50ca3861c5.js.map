{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/shop/ShopManager.ts"],"names":["ShopManager","TonGameMgr","ProtocolMgr","TableShop","GameEvent","oops","UIID","HeChengComponent","UtilMgr","tablerecord","AnimationNum","IsHaveRabbitId","id","i","RabbitIdList","length","GetRandomAnimation","init","index","getRandomNumber","rabbitanimation","rabbitanimation2","SendBuyRabbit","confId","completeCBuy","ret","console","log","res","isSucc","Number","CurRabbitId","CurRabbitAnimation","ShopMgr","AddtionGain","effect","push","paytype","updateRabbitCoin","TuZiCoin","BigInt","price","updateCarrotCoin","CarrotCoin","PlaySoundEffect","sound","gui","toast","message","dispatchEvent","UpdateBaseData","UpdateTuziCoin","Save","OnShopListChange","HechengGUI","get","MainUI","HechengCom","getComponent","RefreshRabbitIcon","data","toString","userID","UserId","token","param","JSON","stringify","sendcbuyrabbit","SendAddCarrotCoin","count","completeCAddCarrotCoin","sendaddcarrotcion"],"mappings":"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","sourcesContent":["\r\nimport { HttpReturn } from '../../../../extensions/oops-plugin-framework/assets/libs/network/HttpRequest';\r\nimport { TonGameMgr } from '../manager/TonGameManager';\r\nimport { ProtocolMgr } from '../manager/ProtocolManager';\r\nimport { TableShop } from '../../framework/common/table/TableShop';\r\nimport { GameEvent } from '../../framework/common/config/GameEvent';\r\nimport { oops } from '../../../../extensions/oops-plugin-framework/assets/core/Oops';\r\nimport { UIID } from '../../framework/common/config/GameUIConfig';\r\nimport { HeChengComponent } from '../hecheng/HeChengComponent';\r\nimport { UtilMgr } from '../manager/UtilManager';\r\n\r\nexport class ShopManager {\r\n    private tablerecord = new TableShop();\r\n    private AnimationNum : number[] = [1, 2];\r\n\r\n    public IsHaveRabbitId(id:number) :boolean {\r\n        for (let i=0; i<TonGameMgr.RabbitIdList.length; i++) {\r\n            if (id == TonGameMgr.RabbitIdList[i]) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // 随机一个兔子动画\r\n    public GetRandomAnimation(id:number) {\r\n        this.tablerecord.init(id);\r\n        if (this.tablerecord && this.tablerecord.id && this.tablerecord.id > 0) {\r\n            let index = UtilMgr.getRandomNumber(this.AnimationNum);\r\n            if (index == 1) {\r\n                return this.tablerecord.rabbitanimation;\r\n            } else {\r\n                return this.tablerecord.rabbitanimation2;\r\n            }\r\n        }\r\n        \r\n\r\n        return \"\";\r\n    }\r\n\r\n    public SendBuyRabbit(confId:number) {\r\n        var completeCBuy = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n            if (ret.isSucc)\r\n            {\r\n                let tablerecord = new TableShop();\r\n                tablerecord.init(Number(ret.res.confId));\r\n                TonGameMgr.CurRabbitId = Number(ret.res.confId);\r\n                TonGameMgr.CurRabbitAnimation = ShopMgr.GetRandomAnimation(Number(ret.res.confId));\r\n                TonGameMgr.AddtionGain = TonGameMgr.AddtionGain + tablerecord.effect/100;\r\n                TonGameMgr.RabbitIdList.push(Number(ret.res.confId));\r\n                if (tablerecord.paytype == 1) {\r\n                    TonGameMgr.updateRabbitCoin(TonGameMgr.TuZiCoin - BigInt(tablerecord.price));\r\n                }\r\n                else if (tablerecord.paytype == 2) {\r\n                    TonGameMgr.updateCarrotCoin(TonGameMgr.CarrotCoin - tablerecord.price);\r\n                }\r\n                UtilMgr.PlaySoundEffect(tablerecord.sound);\r\n                oops.gui.toast(\"message_28\", true);\r\n                oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n                oops.message.dispatchEvent(GameEvent.UpdateTuziCoin);\r\n                oops.message.dispatchEvent(GameEvent.Save);\r\n                oops.message.dispatchEvent(GameEvent.OnShopListChange);\r\n\r\n                const HechengGUI = oops.gui.get(UIID.MainUI);\r\n                if (HechengGUI) {\r\n                    const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n                    if (HechengCom) {\r\n                        HechengCom.RefreshRabbitIcon();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    \r\n        const data: { [key: string]: any } = {};\r\n        data.confId = confId.toString();\r\n        data.userID = TonGameMgr.UserId;\r\n        data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n    \r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendcbuyrabbit(completeCBuy, param);\r\n    }\r\n\r\n    // 增加萝卜币指令协议\r\n    public SendAddCarrotCoin(count:number) {\r\n        var completeCAddCarrotCoin = (ret: HttpReturn) => {\r\n            console.log(ret.res);\r\n            if (ret.isSucc) {\r\n                TonGameMgr.updateCarrotCoin(TonGameMgr.CarrotCoin+Number(ret.res.count))\r\n                oops.message.dispatchEvent(GameEvent.UpdateBaseData);\r\n            }\r\n        }\r\n    \r\n        const data: { [key: string]: any } = {};\r\n        data.count = count.toString();\r\n        data.userID = TonGameMgr.UserId;\r\n        data.token = \"e10adc3949ba59abbe56e057f20f883e\";\r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendaddcarrotcion(completeCAddCarrotCoin, param);\r\n    }\r\n       \r\n}\r\n\r\nexport var ShopMgr = new ShopManager();\r\n"]}