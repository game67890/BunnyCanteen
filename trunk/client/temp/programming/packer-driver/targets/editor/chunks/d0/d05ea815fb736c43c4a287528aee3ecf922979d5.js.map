{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/task/TaskComponent.ts"],"names":["_decorator","Component","Sprite","Label","oops","UIID","UtilMgr","TaskMgr","TaskVirtualGridList","VirtualGridList","TonGameMgr","GameEvent","TaskTabController","ccclass","property","TaskComponent","_taskDataList","_achievementDataList","onAdded","params","taskTabController","node","getComponentInChildren","selectTab","taskLabel","string","language","getLangByID","achievementLabel","ShowUserHead","UserId","userHead","UserName","userNameLabel","substring","carrotCoinLabel","CarrotCoin","toString","ServerTaskList","ShowTaskList","GetTaskData","res","userName","taskList","JSON","parse","mission","achievementList","achievement","ServerAchievementList","message","on","UpdateCarrotCoin","onUpdateData","onDestroy","off","event","args","updateCarrotCoin","TaskCellList","GetTaskCelllist","TaskGroup","id","TaskData","ServerData","isFinished","progress","taskgroup","TitleId","TitleData","stringify","push","initTaskGridList","taskGridList","clearList","initGridList","paddingTop","paddingBottom","spacingX","spacingY","columnNum","useVirtualLayout","emptyTip","cacheImage","appendItemsToDisplayList","ShowAchievementList","AchievementCellList","GetAchievementCellList","AchievementData","initAchievementGridList","achievementGridList","onClose","PlaySoundEffect","gui","remove","Task"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, Label, ScrollView, instantiate, UITransform, Prefab, Vec3, Texture2D } from 'cc';\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\nimport { TaskMgr } from \"./TaskManager\";\r\nimport { TaskVirtualGridList } from \"./TaskVirtualGridList\";\r\nimport { VirtualGridList } from \"../../../resources/libs/virtual_grid_list/virtual_grid_list\";\r\nimport { TonGameMgr } from \"../manager/TonGameManager\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { TaskTabController } from \"./TaskTabController\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\n@ccclass('TaskComponent')\r\nexport class TaskComponent extends Component {\r\n\r\n    @property(Sprite)\r\n    userHead: Sprite = null;\r\n\r\n    @property(Label)\r\n    userNameLabel: Label = null;\r\n\r\n    @property(Label)\r\n    carrotCoinLabel: Label = null;\r\n\r\n    @property(Label)\r\n    taskLabel: Label = null;\r\n\r\n    @property(Label)\r\n    achievementLabel: Label = null;\r\n\r\n    @property(TaskVirtualGridList)\r\n    protected taskGridList: TaskVirtualGridList = null;\r\n\r\n    @property(VirtualGridList)\r\n    protected achievementGridList: VirtualGridList = null;\r\n\r\n    private _taskDataList: any[] = [];\r\n    private _achievementDataList: any[] = [];\r\n\r\n    onAdded(params: any): boolean {\r\n        const taskTabController = this.node.getComponentInChildren(TaskTabController);\r\n        if (taskTabController) \r\n        {\r\n            taskTabController.selectTab(0);\r\n        }\r\n        this.taskLabel.string = oops.language.getLangByID(\"stringres_115\");\r\n        this.achievementLabel.string = oops.language.getLangByID(\"stringres_116\");\r\n        UtilMgr.ShowUserHead(TonGameMgr.UserId, this.userHead);\r\n\r\n        if (TonGameMgr.UserName)\r\n        {\r\n            this.userNameLabel.string = TonGameMgr.UserName;\r\n        }\r\n        else\r\n        {\r\n            this.userNameLabel.string = \"User_\"+ TonGameMgr.UserId.substring(0, 8);\r\n        }\r\n        \r\n        this.carrotCoinLabel.string = TonGameMgr.CarrotCoin.toString();\r\n\r\n        if (TaskMgr.ServerTaskList)\r\n        {\r\n            this.ShowTaskList();\r\n            TaskMgr.GetTaskData();\r\n        }\r\n        else\r\n        {\r\n            TaskMgr.GetTaskData((res) => {\r\n                if (res.userName)\r\n                {\r\n                    this.userNameLabel.string = res.userName;\r\n                }\r\n                else\r\n                {\r\n                    this.userNameLabel.string = \"User_\"+ TonGameMgr.UserId.substring(0, 8);\r\n                }\r\n                TonGameMgr.UserName = res.userName;\r\n                let taskList = JSON.parse(res.mission);\r\n                let achievementList = JSON.parse(res.achievement);\r\n                TaskMgr.ServerTaskList = taskList;\r\n                TaskMgr.ServerAchievementList = achievementList;\r\n                this.ShowTaskList();\r\n            });\r\n        }\r\n\r\n        oops.message.on(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n        return true;\r\n    }\r\n\r\n    onDestroy() {\r\n        oops.message.off(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    private onUpdateData(event: string, args: any) {\r\n        switch (event) {\r\n            case GameEvent.UpdateCarrotCoin:\r\n                this.updateCarrotCoin();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private updateCarrotCoin()\r\n    {\r\n        this.carrotCoinLabel.string = TonGameMgr.CarrotCoin.toString();\r\n    }\r\n\r\n    private ShowTaskList() {\r\n        this._taskDataList = [];\r\n        let TaskCellList = TaskMgr.GetTaskCelllist();\r\n        let TaskGroup = 0;\r\n        for (const id in TaskCellList) {\r\n            let TaskData = TaskCellList[id];\r\n            let ServerData = JSON.parse(TaskMgr.ServerTaskList[TaskData.id]);\r\n            TaskData.isFinished = ServerData.isFinished;\r\n            TaskData.progress = ServerData.progress;\r\n\r\n            if (TaskGroup != TaskData.taskgroup)\r\n            {\r\n                TaskGroup = TaskData.taskgroup;\r\n                TaskData.TitleId = TaskGroup;\r\n                let TitleData = JSON.parse(JSON.stringify(TaskData));\r\n                this._taskDataList.push(TitleData);\r\n            }\r\n            TaskData.TitleId = 0;\r\n            this._taskDataList.push(TaskData);\r\n        }\r\n        this.initTaskGridList();\r\n    }\r\n\r\n    initTaskGridList() {\r\n        /*  paddingTop: 列表距离上边缘距离 默认为0\r\n        paddingBottom: 列表距离下边缘距离 默认为0\r\n        spacingX: 列间距 默认为3\r\n        spacingY: 行间距 默认为3\r\n        columnNum: 列数 默认为0，自动适配容器宽度\r\n        useVirtualLayout: 是否启用虚拟列表 默认为true\r\n        emptyTip: 没有数据显示提示\r\n        cacheImage: 是否缓存列表中加载过的图片，控件回收后，图片缓存将被全部释放。\r\n     */\r\n        if (this.taskGridList) {\r\n            this.taskGridList.clearList();\r\n            this.taskGridList.initGridList({\r\n                paddingTop: 10,\r\n                paddingBottom: 10,\r\n                spacingX: 10,\r\n                spacingY: 5,\r\n                columnNum: 1,\r\n                useVirtualLayout: true,\r\n                emptyTip: '',\r\n                cacheImage: true\r\n            });\r\n\r\n            this.taskGridList.appendItemsToDisplayList(this._taskDataList);\r\n        }\r\n    }\r\n\r\n    public ShowAchievementList() {\r\n        this._achievementDataList = [];\r\n        let AchievementCellList = TaskMgr.GetAchievementCellList();\r\n        for (const id in AchievementCellList) {\r\n            let AchievementData = AchievementCellList[id];\r\n            let ServerData = JSON.parse(TaskMgr.ServerAchievementList[AchievementData.id]);\r\n            AchievementData.isFinished = ServerData.isFinished;\r\n            AchievementData.progress = ServerData.progress;\r\n            this._achievementDataList.push(AchievementData);\r\n        }\r\n        this.initAchievementGridList();\r\n    }\r\n\r\n    initAchievementGridList() {\r\n        /*  paddingTop: 列表距离上边缘距离 默认为0\r\n        paddingBottom: 列表距离下边缘距离 默认为0\r\n        spacingX: 列间距 默认为3\r\n        spacingY: 行间距 默认为3\r\n        columnNum: 列数 默认为0，自动适配容器宽度\r\n        useVirtualLayout: 是否启用虚拟列表 默认为true\r\n        emptyTip: 没有数据显示提示\r\n        cacheImage: 是否缓存列表中加载过的图片，控件回收后，图片缓存将被全部释放。\r\n     */\r\n        if (this.achievementGridList) {\r\n            this.achievementGridList.clearList();\r\n            this.achievementGridList.initGridList({\r\n                paddingTop: 10,\r\n                paddingBottom: 10,\r\n                spacingX: 10,\r\n                spacingY: 5,\r\n                columnNum: 1,\r\n                useVirtualLayout: true,\r\n                emptyTip: '',\r\n                cacheImage: true\r\n            });\r\n\r\n            this.achievementGridList.appendItemsToDisplayList(this._achievementDataList);\r\n        }\r\n    }\r\n\r\n    public onClose() {\r\n        UtilMgr.PlaySoundEffect(19);\r\n        oops.gui.remove(UIID.Task);\r\n    }\r\n}\r\n\r\n\r\n"]}