{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/libs/gui/button/UIButton.ts"],"names":["AudioClip","Button","_decorator","game","oops","ccclass","property","menu","UIButton","tooltip","type","_touchCount","_touchEndTime","_onTouchEnded","event","once","propagationStopped","totalTime","interval","effect","audio","playEffect","onDestroy","releaseEffect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAoBC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,I,OAAAA,I;;AAC3CC,MAAAA,I,iBAAAA,I;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA;AAArB,O,GAA8BL,U;AAEpC;AACA;AACA;AACA;AACA;;yBAGqBM,Q,WAFpBH,OAAO,CAAC,UAAD,C,UACPE,IAAI,CAAC,oBAAD,C,UAEAD,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE;AADH,OAAD,C,UAKRH,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE;AADH,OAAD,C,UAKRH,QAAQ,CAAC;AACNG,QAAAA,OAAO,EAAE,MADH;AAENC,QAAAA,IAAI,EAAEV;AAFA,OAAD,C,0CAbb,MAEqBQ,QAFrB,SAEsCP,MAFtC,CAE6C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAiBzC;AAjByC,eAkBjCU,WAlBiC,GAkBnB,CAlBmB;;AAmBzC;AAnByC,eAoBjCC,aApBiC,GAoBjB,CApBiB;AAAA;;AAsBzC;AACUC,QAAAA,aAAa,CAACC,KAAD,EAAoB;AACvC;AACA,cAAI,KAAKC,IAAT,EAAe;AACX,gBAAI,KAAKJ,WAAL,GAAmB,CAAvB,EAA0B;AACtBG,cAAAA,KAAK,CAACE,kBAAN,GAA2B,IAA3B;AACA;AACH;;AACD,iBAAKL,WAAL;AACH,WARsC,CAUvC;;;AACA,cAAI,KAAKC,aAAL,IAAsBT,IAAI,CAACc,SAAL,GAAiB,KAAKL,aAAtB,GAAsC,KAAKM,QAArE,EAA+E;AAC3EJ,YAAAA,KAAK,CAACE,kBAAN,GAA2B,IAA3B;AACH,WAFD,MAGK;AACD,iBAAKJ,aAAL,GAAqBT,IAAI,CAACc,SAA1B;;AACA,kBAAMJ,aAAN,CAAoBC,KAApB;AACH,WAjBsC,CAmBvC;;;AACA,cAAI,KAAKK,MAAT,EAAiB;AAAA;AAAA,4BAAKC,KAAL,CAAWC,UAAX,CAAsB,KAAKF,MAA3B;AACpB;;AAEDG,QAAAA,SAAS,GAAG;AACR,cAAI,KAAKH,MAAT,EAAiB;AAAA;AAAA,4BAAKC,KAAL,CAAWG,aAAX,CAAyB,KAAKJ,MAA9B;AACpB;;AAhDwC,O;;;;;iBAId,G;;;;;;;iBAKH,K;;;;;;;iBAMI,I","sourcesContent":["import { AudioClip, Button, EventTouch, _decorator, game } from \"cc\";\r\nimport { oops } from \"../../../core/Oops\";\r\n\r\nconst { ccclass, property, menu } = _decorator;\r\n\r\n/** \r\n * 通用按钮\r\n * 1、防连点\r\n * 2、按钮点击触发音效\r\n */\r\n@ccclass(\"UIButton\")\r\n@menu('ui/button/UIButton')\r\nexport default class UIButton extends Button {\r\n    @property({\r\n        tooltip: \"每次触发间隔\"\r\n    })\r\n    private interval: number = 500;\r\n\r\n    @property({\r\n        tooltip: \"是否只触发一次\"\r\n    })\r\n    private once: boolean = false;\r\n\r\n    @property({\r\n        tooltip: \"触摸音效\",\r\n        type: AudioClip\r\n    })\r\n    private effect: AudioClip = null!;\r\n\r\n    /** 触摸次数 */\r\n    private _touchCount = 0;\r\n    /** 触摸结束时间 */\r\n    private _touchEndTime = 0;\r\n\r\n    /** 触摸结束 */\r\n    protected _onTouchEnded(event: EventTouch) {\r\n        // 是否只触发一次\r\n        if (this.once) {\r\n            if (this._touchCount > 0) {\r\n                event.propagationStopped = true;\r\n                return;\r\n            }\r\n            this._touchCount++;\r\n        }\r\n\r\n        // 防连点500毫秒出发一次事件\r\n        if (this._touchEndTime && game.totalTime - this._touchEndTime < this.interval) {\r\n            event.propagationStopped = true;\r\n        }\r\n        else {\r\n            this._touchEndTime = game.totalTime;\r\n            super._onTouchEnded(event);\r\n        }\r\n\r\n        // 短按触摸音效\r\n        if (this.effect) oops.audio.playEffect(this.effect);\r\n    }\r\n\r\n    onDestroy() {\r\n        if (this.effect) oops.audio.releaseEffect(this.effect);\r\n    }\r\n}\r\n"]}