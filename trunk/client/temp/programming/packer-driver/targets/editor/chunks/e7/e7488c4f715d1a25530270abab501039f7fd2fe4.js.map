{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/rank/RankListItem.ts"],"names":["_decorator","Label","Sprite","UITransform","IVirtualGridListItem","oops","UtilMgr","RankMgr","ccclass","property","RankListItem","nodeWidth","nodeHeight","onDataChanged","headImage","node","getComponent","width","height","data","curRankType","valueNum","string","formatNumber","BigInt","param","name","userName","userId","substring","idx","rank1","active","rank2","rank3","rankNum","language","getLangByID","toString","completeLogin","spriteFrame","uri","rawSize","_originalSize","originalWidth","originalHeight","scaleX","scaleY","scale","Math","min","url","http","server","loadImage","onDestroy"],"mappings":"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","sourcesContent":["import {_decorator, Label, Sprite, math, SpriteFrame, Node, Button, UITransform, Size} from 'cc';\r\nimport {IVirtualGridListItem} from \"../../../resources/libs/virtual_grid_list/interface\";\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\nimport { RankMgr } from \"../rank/RankManager\";\r\n\r\nconst {ccclass, property} = _decorator;\r\n\r\n@ccclass('RankListItem')\r\nexport class RankListItem extends IVirtualGridListItem {\r\n\r\n    @property(Sprite)\r\n    rank1: Sprite = null;\r\n    @property(Sprite)\r\n    rank2: Sprite = null;\r\n    @property(Sprite)\r\n    rank3: Sprite = null;\r\n    @property(Label)\r\n    rankNum: Label = null;\r\n\r\n    @property(Sprite)\r\n    headImage: Sprite = null;\r\n\r\n    @property(Label)\r\n    userName: Label = null;\r\n\r\n    @property(Label)\r\n    valueNum: Label = null;\r\n\r\n    private nodeWidth : number = 0;\r\n    private nodeHeight : number = 0;\r\n\r\n    onDataChanged() {\r\n        if (this.nodeWidth == 0)\r\n        {\r\n            this.nodeWidth = this.headImage.node.getComponent(UITransform).width;  // 获取节点的宽度\r\n        }\r\n        if (this.nodeHeight == 0)\r\n        {\r\n            this.nodeHeight = this.headImage.node.getComponent(UITransform).height; // 获取节点的高度\r\n        }\r\n        const data = this.data;\r\n        if (RankMgr.curRankType == 1)\r\n        {\r\n            this.valueNum.string = UtilMgr.formatNumber(BigInt(data.param));\r\n        }\r\n        else\r\n        {\r\n            this.valueNum.string = data.param;\r\n        }\r\n        \r\n        if (data.name)\r\n        {\r\n            this.userName.string = data.name;\r\n        }\r\n        else\r\n        {\r\n            this.userName.string = \"User_\"+ data.userId.substring(0, 8);\r\n        }\r\n\r\n        if (data.idx == 1)\r\n        {\r\n            this.rank1.node.active = true;\r\n            this.rank2.node.active = false;\r\n            this.rank3.node.active = false;\r\n            this.rankNum.node.active = false;\r\n        }\r\n        else if (data.idx == 2)\r\n        {\r\n            this.rank1.node.active = false;\r\n            this.rank2.node.active = true;\r\n            this.rank3.node.active = false;\r\n            this.rankNum.node.active = false;\r\n        }\r\n        else if (data.idx == 3)\r\n        {\r\n            this.rank1.node.active = false;\r\n            this.rank2.node.active = false;\r\n            this.rank3.node.active = true;\r\n            this.rankNum.node.active = false;\r\n        }\r\n        else\r\n        {\r\n            this.rank1.node.active = false;\r\n            this.rank2.node.active = false;\r\n            this.rank3.node.active = false;\r\n            this.rankNum.node.active = true;\r\n            if (data.idx == 0)\r\n            {\r\n                this.rankNum.string = oops.language.getLangByID(\"stringres_206\");\r\n            }\r\n            else\r\n            {\r\n                this.rankNum.string = data.idx.toString();\r\n            }\r\n        }\r\n\r\n\r\n        var completeLogin = (spriteFrame, uri) => {\r\n            if (spriteFrame && this.headImage)\r\n            {\r\n                this.headImage.node.active = true;\r\n                this.headImage.spriteFrame = spriteFrame;\r\n                // 获取图片的原始宽高\r\n                let rawSize = spriteFrame._originalSize as Size;\r\n                const originalWidth = rawSize.width;\r\n                const originalHeight = rawSize.height;\r\n\r\n                // 计算缩放比例\r\n                const scaleX = this.nodeWidth / originalWidth;\r\n                const scaleY = this.nodeHeight / originalHeight;\r\n\r\n                // 统一缩放比例以保持纵横比\r\n                const scale = Math.min(scaleX, scaleY);\r\n\r\n                // 设置Sprite的缩放\r\n                //this.headImage.node.setScale(scale, scale);\r\n            }\r\n        }\r\n        let userId = data.userId;\r\n        let url = oops.http.server + \"getheadimg/\"+ userId + \".jpg\";\r\n        this.loadImage(url, completeLogin);\r\n\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n    }\r\n}\r\n"]}