{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/payment/WebviewComponent.ts"],"names":["_decorator","Component","Sprite","WebView","oops","UIID","UtilMgr","ccclass","property","WebviewComponent","loadedCount","onAdded","params","url","webview","close","node","setSiblingIndex","on","webViewEvent","startsWith","onEventTypes","target","eventType","console","log","EventType","LOADED","gui","remove","PaymentWebview","OnClose","PlaySoundEffect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAcC,MAAAA,O,OAAAA,O;;AAC3CC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,O,iBAAAA,O;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;kCAGjBS,gB,WADZF,OAAO,CAAC,kBAAD,C,UAEHC,QAAQ,CAACL,OAAD,C,UAGRK,QAAQ,CAACN,MAAD,C,2BALb,MACaO,gBADb,SACsCR,SADtC,CACgD;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAOpCS,WAPoC,GAOb,CAPa;AAAA;;AAS5CC,QAAAA,OAAO,CAACC,MAAD,EAAuB;AAC1B,cAAIC,GAAG,GAAGD,MAAM,CAACC,GAAjB;AACA,eAAKC,OAAL,CAAaD,GAAb,GAAmBA,GAAnB;AACA,eAAKH,WAAL,GAAmB,CAAnB;AAEA,eAAKK,KAAL,CAAWC,IAAX,CAAgBC,eAAhB,CAAgC,IAAhC;AAEA,eAAKH,OAAL,CAAaE,IAAb,CAAkBE,EAAlB,CAAqB,SAArB,EAAiCC,YAAD,IAAkB;AAC9C,gBAAMN,GAAG,GAAGM,YAAY,CAACN,GAAzB;;AACA,gBAAIA,GAAG,CAACO,UAAJ,CAAe,eAAf,CAAJ,EAAqC,CACjC;AACA;AACH;AACJ,WAND;AAQA,iBAAO,IAAP;AACH;;AAEDC,QAAAA,YAAY,CAAEC,MAAF,EAAmBC,SAAnB,EAA8B;AACtCC,UAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBF,SAA9B;;AACA,cAAIA,SAAS,IAAIpB,OAAO,CAACuB,SAAR,CAAkBC,MAAnC,EACA;AACI,gBAAI,KAAKjB,WAAL,GAAmB,CAAvB,EACA;AACI;AAAA;AAAA,gCAAKkB,GAAL,CAASC,MAAT,CAAgB;AAAA;AAAA,gCAAKC,cAArB;AACA;AACH;;AACD,iBAAKpB,WAAL,GAAmB,KAAKA,WAAL,GAAmB,CAAtC;AACH;AACJ;;AAEMqB,QAAAA,OAAO,GAAG;AACb;AAAA;AAAA,kCAAQC,eAAR,CAAwB,EAAxB;AACA;AAAA;AAAA,4BAAKJ,GAAL,CAASC,MAAT,CAAgB;AAAA;AAAA,4BAAKC,cAArB;AACH;;AA3C2C,O;;;;;iBAElB,I;;;;;;;iBAGV,I","sourcesContent":["import { _decorator, Component, Node, Sprite, Label,WebView } from 'cc';\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { UtilMgr } from '../manager/UtilManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WebviewComponent')\r\nexport class WebviewComponent extends Component {\r\n    @property(WebView)\r\n    public webview: WebView = null!;\r\n\r\n    @property(Sprite)\r\n    close: Sprite = null;\r\n\r\n    private loadedCount : number = 0;\r\n\r\n    onAdded(params: any): boolean {\r\n        let url = params.url;\r\n        this.webview.url = url;\r\n        this.loadedCount = 0;\r\n\r\n        this.close.node.setSiblingIndex(1000);\r\n\r\n        this.webview.node.on('loading', (webViewEvent) => {\r\n            const url = webViewEvent.url;\r\n            if (url.startsWith(\"cocos://close\")) {\r\n                // 执行关闭操作，例如隐藏 WebView 或销毁节点\r\n                //webView.node.active = false;\r\n            }\r\n        });\r\n        \r\n        return true;\r\n    }\r\n\r\n    onEventTypes (target: WebView, eventType) {\r\n        console.log(\"onEventTypes=\" + eventType);\r\n        if (eventType == WebView.EventType.LOADED)\r\n        {\r\n            if (this.loadedCount > 0)\r\n            {\r\n                oops.gui.remove(UIID.PaymentWebview);\r\n                return;\r\n            }\r\n            this.loadedCount = this.loadedCount + 1;\r\n        }\r\n    }\r\n\r\n    public OnClose() {\r\n        UtilMgr.PlaySoundEffect(19);\r\n        oops.gui.remove(UIID.PaymentWebview);\r\n    }\r\n}\r\n\r\n\r\n"]}