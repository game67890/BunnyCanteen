{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/feed/FeedMain.ts"],"names":["FeedDataItem","_decorator","Component","Label","VirtualGridList","oops","GameEvent","TonGameMgr","PaymentMgr","UIID","TableIngredients","JsonUtil","HeChengMgr","UtilMgr","ccclass","property","configid","FeedMain","_dataList","customSort","a","b","record","init","aLevel","level","bLevel","onAdded","params","TitleName","string","language","getLangByID","addEvent","table","get","TableName","id","item","Number","push","sort","initGridList","updateBaseData","updateTuziCoin","onDestroy","removeEvent","message","on","UpdateBaseData","onUpdateData","OnShopListChange","updategridList","UpdateTuziCoin","UpdateCarrotCoin","off","event","args","updateCarrotCoin","CarrotCoinNum","CarrotCoin","toString","RabbitCoinNum","formatNumber","TuZiCoin","gridList","clearList","paddingTop","paddingBottom","spacingX","spacingY","columnNum","useVirtualLayout","emptyTip","cacheImage","registerSelectOneItemEventHandler","_onSelectOneItem","appendItemsToDisplayList","data","console","log","refreshItemDisplays","onAddBtnClick_1","PlaySoundEffect","OpenPaymentUI","onAddBtnClick_2","onGotoCarrots","onCloseBtnClick","gui","remove"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label } from 'cc';\r\nimport { VirtualGridList } from '../../../resources/libs/virtual_grid_list/virtual_grid_list';\r\nimport { oops } from '../../../../extensions/oops-plugin-framework/assets/core/Oops';\r\nimport { GameEvent } from '../../framework/common/config/GameEvent';\r\nimport { TonGameMgr } from '../manager/TonGameManager';\r\nimport { PaymentMgr } from '../payment/PaymentManager';\r\nimport { UIID } from '../../framework/common/config/GameUIConfig';\r\nimport { TableIngredients } from '../../framework/common/table/TableIngredients';\r\nimport { JsonUtil } from '../../../../extensions/oops-plugin-framework/assets/core/utils/JsonUtil';\r\nimport { HeChengMgr } from '../hecheng/HeChengManager';\r\nimport { UtilMgr } from '../manager/UtilManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\nclass FeedDataItem {\r\n    configid : number = 0;\r\n}\r\n\r\n\r\n@ccclass('FeedMain')\r\nexport class FeedMain extends Component {\r\n    @property(Label)\r\n    TitleName : Label;\r\n    @property(Label)\r\n    RabbitCoinNum : Label;\r\n    @property(Label)\r\n    CarrotCoinNum : Label;\r\n\r\n    @property(VirtualGridList)\r\n    protected gridList: VirtualGridList = null;\r\n\r\n    private _dataList: any[] = [];\r\n\r\n    onAdded(params: any): boolean {\r\n        this.TitleName.string = oops.language.getLangByID(\"stringres_107\");\r\n        this.init();\r\n        this.addEvent();\r\n        var table = JsonUtil.get(TableIngredients.TableName);\r\n\r\n        this._dataList = [];\r\n        if (table) {\r\n            for (let id in table) {\r\n                const item: FeedDataItem = {\r\n                    configid: Number(id),\r\n                }\r\n                this._dataList.push(item);\r\n            }\r\n        }\r\n        this._dataList.sort(this.customSort);\r\n        this.initGridList();\r\n        return true;\r\n    }\r\n\r\n    customSort = (a: FeedDataItem, b: FeedDataItem): number => {\r\n        if (a.configid > 0 && b.configid > 0) {\r\n            let record = new TableIngredients()\r\n            record.init(a.configid);\r\n            let aLevel = record.level;\r\n            record.init(b.configid);\r\n            let bLevel = record.level;\r\n\r\n            return aLevel - bLevel;\r\n        }\r\n        else {\r\n            return a.configid - b.configid;\r\n        }\r\n    };\r\n\r\n    private init() {\r\n        this.updateBaseData();\r\n        this.updateTuziCoin();\r\n    }\r\n\r\n    onDestroy() {\r\n        this.removeEvent();\r\n    }\r\n\r\n    /** 添加全局消息事件 */\r\n    private addEvent() {\r\n        oops.message.on(GameEvent.UpdateBaseData, this.onUpdateData, this);\r\n        oops.message.on(GameEvent.OnShopListChange, this.updategridList, this);\r\n        oops.message.on(GameEvent.UpdateTuziCoin, this.onUpdateData, this);\r\n        oops.message.on(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    /** 移除全局消息事件 */\r\n    private removeEvent() {\r\n        oops.message.off(GameEvent.UpdateBaseData, this.onUpdateData, this);\r\n        oops.message.off(GameEvent.OnShopListChange, this.updategridList, this);\r\n        oops.message.off(GameEvent.UpdateTuziCoin, this.onUpdateData, this);\r\n        oops.message.off(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    private onUpdateData(event: string, args: any) {\r\n        switch (event) {\r\n            case GameEvent.UpdateBaseData:\r\n                this.updateBaseData();\r\n                break;\r\n            case GameEvent.UpdateTuziCoin:\r\n                this.updateTuziCoin();\r\n                break;\r\n            case GameEvent.UpdateCarrotCoin:\r\n                this.updateCarrotCoin();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private updateBaseData() {\r\n        this.CarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n        this.updategridList();\r\n    }\r\n\r\n    private updateTuziCoin()\r\n    {\r\n        this.RabbitCoinNum.string = UtilMgr.formatNumber(TonGameMgr.TuZiCoin);\r\n    }\r\n\r\n    private updateCarrotCoin()\r\n    {\r\n        this.CarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n    }\r\n\r\n    initGridList() {\r\n        /*  paddingTop: 列表距离上边缘距离 默认为0\r\n        paddingBottom: 列表距离下边缘距离 默认为0\r\n        spacingX: 列间距 默认为3\r\n        spacingY: 行间距 默认为3\r\n        columnNum: 列数 默认为0，自动适配容器宽度\r\n        useVirtualLayout: 是否启用虚拟列表 默认为true\r\n        emptyTip: 没有数据显示提示\r\n        cacheImage: 是否缓存列表中加载过的图片，控件回收后，图片缓存将被全部释放。\r\n     */\r\n        if (this.gridList) {\r\n            this.gridList.clearList();\r\n            this.gridList.initGridList({\r\n                paddingTop: 10,\r\n                paddingBottom: 10,\r\n                spacingX: 0,\r\n                spacingY: 0,\r\n                columnNum: 1,\r\n                useVirtualLayout: true,\r\n                emptyTip: oops.language.getLangByID(\"stringres_088\"),\r\n                cacheImage: true\r\n            });\r\n            //this.gridList.registerScrollToBottomEventHandler(this._nextPage, this);\r\n            this.gridList.registerSelectOneItemEventHandler(this._onSelectOneItem, this);\r\n\r\n            this.gridList.appendItemsToDisplayList(this._dataList);\r\n        }\r\n    }\r\n\r\n    _onSelectOneItem(data: any) {\r\n        console.log('_onSelectOneItem');\r\n    }\r\n\r\n    public updategridList() {\r\n        this.gridList.refreshItemDisplays();\r\n    }\r\n\r\n    // 点击加号按钮\r\n    public onAddBtnClick_1() {\r\n        UtilMgr.PlaySoundEffect(18);\r\n        PaymentMgr.OpenPaymentUI();\r\n    }\r\n\r\n    // 点击加号按钮\r\n    public onAddBtnClick_2() {\r\n        UtilMgr.PlaySoundEffect(18);\r\n        HeChengMgr.onGotoCarrots();\r\n    }\r\n\r\n    // 点击关闭按钮\r\n    public onCloseBtnClick() {\r\n        UtilMgr.PlaySoundEffect(19);\r\n        oops.gui.remove(UIID.FeedMain);\r\n    }\r\n}\r\n\r\n\r\n"]}