{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/core/gui/layer/LayerNotify.ts"],"names":["LayerNotify","BlockInputEvents","Layers","Node","Widget","find","instantiate","ViewUtil","Notify","oops","ToastPrefabPath","WaitPrefabPath","constructor","name","black","wait","notify","notifyItem","widget","addComponent","isAlignLeft","isAlignRight","isAlignTop","isAlignBottom","left","right","top","bottom","alignMode","enabled","init","layer","Enum","UI_2D","waitOpen","createPrefabNode","parent","waitClose","toast","content","useI18n","onCompleteCallback","childNode","toastCom","getChildByName","getComponent","onComplete","children","length","destroy","res","loadDir","console","error"],"mappings":"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","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-08-15 10:06:47\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-09-02 13:44:12\r\n */\r\nimport { BlockInputEvents, Layers, Node, Widget, find, instantiate } from \"cc\";\r\nimport { ViewUtil } from \"../../utils/ViewUtil\";\r\nimport { Notify } from \"../prompt/Notify\";\r\nimport { oops } from \"../../Oops\";\r\n\r\nconst ToastPrefabPath: string = 'common/prefab/notify';\r\nconst WaitPrefabPath: string = 'common/prefab/wait';\r\n\r\n/*\r\n * 滚动消息提示层\r\n */\r\nexport class LayerNotify extends Node {\r\n    private black!: BlockInputEvents;\r\n    /** 等待提示资源 */\r\n    private wait: Node = null!;\r\n    /** 自定义弹出提示资源 */\r\n    private notify: Node = null!;\r\n    /** 自定义弹出提示内容资源 */\r\n    private notifyItem: Node = null!;\r\n\r\n    constructor(name: string) {\r\n        super(name);\r\n\r\n        const widget: Widget = this.addComponent(Widget);\r\n        widget.isAlignLeft = widget.isAlignRight = widget.isAlignTop = widget.isAlignBottom = true;\r\n        widget.left = widget.right = widget.top = widget.bottom = 0;\r\n        widget.alignMode = 2;\r\n        widget.enabled = true;\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        this.layer = Layers.Enum.UI_2D;\r\n        this.black = this.addComponent(BlockInputEvents);\r\n        this.black.enabled = false;\r\n    }\r\n\r\n    /** 打开等待提示 */\r\n    waitOpen() {\r\n        if (this.wait == null) this.wait = ViewUtil.createPrefabNode(WaitPrefabPath);\r\n        if (this.wait.parent == null) {\r\n            this.wait.parent = this;\r\n            this.black.enabled = true;\r\n        }\r\n    }\r\n\r\n    /** 关闭等待提示 */\r\n    waitClose() {\r\n        if (this.wait && this.wait.parent) {\r\n            this.wait.parent = null;\r\n            this.black.enabled = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 渐隐飘过提示\r\n     * @param content 文本表示\r\n     * @param useI18n 是否使用多语言\r\n     */\r\n    toast(content: string, useI18n: boolean): void {\r\n        try {\r\n            var onCompleteCallback = () => {\r\n                if (this.notify == null) {\r\n                    this.notify = ViewUtil.createPrefabNode(ToastPrefabPath);\r\n                    this.notifyItem = find(\"item\", this.notify)!;\r\n                    this.notifyItem.parent = null;\r\n                }\r\n    \r\n                this.notify.parent = this;\r\n                let childNode = instantiate(this.notifyItem);\r\n                let toastCom = childNode.getChildByName(\"prompt\")!.getComponent(Notify)!;\r\n                childNode.parent = this.notify;\r\n    \r\n                toastCom.onComplete = () => {\r\n                    if (this.notify.children.length == 0) {\r\n                        this.notify.parent = null;\r\n                    }\r\n                };\r\n                toastCom.toast(content, useI18n);\r\n    \r\n                // 超过3个提示，就施放第一个提示\r\n                if (this.notify.children.length > 3) {\r\n                    this.notify.children[0].destroy();\r\n                }\r\n\r\n            }\r\n    \r\n            oops.res.loadDir(ToastPrefabPath, onCompleteCallback);   \r\n            \r\n        }\r\n        catch {\r\n            console.error(\"从oops-game-kit项目中拷贝 assets/bundle/common/prefab/notify.prefab 与 assets/bundle/common/anim/notify.anim 覆盖到本项目中\");\r\n        }\r\n    }\r\n}"]}