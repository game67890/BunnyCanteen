{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/contact/FlyComponent.ts"],"names":["_decorator","Component","Vec3","Vec2","HeChengMgr","ccclass","property","FlyComponent","NodeSpeed","tempPosVec3","FlyFlag","zOrder","parentZOrder","startPos","srcIndex","destIndex","TargetX","TargetY","beginFly","targetPosX","targetPosY","set","node","position","x","y","parent","getSiblingIndex","setSiblingIndex","endFly","p","setPosition","HandleHecheng","update","dt","targetPos","SelfPos","getPosition","normalizeVec3","subtract","normalize","z","flyToPos","currentPos","threshold","distance"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, EventTouch, Vec3, Sprite, Vec2, UITransform, view } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\nimport { HeChengMgr } from \"../hecheng/HeChengManager\";\r\n\r\n@ccclass('FlyComponent')\r\nexport class FlyComponent extends Component {\r\n    private NodeSpeed = 200;\r\n    private tempPosVec3 : Vec3 = new Vec3();\r\n\r\n    private FlyFlag : boolean = false;\r\n    private zOrder:number\r\n    private parentZOrder:number\r\n    private startPos:Vec2 = new Vec2(0, 0)\r\n    private srcIndex : number = 0\r\n    private destIndex : number = 0\r\n    private TargetX : number = 0;\r\n    private TargetY : number = 0;\r\n\r\n    public beginFly (srcIndex : number, destIndex : number, targetPosX: number, targetPosY : number)\r\n    {\r\n        this.srcIndex = srcIndex;\r\n        this.destIndex = destIndex;\r\n        this.TargetX = targetPosX;\r\n        this.TargetY = targetPosY;\r\n\r\n        this.startPos.set(this.node.position.x, this.node.position.y);\r\n        this.parentZOrder = this.node.parent.getSiblingIndex();\r\n        this.node.parent.setSiblingIndex(1000);\r\n        this.zOrder = this.node.getSiblingIndex();\r\n        this.node.setSiblingIndex(1000);\r\n        this.FlyFlag = true;\r\n    }\r\n\r\n    public endFly ()\r\n    {\r\n        let p = new Vec3(this.startPos.x, this.startPos.y, 0);\r\n        this.node.setPosition(p)\r\n        this.node.parent.setSiblingIndex(this.parentZOrder);\r\n        this.node.setSiblingIndex(this.zOrder );\r\n        this.FlyFlag = false;\r\n\r\n        //相同素材进行合成操作\r\n        HeChengMgr.HandleHecheng(this.srcIndex, this.destIndex);\r\n    }\r\n\r\n    update (dt: number) {\r\n        if (!this.FlyFlag) return;\r\n\r\n        let targetPos : Vec3 = new Vec3(this.TargetX, this.TargetY, 0);\r\n        let SelfPos : Vec3 = this.node.getPosition();\r\n        let normalizeVec3 : Vec3 = targetPos.subtract(SelfPos).normalize();\r\n\r\n        this.tempPosVec3.set(SelfPos.x + normalizeVec3.x * this.NodeSpeed * dt,\r\n            SelfPos.y + normalizeVec3.y * this.NodeSpeed *dt, SelfPos.z);\r\n        this.node.setPosition(this.tempPosVec3);\r\n\r\n        let flyToPos = new Vec3(this.TargetX, this.TargetY, 0);\r\n        let currentPos = this.node.position;\r\n\r\n        let threshold = 5;\r\n        let distance = Vec3.distance(currentPos, flyToPos);\r\n\r\n        if (distance <= threshold) {\r\n            this.endFly();\r\n        }\r\n    }\r\n}\r\n"]}