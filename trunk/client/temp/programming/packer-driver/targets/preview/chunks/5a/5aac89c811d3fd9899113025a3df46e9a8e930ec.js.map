{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/extensions/oops-plugin-framework/assets/core/utils/JsonUtil.ts"],"names":["JsonUtil","JsonAsset","resLoader","path","data","Map","get","name","has","load","callback","url","err","content","console","warn","message","set","json","release","loadAsync","Promise","resolve","reject","loadDirAsync","loadDir","assets","forEach","asset","releaseDir","delete","clear"],"mappings":";;;qGAiBaA,Q;;;;;;;;;;;;;;;AAVJC,MAAAA,S,OAAAA,S;;AACAC,MAAAA,S,iBAAAA,S;;;;;;AART;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACMC,MAAAA,I,GAAe,c;AAErB;;AACMC,MAAAA,I,GAAyB,IAAIC,GAAJ,E;AAE/B;;0BACaL,Q,GAAN,MAAMA,QAAN,CAAe;AAClB;AACJ;AACA;AACA;AACc,eAAHM,GAAG,CAACC,IAAD,EAAoB;AAC1B,cAAIH,IAAI,CAACI,GAAL,CAASD,IAAT,CAAJ,EACI,OAAOH,IAAI,CAACE,GAAL,CAASC,IAAT,CAAP;AACP;AAED;AACJ;AACA;AACA;AACA;;;AACe,eAAJE,IAAI,CAACF,IAAD,EAAeG,QAAf,EAAyC;AAChD,cAAIN,IAAI,CAACI,GAAL,CAASD,IAAT,CAAJ,EACIG,QAAQ,CAACN,IAAI,CAACE,GAAL,CAASC,IAAT,CAAD,CAAR,CADJ,KAEK;AACD,gBAAMI,GAAG,GAAGR,IAAI,GAAGI,IAAnB;AACA;AAAA;AAAA,wCAAUE,IAAV,CAAeE,GAAf,EAAoBV,SAApB,EAA+B,CAACW,GAAD,EAAoBC,OAApB,KAA2C;AACtE,kBAAID,GAAJ,EAAS;AACLE,gBAAAA,OAAO,CAACC,IAAR,CAAaH,GAAG,CAACI,OAAjB;AACAN,gBAAAA,QAAQ,CAAC,IAAD,CAAR;AACH,eAHD,MAIK;AACDN,gBAAAA,IAAI,CAACa,GAAL,CAASV,IAAT,EAAeM,OAAO,CAACK,IAAvB;AACA;AAAA;AAAA,4CAAUC,OAAV,CAAkBR,GAAlB;AACAD,gBAAAA,QAAQ,CAACG,OAAO,CAACK,IAAT,CAAR;AACH;AACJ,aAVD;AAWH;AACJ;AAED;AACJ;AACA;AACA;;;AACoB,eAATE,SAAS,CAACb,IAAD,EAA6B;AACzC,iBAAO,IAAIc,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,gBAAInB,IAAI,CAACI,GAAL,CAASD,IAAT,CAAJ,EAAoB;AAChBe,cAAAA,OAAO,CAAClB,IAAI,CAACE,GAAL,CAASC,IAAT,CAAD,CAAP;AACH,aAFD,MAGK;AACD,kBAAMI,GAAG,GAAGR,IAAI,GAAGI,IAAnB;AACA;AAAA;AAAA,0CAAUE,IAAV,CAAeE,GAAf,EAAoBV,SAApB,EAA+B,CAACW,GAAD,EAAoBC,OAApB,KAA2C;AACtE,oBAAID,GAAJ,EAAS;AACLE,kBAAAA,OAAO,CAACC,IAAR,CAAaH,GAAG,CAACI,OAAjB;AACAM,kBAAAA,OAAO,CAAC,IAAD,CAAP;AACH,iBAHD,MAIK;AACDlB,kBAAAA,IAAI,CAACa,GAAL,CAASV,IAAT,EAAeM,OAAO,CAACK,IAAvB;AACA;AAAA;AAAA,8CAAUC,OAAV,CAAkBR,GAAlB;AACAW,kBAAAA,OAAO,CAACT,OAAO,CAACK,IAAT,CAAP;AACH;AACJ,eAVD;AAWH;AACJ,WAlBM,CAAP;AAmBH;AAED;;;AACmB,eAAZM,YAAY,GAAqB;AACpC,iBAAO,IAAIH,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC;AAAA;AAAA,wCAAUE,OAAV,CAAkBtB,IAAlB,EAAwB,CAACS,GAAD,EAAoBc,MAApB,KAA4C;AAChE,kBAAId,GAAJ,EAAS;AACLE,gBAAAA,OAAO,CAACC,IAAR,CAAaH,GAAG,CAACI,OAAjB;AACAM,gBAAAA,OAAO,CAAC,KAAD,CAAP;AACH,eAHD,MAIK;AACDI,gBAAAA,MAAM,CAACC,OAAP,CAAeC,KAAK,IAAI;AACpBxB,kBAAAA,IAAI,CAACa,GAAL,CAASW,KAAK,CAACrB,IAAf,EAAqBqB,KAAK,CAACV,IAA3B;AACH,iBAFD;AAGA;AAAA;AAAA,4CAAUW,UAAV,CAAqB1B,IAArB;AACAmB,gBAAAA,OAAO,CAAC,IAAD,CAAP;AACH;AACJ,aAZD;AAaH,WAdM,CAAP;AAeH;AAED;AACJ;AACA;AACA;;;AACkB,eAAPH,OAAO,CAACZ,IAAD,EAAe;AACzBH,UAAAA,IAAI,CAAC0B,MAAL,CAAYvB,IAAZ;AACH;AAED;;;AACY,eAALwB,KAAK,GAAG;AACX3B,UAAAA,IAAI,CAAC2B,KAAL;AACH;;AA1FiB,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-08-18 17:00:59\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2023-08-22 15:48:02\r\n */\r\n\r\nimport { JsonAsset } from \"cc\";\r\nimport { resLoader } from \"../common/loader/ResLoader\";\r\n\r\n/** 资源路径 */\r\nconst path: string = \"config/game/\";\r\n\r\n/** 数据缓存 */\r\nconst data: Map<string, any> = new Map();\r\n\r\n/** JSON数据表工具 */\r\nexport class JsonUtil {\r\n    /**\r\n     * 通知资源名从缓存中获取一个Json数据表\r\n     * @param name  资源名\r\n     */\r\n    static get(name: string): any {\r\n        if (data.has(name))\r\n            return data.get(name);\r\n    }\r\n\r\n    /**\r\n     * 通知资源名加载Json数据表\r\n     * @param name      资源名\r\n     * @param callback  资源加载完成回调\r\n     */\r\n    static load(name: string, callback: Function): void {\r\n        if (data.has(name))\r\n            callback(data.get(name));\r\n        else {\r\n            const url = path + name;\r\n            resLoader.load(url, JsonAsset, (err: Error | null, content: JsonAsset) => {\r\n                if (err) {\r\n                    console.warn(err.message);\r\n                    callback(null);\r\n                }\r\n                else {\r\n                    data.set(name, content.json);\r\n                    resLoader.release(url);\r\n                    callback(content.json);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 异步加载Json数据表\r\n     * @param name 资源名\r\n     */\r\n    static loadAsync(name: string): Promise<any> {\r\n        return new Promise((resolve, reject) => {\r\n            if (data.has(name)) {\r\n                resolve(data.get(name))\r\n            }\r\n            else {\r\n                const url = path + name;\r\n                resLoader.load(url, JsonAsset, (err: Error | null, content: JsonAsset) => {\r\n                    if (err) {\r\n                        console.warn(err.message);\r\n                        resolve(null);\r\n                    }\r\n                    else {\r\n                        data.set(name, content.json);\r\n                        resLoader.release(url);\r\n                        resolve(content.json);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /** 加载所有配置表数据到缓存中 */\r\n    static loadDirAsync(): Promise<boolean> {\r\n        return new Promise((resolve, reject) => {\r\n            resLoader.loadDir(path, (err: Error | null, assets: JsonAsset[]) => {\r\n                if (err) {\r\n                    console.warn(err.message);\r\n                    resolve(false);\r\n                }\r\n                else {\r\n                    assets.forEach(asset => {\r\n                        data.set(asset.name, asset.json);\r\n                    });\r\n                    resLoader.releaseDir(path);\r\n                    resolve(true);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 通过指定资源名释放资源内存\r\n     * @param name 资源名\r\n     */\r\n    static release(name: string) {\r\n        data.delete(name);\r\n    }\r\n\r\n    /** 清理所有数据 */\r\n    static clear() {\r\n        data.clear();\r\n    }\r\n}"]}