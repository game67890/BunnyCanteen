{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/contact/ContactComponent.ts"],"names":["_decorator","Component","PhysicsSystem2D","Contact2DType","GridComponent","BoardMgr","ccclass","property","ContactComponent","start","instance","on","BEGIN_CONTACT","onBeinContact","END_CONTACT","onEndContact","DestCollider","SrcCollider","tag","IsHuiShou","DestGridComponent","node","parent","getComponent","SrcGridComponent","index","params","InDragIndex","DestIndex","SrcIndex","addTouchItem","console","log","removeTouchItem"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, Label, PhysicsSystem2D, Contact2DType, Collider2D } from 'cc';\r\nimport { GridComponent } from \"../hecheng/GridComponent\";\r\nimport { BoardMgr } from \"../manager/BoardManager\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ContactComponent')\r\nexport class ContactComponent extends Component {\r\n\r\n    start () {\r\n        PhysicsSystem2D.instance.on(Contact2DType.BEGIN_CONTACT, this.onBeinContact, this);\r\n        PhysicsSystem2D.instance.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n    }\r\n\r\n    onBeinContact (DestCollider: Collider2D, SrcCollider: Collider2D) {\r\n        if (DestCollider.tag != SrcCollider.tag)\r\n        {\r\n            if (DestCollider.tag == 3 || SrcCollider.tag == 3)\r\n            {\r\n                BoardMgr.IsHuiShou = true;\r\n            }\r\n            else\r\n            {\r\n                const DestGridComponent = DestCollider.node.parent.getComponent(GridComponent);\r\n                if (DestGridComponent)\r\n                {\r\n                    const SrcGridComponent = SrcCollider.node.parent.getComponent(GridComponent);\r\n                    if (SrcGridComponent)\r\n                    {\r\n                        if (DestGridComponent.index != SrcGridComponent.index)\r\n                        {\r\n                            let params : any = {};\r\n                            if (BoardMgr.InDragIndex == SrcGridComponent.index)\r\n                            {\r\n                                params.DestIndex = DestGridComponent.index;\r\n                                params.SrcIndex = SrcGridComponent.index;\r\n                            }\r\n                            else\r\n                            {\r\n                                params.DestIndex = SrcGridComponent.index;\r\n                                params.SrcIndex = DestGridComponent.index;\r\n                            }\r\n    \r\n                            BoardMgr.addTouchItem(params.SrcIndex, params.DestIndex);\r\n                            console.log(\"onBeinContact dest index=\" + DestGridComponent.index + \" tag=\" + DestCollider.tag);\r\n                            console.log(\"onBeinContact src index=\" + SrcGridComponent.index + \" tag=\" + SrcCollider.tag);\r\n                        }\r\n                    }   \r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onEndContact (DestCollider: Collider2D, SrcCollider: Collider2D) {\r\n        if (DestCollider.tag != SrcCollider.tag)\r\n        {\r\n            if (DestCollider.tag == 3 || SrcCollider.tag == 3)\r\n            {\r\n                BoardMgr.IsHuiShou = false;\r\n            }\r\n            else\r\n            {\r\n                const DestGridComponent = DestCollider.node.parent.getComponent(GridComponent);\r\n                if (DestGridComponent)\r\n                {\r\n                    const SrcGridComponent = SrcCollider.node.parent.getComponent(GridComponent);\r\n                    if (SrcGridComponent)\r\n                    {\r\n                        if (DestGridComponent.index != SrcGridComponent.index)\r\n                        {\r\n                            let params : any = {};\r\n                            if (BoardMgr.InDragIndex == SrcGridComponent.index)\r\n                            {\r\n                                params.DestIndex = DestGridComponent.index;\r\n                                params.SrcIndex = SrcGridComponent.index;\r\n                            }\r\n                            else\r\n                            {\r\n                                params.DestIndex = SrcGridComponent.index;\r\n                                params.SrcIndex = DestGridComponent.index;\r\n                            }\r\n    \r\n                            BoardMgr.removeTouchItem(params.SrcIndex, params.DestIndex);\r\n    \r\n                            console.log(\"onEndContact dest index=\" + DestGridComponent.index + \" tag=\" + DestCollider.tag);\r\n                            console.log(\"onEndContact src index=\" + SrcGridComponent.index + \" tag=\" + SrcCollider.tag);\r\n                        }\r\n                    }   \r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}