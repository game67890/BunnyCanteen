{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/hecheng/GridComponent.ts"],"names":["_decorator","Component","Sprite","Label","tween","v3","TableIngredients","BoardMgr","UtilMgr","LiWuMgr","oops","UIID","HeChengComponent","ccclass","property","GridComponent","index","_tsIngredients","_tweenRF","shakeDuration","shakeCount","interval","posX","posY","setVisible","visible","SuCaiSelect","node","active","SuCaiSprite","SuCaiLevel","board","SuCaiId","init","SetImage","picture","setLiwuVisible","LiwuSprite","LiwuPos","getPosition","x","y","repeat","sequence","to","position","easing","schedule","startDiagonalShake","stop","start","setLevel","level","string","toString","onClick","IsLiWu","IsLiWuFlying","openLiwu","setSelectVisible","ShowSucaiSelect","isShow","HechengGUI","gui","get","MainUI","HechengCom","getComponent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,K,OAAAA,K;AAA+BC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,E,OAAAA,E;;AAC3EC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,O,iBAAAA,O;;AAEAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,gB,iBAAAA,gB;;;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBd,U;;+BAGjBe,a,WADZF,OAAO,CAAC,eAAD,C,UAGHC,QAAQ,CAACZ,MAAD,C,UAGRY,QAAQ,CAACX,KAAD,C,UAGRW,QAAQ,CAACZ,MAAD,C,UAGRY,QAAQ,CAACZ,MAAD,C,2BAZb,MACaa,aADb,SACmCd,SADnC,CAC6C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAclCe,KAdkC,GAcjB,CAAC,CAdgB;AAAA,eAejCC,cAfiC,GAehB;AAAA;AAAA,qDAfgB;AAAA,eAgBjCC,QAhBiC,GAgBR,IAhBQ;AAAA,eAiBjCC,aAjBiC,GAiBT,GAjBS;AAiBJ;AAjBI,eAkBjCC,UAlBiC,GAkBZ,CAlBY;AAkBT;AAlBS,eAmBjCC,QAnBiC,GAmBd,CAnBc;AAmBX;AAnBW,eAoBjCC,IApBiC,GAoBjB,CApBiB;AAAA,eAqBjCC,IArBiC,GAqBjB,CArBiB;AAAA;;AAuBlCC,QAAAA,UAAU,CAACC,OAAD,EAAmB;AAChC,eAAKC,WAAL,CAAiBC,IAAjB,CAAsBC,MAAtB,GAA+B,KAA/B;AACA,eAAKC,WAAL,CAAiBF,IAAjB,CAAsBC,MAAtB,GAA+BH,OAA/B;AACA,eAAKK,UAAL,CAAgBH,IAAhB,CAAqBC,MAArB,GAA8BH,OAA9B;;AACA,cAAIA,OAAO,IAAI,KAAKT,KAAL,IAAc,CAAzB,IAA8B;AAAA;AAAA,oCAASe,KAAT,CAAe,KAAKf,KAApB,CAAlC,EACA;AACI,gBAAI;AAAA;AAAA,sCAASe,KAAT,CAAe,KAAKf,KAApB,EAA2BgB,OAA3B,GAAqC,CAAzC,EACA;AACI,mBAAKf,cAAL,CAAoBgB,IAApB,CAAyB;AAAA;AAAA,wCAASF,KAAT,CAAe,KAAKf,KAApB,EAA2BgB,OAApD;;AACA;AAAA;AAAA,sCAAQE,QAAR,CAAiB,KAAKL,WAAtB,EAAmC,KAAKZ,cAAL,CAAoBkB,OAAvD;AACH;AACJ;AACJ;;AAEMC,QAAAA,cAAc,CAACX,OAAD,EAAmB;AACpC,eAAKC,WAAL,CAAiBC,IAAjB,CAAsBC,MAAtB,GAA+B,KAA/B;AACA,eAAKS,UAAL,CAAgBV,IAAhB,CAAqBC,MAArB,GAA8BH,OAA9B;;AACA,cAAIA,OAAJ,EACA;AACI;AAAA;AAAA,oCAAQS,QAAR,CAAiB,KAAKG,UAAtB,EAAkC,kCAAlC;;AACA,gBAAI,KAAKnB,QAAL,IAAiB,IAArB,EACA;AACI,kBAAIoB,OAAO,GAAG,KAAKD,UAAL,CAAgBV,IAAhB,CAAqBY,WAArB,EAAd;AACA,mBAAKjB,IAAL,GAAYgB,OAAO,CAACE,CAApB;AACA,mBAAKjB,IAAL,GAAYe,OAAO,CAACG,CAApB;AACA,mBAAKvB,QAAL,GAAgBd,KAAK,CAAC,KAAKiC,UAAL,CAAgBV,IAAjB,CAAL,CACfe,MADe,CACR,CADQ,EAEhBtC,KAAK,CAAC,KAAKiC,UAAL,CAAgBV,IAAjB,CAAL,CAA4BgB,QAA5B,CAAqCvC,KAAK,CAAC,KAAKiC,UAAL,CAAgBV,IAAjB,CAAL,CAA4BiB,EAA5B,CAA+B,KAAKzB,aAApC,EAAoD;AAAE0B,gBAAAA,QAAQ,EAAExC,EAAE,CAAC,KAAKiB,IAAL,GAAU,CAAX,EAAc,KAAKC,IAAnB,EAAyB,CAAzB;AAAd,eAApD,EAAiG;AAAEuB,gBAAAA,MAAM,EAAE;AAAV,eAAjG,CAArC,EACA1C,KAAK,CAAC,KAAKiC,UAAL,CAAgBV,IAAjB,CAAL,CAA4BiB,EAA5B,CAA+B,KAAKzB,aAApC,EAAoD;AAAE0B,gBAAAA,QAAQ,EAAExC,EAAE,CAAC,KAAKiB,IAAL,GAAU,CAAX,EAAc,KAAKC,IAAnB,EAAyB,CAAzB;AAAd,eAApD,EAAiG;AAAEuB,gBAAAA,MAAM,EAAE;AAAV,eAAjG,CADA,CAFgB,CAAhB;AAKH;;AACD,iBAAKC,QAAL,CAAc,KAAKC,kBAAnB,EAAuC,KAAK3B,QAAL,GAAgB,KAAKF,aAAL,GAAqB,KAAKC,UAA1B,GAAuC,CAA9F;AACH,WAfD,MAiBA;AACI,gBAAI,KAAKF,QAAT,EACA;AACI,mBAAKA,QAAL,CAAc+B,IAAd;AACH;AACJ;AACJ;;AAEDD,QAAAA,kBAAkB,GAAG;AACjB,cAAI,KAAK9B,QAAL,IAAiB,KAAKmB,UAAL,CAAgBV,IAAhB,CAAqBC,MAA1C,EACA;AACI,iBAAKV,QAAL,CAAcgC,KAAd;AACH;AACJ;;AAEMC,QAAAA,QAAQ,CAACC,KAAD,EAAgB;AAC3B,eAAKtB,UAAL,CAAgBuB,MAAhB,GAAyBD,KAAK,CAACE,QAAN,EAAzB;AACH;;AAEOC,QAAAA,OAAO,GAAG;AACd,cAAI;AAAA;AAAA,oCAASxB,KAAT,CAAe,KAAKf,KAApB,EAA2BwC,MAA3B,IAAqC,CAAC;AAAA;AAAA,oCAASzB,KAAT,CAAe,KAAKf,KAApB,EAA2ByC,YAArE,EACA;AACI;AAAA;AAAA,oCAAQC,QAAR,CAAiB,KAAK1C,KAAtB;AACH;AACJ;;AAEM2C,QAAAA,gBAAgB,CAAClC,OAAD,EAAmB;AACtC,eAAKC,WAAL,CAAiBC,IAAjB,CAAsBC,MAAtB,GAA+BH,OAA/B;AACH;;AAEMmC,QAAAA,eAAe,CAACC,MAAD,EAAgB;AAClC,cAAMC,UAAU,GAAG;AAAA;AAAA,4BAAKC,GAAL,CAASC,GAAT,CAAa;AAAA;AAAA,4BAAKC,MAAlB,CAAnB;;AACA,cAAIH,UAAJ,EACA;AACI,gBAAMI,UAAU,GAAGJ,UAAU,CAACK,YAAX;AAAA;AAAA,qDAAnB;;AACA,gBAAID,UAAJ,EACA;AACIA,cAAAA,UAAU,CAACN,eAAX,CAA2BC,MAA3B,EAAmC,KAAK7C,KAAxC;AACH;AACJ;AACJ;;AAjGwC,O;;;;;iBAGnB,I;;;;;;;;;;;;iBAMD,I;;;;;;;iBAGC,I","sourcesContent":["import { _decorator, Component, Node, Sprite, Label, resources, SpriteAtlas, tween, v3, Vec3} from 'cc';\r\nimport { TableIngredients } from \"../../framework/common/table/TableIngredients\";\r\nimport { BoardMgr } from \"../manager/BoardManager\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\nimport { LiWuMgr } from \"../liwu/LiWuManager\";\r\nimport { Tween } from 'cc';\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { HeChengComponent } from \"../hecheng/HeChengComponent\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GridComponent')\r\nexport class GridComponent extends Component {\r\n\r\n    @property(Sprite)\r\n    SuCaiSprite: Sprite = null;\r\n\r\n    @property(Label)\r\n    SuCaiLevel: Label;\r\n\r\n    @property(Sprite)\r\n    LiwuSprite: Sprite = null;\r\n\r\n    @property(Sprite)\r\n    SuCaiSelect: Sprite = null;\r\n\r\n    public index : number = -1;\r\n    private _tsIngredients = new TableIngredients();\r\n    private _tweenRF : Tween<Node> = null;\r\n    private shakeDuration: number = 0.1; // 单次晃动的时间\r\n    private shakeCount: number = 4; // 每次晃动的次数\r\n    private interval: number = 4; // 停止后再次晃动的间隔（秒）\r\n    private posX : number = 0;\r\n    private posY : number = 0;\r\n\r\n    public setVisible(visible: boolean) {\r\n        this.SuCaiSelect.node.active = false;\r\n        this.SuCaiSprite.node.active = visible;\r\n        this.SuCaiLevel.node.active = visible;\r\n        if (visible && this.index >= 0 && BoardMgr.board[this.index])\r\n        {\r\n            if (BoardMgr.board[this.index].SuCaiId > 0)\r\n            {\r\n                this._tsIngredients.init(BoardMgr.board[this.index].SuCaiId);\r\n                UtilMgr.SetImage(this.SuCaiSprite, this._tsIngredients.picture);\r\n            }\r\n        }\r\n    }\r\n\r\n    public setLiwuVisible(visible: boolean) {\r\n        this.SuCaiSelect.node.active = false;\r\n        this.LiwuSprite.node.active = visible;\r\n        if (visible)\r\n        {\r\n            UtilMgr.SetImage(this.LiwuSprite, \"textures/UI/baluobo/baluobo;liwu\");\r\n            if (this._tweenRF == null)\r\n            {\r\n                let LiwuPos = this.LiwuSprite.node.getPosition();\r\n                this.posX = LiwuPos.x;\r\n                this.posY = LiwuPos.y;\r\n                this._tweenRF = tween(this.LiwuSprite.node)\r\n                .repeat(4,              \r\n                tween(this.LiwuSprite.node).sequence(tween(this.LiwuSprite.node).to(this.shakeDuration,  { position: v3(this.posX+1, this.posY, 0) }, { easing: 'quadIn' }),\r\n                tween(this.LiwuSprite.node).to(this.shakeDuration,  { position: v3(this.posX-1, this.posY, 0) }, { easing: 'quadOut' }))\r\n                )   \r\n            }\r\n            this.schedule(this.startDiagonalShake, this.interval + this.shakeDuration * this.shakeCount * 2);\r\n        }\r\n        else\r\n        {\r\n            if (this._tweenRF)\r\n            {\r\n                this._tweenRF.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n    startDiagonalShake() {\r\n        if (this._tweenRF && this.LiwuSprite.node.active)\r\n        {\r\n            this._tweenRF.start();\r\n        }\r\n    }\r\n\r\n    public setLevel(level: number) {\r\n        this.SuCaiLevel.string = level.toString();\r\n    }\r\n\r\n    private onClick() {\r\n        if (BoardMgr.board[this.index].IsLiWu && !BoardMgr.board[this.index].IsLiWuFlying)\r\n        {\r\n            LiWuMgr.openLiwu(this.index);\r\n        }\r\n    }\r\n\r\n    public setSelectVisible(visible: boolean) {\r\n        this.SuCaiSelect.node.active = visible;\r\n    }\r\n\r\n    public ShowSucaiSelect(isShow:boolean){\r\n        const HechengGUI = oops.gui.get(UIID.MainUI);\r\n        if (HechengGUI) \r\n        {\r\n            const HechengCom = HechengGUI.getComponent(HeChengComponent);\r\n            if (HechengCom) \r\n            {\r\n                HechengCom.ShowSucaiSelect(isShow, this.index);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}