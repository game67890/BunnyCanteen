{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/pullingcarrots/CarrotAutoComponent.ts"],"names":["_decorator","Component","Label","Button","Slider","Toggle","color","oops","UIID","GameEvent","TonGameMgr","StringUtil","CarrotMgr","CarrotComponent","TableOtherParameter","UtilMgr","ccclass","property","CarrotAutoComponent","tablereward","neednum","_curPullTimes","onAdded","params","init","onDestroy","removeEvent","addEvent","message","on","UpdateBaseData","onUpdateData","UpdateCarrotCoin","off","event","args","updateBaseData","updateCarrotCoin","CostCarrotCoinNum","string","CarrotCoin","toString","NeedCostCarrotCoinNum","TitleName","language","getLangByID","JumpTxt","StartBtnTxt","Number","parameter","PullSlider","progress","CheckBox","isChecked","RefreshShowInfo","onCloseBtnClick","PlaySoundEffect","gui","remove","CarrotAuto","onStartBtnClick","LeftTimes","IsJumpAnim","SendBaLuoBo","CarrotMainUI","get","CarrotMain","CarrotMainCom","getComponent","StartPulling","onAddBtnClick","toast","onSubBtnClick","ChangeSlider","maxnum","Math","floor","i","PullTimes","substitute_1","onCheckboxClick"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label, Prefab, instantiate, Vec3, UITransform } from 'cc';\r\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\r\nimport { TonGameMgr, AutoTypeEnum } from \"../manager/TonGameManager\";\r\nimport { StringUtil } from \"../../../../extensions/oops-plugin-framework/assets/core/utils/StringUtil\";\r\nimport { Button } from 'cc';\r\nimport { CarrotMgr } from './CarrotManager';\r\nimport { Slider } from 'cc';\r\nimport { Toggle } from 'cc';\r\nimport { CarrotComponent } from './CarrotComponent';\r\nimport { TableOtherParameter } from \"../../framework/common/table/TableOtherParameter\";\r\nimport { color } from 'cc';\r\nimport { UtilMgr } from '../manager/UtilManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CarrotAutoComponent')\r\nexport class CarrotAutoComponent extends Component {\r\n    @property(Button)\r\n    CloseBtn: Button;\r\n    @property(Label)\r\n    TitleName: Label;\r\n    @property(Label)\r\n    JumpTxt: Label;\r\n    @property(Button)\r\n    SubBtn: Button;\r\n    @property(Button)\r\n    AddBtn: Button;\r\n    @property(Label)\r\n    PullTimes: Label;\r\n    @property(Slider)\r\n    PullSlider: Slider;\r\n    @property(Toggle)\r\n    CheckBox: Toggle;\r\n    @property(Label)\r\n    CostCarrotCoinNum: Label;\r\n    @property(Label)\r\n    NeedCostCarrotCoinNum: Label;\r\n    @property(Button)\r\n    StartBtn: Button;\r\n    @property(Label)\r\n    StartBtnTxt: Label;\r\n    private tablereward = new TableOtherParameter();\r\n    private neednum: number = 0;\r\n\r\n    private _curPullTimes:number = 0;  //次数\r\n\r\n    onAdded(params: any): boolean {\r\n        this.init();\r\n        return true;\r\n    }\r\n\r\n    onDestroy() {\r\n        this.removeEvent();\r\n    }\r\n\r\n    /** 添加全局消息事件 */\r\n    private addEvent() {\r\n        oops.message.on(GameEvent.UpdateBaseData, this.onUpdateData, this);\r\n        oops.message.on(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    /** 移除全局消息事件 */\r\n    private removeEvent() {\r\n        oops.message.off(GameEvent.UpdateBaseData, this.onUpdateData, this);\r\n        oops.message.off(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    private onUpdateData(event: string, args: any) {\r\n        switch (event) {\r\n            case GameEvent.UpdateBaseData:\r\n                this.updateBaseData();\r\n                break;\r\n            case GameEvent.UpdateCarrotCoin:\r\n                this.updateCarrotCoin();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private updateBaseData() {\r\n        this.CostCarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n        this.NeedCostCarrotCoinNum.string = \"/\" + (this.neednum*this._curPullTimes).toString();\r\n        if (TonGameMgr.CarrotCoin >= this.neednum*this._curPullTimes) {\r\n            this.CostCarrotCoinNum.color = color(85, 5, 5);\r\n        }\r\n        else {\r\n            this.CostCarrotCoinNum.color = color(255, 0, 0);\r\n        }\r\n    }\r\n\r\n    private updateCarrotCoin()\r\n    {\r\n        this.CostCarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n    }\r\n\r\n    public init() {\r\n        this.TitleName.string = oops.language.getLangByID(\"stringres_035\");\r\n        this.JumpTxt.string = oops.language.getLangByID(\"stringres_037\");\r\n        this.StartBtnTxt.string = oops.language.getLangByID(\"stringres_178\");\r\n        this.tablereward.init(1);\r\n        this.neednum = Number(this.tablereward.parameter)\r\n        this._curPullTimes = 0;\r\n        this.PullSlider.progress = 0;\r\n        this.CheckBox.isChecked = false;\r\n        this.addEvent();\r\n        this.RefreshShowInfo();\r\n    }\r\n\r\n    // 点击关闭按钮\r\n    public onCloseBtnClick() {\r\n        UtilMgr.PlaySoundEffect(19);\r\n        oops.gui.remove(UIID.CarrotAuto);\r\n    }\r\n\r\n    // 点击开始按钮\r\n    public onStartBtnClick() {\r\n        CarrotMgr.LeftTimes = this._curPullTimes;\r\n        oops.gui.remove(UIID.CarrotAuto);\r\n        CarrotMgr.IsJumpAnim = this.CheckBox.isChecked;\r\n        if (CarrotMgr.LeftTimes <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (this.CheckBox.isChecked) {\r\n            CarrotMgr.SendBaLuoBo(CarrotMgr.LeftTimes);\r\n            CarrotMgr.LeftTimes = 0;\r\n        }\r\n        else {\r\n            const CarrotMainUI = oops.gui.get(UIID.CarrotMain);\r\n            if (CarrotMainUI) {\r\n                const CarrotMainCom = CarrotMainUI.getComponent(CarrotComponent);\r\n                if (CarrotMainCom) {\r\n                    CarrotMainCom.StartPulling();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // 点击加号按钮\r\n    public onAddBtnClick() {\r\n        UtilMgr.PlaySoundEffect(18);\r\n        if ((TonGameMgr.CarrotCoin - this.neednum * this._curPullTimes) < this.neednum) {\r\n            // 当前萝卜币数量不足\r\n            oops.gui.toast(\"message_07\", true);\r\n            return;\r\n        }\r\n        this._curPullTimes = this._curPullTimes + 1;\r\n        this.RefreshShowInfo();\r\n    }\r\n\r\n    // 点击减号按钮\r\n    public onSubBtnClick() {\r\n        UtilMgr.PlaySoundEffect(18);\r\n        if (this._curPullTimes <= 0)\r\n        {\r\n            return;\r\n        }\r\n        this._curPullTimes = this._curPullTimes - 1;\r\n        this.RefreshShowInfo();\r\n    }\r\n\r\n    public ChangeSlider() {\r\n        let maxnum = Math.floor(TonGameMgr.CarrotCoin/this.neednum);\r\n        // let maxnum = 10;\r\n        if (maxnum <= 0) {\r\n            this._curPullTimes = 0;\r\n\t\t\tthis.RefreshShowInfo();\r\n            return;\r\n        }\r\n\r\n        for (let i=0; i<maxnum; i++) {\r\n            if (i/maxnum <= this.PullSlider.progress && (i+1)/maxnum > this.PullSlider.progress) {\r\n                if ((this.PullSlider.progress-i/maxnum) < ((i+1)/maxnum-this.PullSlider.progress)) {\r\n                    this._curPullTimes = i;\r\n                }\r\n                else {\r\n                    this._curPullTimes = i+1;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.RefreshShowInfo();\r\n    }\r\n\r\n    // 刷新次数进度以及花费兔子比显示\r\n    public RefreshShowInfo() {\r\n        this.PullTimes.string = StringUtil.substitute_1(oops.language.getLangByID(\"stringres_036\"), this._curPullTimes);\r\n        this.CostCarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n        this.NeedCostCarrotCoinNum.string = \"/\" + (this.neednum*this._curPullTimes).toString();\r\n        if (TonGameMgr.CarrotCoin >= this.neednum*this._curPullTimes) {\r\n            this.CostCarrotCoinNum.color = color(85, 5, 5);\r\n        }\r\n        else {\r\n            this.CostCarrotCoinNum.color = color(255, 0, 0);\r\n        }\r\n        if (this._curPullTimes <= 0) {\r\n            this.PullSlider.progress = 0;\r\n        }\r\n        else {\r\n            this.PullSlider.progress = this._curPullTimes/Math.floor(TonGameMgr.CarrotCoin/this.neednum);\r\n            // this.PullSlider.progress = this._curPullTimes/10;\r\n        }\r\n    }\r\n\r\n    // 点击Checkbox按钮\r\n    public onCheckboxClick() {\r\n        if (this.CheckBox.isChecked == false) {\r\n            this.CheckBox.isChecked = true;\r\n        }\r\n        else {\r\n            this.CheckBox.isChecked = false;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}