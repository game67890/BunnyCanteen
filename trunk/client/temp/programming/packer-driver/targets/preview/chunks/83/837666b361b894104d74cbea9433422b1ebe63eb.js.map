{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/framework/initialize/bll/InitRes.ts"],"names":["oops","AsyncQueue","ecs","UIID","LoadingViewComp","InitResComp","register","Comp","reset","InitResSystem","ComblockSystem","filter","allOf","entityEnter","e","queue","loadCustom","loadLanguage","loadCommon","onComplete","play","push","next","params","args","res","load","language","current","lan","setLanguage","loadDir","complete","node","gui","openAsync","Loading","add","getComponent","remove"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOSA,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,I,iBAAAA,I;;AAEAC,MAAAA,e,iBAAAA,e;;;;;;AAZT;AACA;AACA;AACA;AACA;AACA;;;AASA;6BAEaC,W,WADZ;AAAA;AAAA,sBAAIC,QAAJ,CAAa,SAAb,C,gBAAD,MACaD,WADb,SACiC;AAAA;AAAA,sBAAIE,IADrC,CAC0C;AACtCC,QAAAA,KAAK,GAAG,CAAG;;AAD2B,O;;+BAK7BC,a,YADZ;AAAA;AAAA,sBAAIH,QAAJ,CAAa,YAAb,C,kBAAD,MACaG,aADb,SACmC;AAAA;AAAA,sBAAIC,cADvC,CACwF;AACpFC,QAAAA,MAAM,GAAiB;AACnB,iBAAO;AAAA;AAAA,0BAAIC,KAAJ,CAAUP,WAAV,CAAP;AACH;;AAEDQ,QAAAA,WAAW,CAACC,CAAD,EAAsB;AAC7B,cAAIC,KAAiB,GAAG;AAAA;AAAA,yCAAxB,CAD6B,CAG7B;;AACA,eAAKC,UAAL,CAAgBD,KAAhB,EAJ6B,CAK7B;;AACA,eAAKE,YAAL,CAAkBF,KAAlB,EAN6B,CAO7B;;AACA,eAAKG,UAAL,CAAgBH,KAAhB,EAR6B,CAS7B;;AACA,eAAKI,UAAL,CAAgBJ,KAAhB,EAAuBD,CAAvB;AAEAC,UAAAA,KAAK,CAACK,IAAN;AACH;AAED;;;AACQJ,QAAAA,UAAU,CAACD,KAAD,EAAoB;AAClCA,UAAAA,KAAK,CAACM,IAAN,iCAAW,WAAOC,IAAP,EAA2BC,MAA3B,EAAwCC,IAAxC,EAAsD;AAC7D;AACA;AAAA;AAAA,8BAAKC,GAAL,CAASC,IAAT,CAAc,mBAAmB;AAAA;AAAA,8BAAKC,QAAL,CAAcC,OAA/C,EAAwDN,IAAxD;AACH,WAHD;AAIH;AAED;;;AACQL,QAAAA,YAAY,CAACF,KAAD,EAAoB;AACpCA,UAAAA,KAAK,CAACM,IAAN,CAAW,CAACC,IAAD,EAAqBC,MAArB,EAAkCC,IAAlC,KAAgD;AACvD;;AACA;AACZ;AACA;AACA;AACA;AACA;AACA;AACY;AACA,gBAAIK,GAAG,GAAG,IAAV;AACA;AAAA;AAAA,8BAAKF,QAAL,CAAcG,WAAd,CAA0BD,GAA1B,EAA+BP,IAA/B;AACH,WAZD;AAaH;AAED;;;AACQJ,QAAAA,UAAU,CAACH,KAAD,EAAoB;AAClCA,UAAAA,KAAK,CAACM,IAAN,CAAW,CAACC,IAAD,EAAqBC,MAArB,EAAkCC,IAAlC,KAAgD;AACvD;AAAA;AAAA,8BAAKC,GAAL,CAASM,OAAT,CAAiB,QAAjB,EAA2BT,IAA3B;AACH,WAFD;AAGH;AAED;;;AACQH,QAAAA,UAAU,CAACJ,KAAD,EAAoBD,CAApB,EAAmC;AACjDC,UAAAA,KAAK,CAACiB,QAAN,kCAAiB,aAAY;AACzB,gBAAIC,IAAI,SAAS;AAAA;AAAA,8BAAKC,GAAL,CAASC,SAAT,CAAmB;AAAA;AAAA,8BAAKC,OAAxB,CAAjB;AACA,gBAAIH,IAAJ,EAAUnB,CAAC,CAACuB,GAAF,CAAMJ,IAAI,CAACK,YAAL;AAAA;AAAA,mDAAN;AACVxB,YAAAA,CAAC,CAACyB,MAAF,CAASlC,WAAT;AACH,WAJD;AAKH;;AA3DmF,O","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2022-07-22 17:06:22\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-09-22 14:41:58\r\n */\r\n\r\nimport { oops } from \"../../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { AsyncQueue, NextFunction } from \"../../../../../extensions/oops-plugin-framework/assets/libs/collection/AsyncQueue\";\r\nimport { ecs } from \"../../../../../extensions/oops-plugin-framework/assets/libs/ecs/ECS\";\r\nimport { UIID } from \"../../common/config/GameUIConfig\";\r\nimport { Initialize } from \"../Initialize\";\r\nimport { LoadingViewComp } from \"../view/LoadingViewComp\";\r\n\r\n/** 初始化游戏公共资源 */\r\n@ecs.register('InitRes')\r\nexport class InitResComp extends ecs.Comp {\r\n    reset() { }\r\n}\r\n\r\n@ecs.register('Initialize')\r\nexport class InitResSystem extends ecs.ComblockSystem implements ecs.IEntityEnterSystem {\r\n    filter(): ecs.IMatcher {\r\n        return ecs.allOf(InitResComp);\r\n    }\r\n\r\n    entityEnter(e: Initialize): void {\r\n        var queue: AsyncQueue = new AsyncQueue();\r\n\r\n        // 加载自定义资源\r\n        this.loadCustom(queue);\r\n        // 加载多语言包\r\n        this.loadLanguage(queue);\r\n        // 加载公共资源\r\n        this.loadCommon(queue);\r\n        // 加载游戏内容加载进度提示界面\r\n        this.onComplete(queue, e);\r\n\r\n        queue.play();\r\n    }\r\n\r\n    /** 加载自定义内容（可选） */\r\n    private loadCustom(queue: AsyncQueue) {\r\n        queue.push(async (next: NextFunction, params: any, args: any) => {\r\n            // 加载多语言对应字体\r\n            oops.res.load(\"language/font/\" + oops.language.current, next);\r\n        });\r\n    }\r\n\r\n    /** 加载化语言包（可选） */\r\n    private loadLanguage(queue: AsyncQueue) {\r\n        queue.push((next: NextFunction, params: any, args: any) => {\r\n            // 设置默认语言\r\n            /*\r\n            let lan = oops.storage.get(\"language\");\r\n            if (lan == null || lan == \"\") {\r\n                lan = \"en\";\r\n                oops.storage.set(\"language\", lan);\r\n            }\r\n            */\r\n            // 加载语言包资源\r\n            let lan = \"en\";\r\n            oops.language.setLanguage(lan, next);\r\n        });\r\n    }\r\n\r\n    /** 加载公共资源（必备） */\r\n    private loadCommon(queue: AsyncQueue) {\r\n        queue.push((next: NextFunction, params: any, args: any) => {\r\n            oops.res.loadDir(\"common\", next);\r\n        });\r\n    }\r\n\r\n    /** 加载完成进入游戏内容加载界面 */\r\n    private onComplete(queue: AsyncQueue, e: Initialize) {\r\n        queue.complete = async () => {\r\n            var node = await oops.gui.openAsync(UIID.Loading);\r\n            if (node) e.add(node.getComponent(LoadingViewComp) as ecs.Comp);\r\n            e.remove(InitResComp);\r\n        };\r\n    }\r\n}"]}