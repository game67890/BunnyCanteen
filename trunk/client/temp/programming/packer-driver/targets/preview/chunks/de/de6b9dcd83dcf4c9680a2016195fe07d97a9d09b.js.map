{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/hecheng/GPDrag.ts"],"names":["_decorator","CCFloat","Component","Enum","Node","NodeEventType","tween","Vec2","Vec3","GPWorkFlow","GPWorkFlowNode","GridComponent","BoardMgr","oops","GameEvent","HeChengMgr","UtilMgr","GuideMgr","ccclass","property","FloatType","DragBackHomeType","EasingString","GPDrag","tooltip","type","visible","backHomeWhenFailed","backHomeType","Tween","floatType","MoveToTopLayer","None","srcParent","zOrder","parentZOrder","dragStartPos","dragOffset","succeedCheck","succeedCallback","backTween","backHomeWorkFlow","start","set","node","position","x","y","on","TOUCH_START","OnDragStart","TOUCH_MOVE","OnDragMove","TOUCH_END","OnDragEnd","TOUCH_CANCEL","moveNode","headNode","self","OnStart","wfNode","p","SetPosition","setPosition","done","stop","easing","backTweenEasing","to","backTweenTime","call","arrivedNode","nextNode","OnArrivedHome","e","IsPlayHechengingAnim","ResetGuide","DragGridComponent","parent","getComponent","InDragIndex","index","board","IsLiWu","PlaySoundEffect","IsDraging","message","dispatchEvent","UpdateHuishouBtn","ShowSucaiSelect","touchPoint","getUILocation","subtract","MoveToTop","getSiblingIndex","setSiblingIndex","topLayerNode","touchOffsetSensitive","StopSoundEffect","IsHuiShou","HandleHuiShou","destIndex","getTouchItem","params","DestIndex","SrcIndex","OnGridContract","console","log","backToOriZ","onDestroy","off","update","dt","linear"],"mappings":"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","sourcesContent":["import { _decorator, CCBoolean, TweenEasing , CCFloat, CCString, Component, easing, Enum, EventTouch, isValid, Node, NodeEventType, Tween, tween, Vec2, Vec3 } from 'cc';\nimport { GPWorkFlow, GPWorkFlowNode } from './GPWorkFlow';\nimport { GridComponent } from \"../hecheng/GridComponent\";\nimport { BoardMgr } from \"../manager/BoardManager\";\nimport { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\nimport { GameEvent } from \"../../framework/common/config/GameEvent\";\nimport { HeChengMgr } from \"../hecheng/HeChengManager\";\nimport { UtilMgr } from '../manager/UtilManager';\nimport { GuideMgr } from \"../hecheng/GuideManager\";\n\nconst { ccclass, property } = _decorator;\n\nexport enum FloatType {\n    None,\n    MoveToTop,\n    MoveToTopLayer,\n    // CopyToTopLayer\n}\nexport enum DragBackHomeType {\n    SetPosition,\n    Tween\n}\nexport enum EasingString {\n    'linear'    , 'smooth'     , 'fade'         , 'constant'     ,\n    'quadIn'    , 'quadOut'    , 'quadInOut'    , 'quadOutIn'    ,\n    'cubicIn'   , 'cubicOut'   , 'cubicInOut'   , 'cubicOutIn'   ,\n    'quartIn'   , 'quartOut'   , 'quartInOut'   , 'quartOutIn'   ,\n    'quintIn'   , 'quintOut'   , 'quintInOut'   , 'quintOutIn'   ,\n    'sineIn'    , 'sineOut'    , 'sineInOut'    , 'sineOutIn'    ,\n    'expoIn'    , 'expoOut'    , 'expoInOut'    , 'expoOutIn'    ,\n    'circIn'    , 'circOut'    , 'circInOut'    , 'circOutIn'    ,\n    'elasticIn' , 'elasticOut' , 'elasticInOut' , 'elasticOutIn' ,\n    'backIn'    , 'backOut'    , 'backInOut'    , 'backOutIn'    ,\n    'bounceIn'  , 'bounceOut'  , 'bounceInOut'  , 'bounceOutIn'\n}\n@ccclass('GPDrag')\nexport class GPDrag extends Component {\n    @property({tooltip:\"触碰点偏移量敏感\"})\n    public touchOffsetSensitive = false\n\n    @property({tooltip:\"失败时回到起始位置\"})\n    public backHomeWhenFailed = true\n\n    @property({type:Enum(DragBackHomeType), tooltip:\"回家的方式\", visible:function(this){\n        return this.backHomeWhenFailed\n    }})\n    public backHomeType:DragBackHomeType = DragBackHomeType.SetPosition\n\n    @property({type:CCFloat, visible:function(this) {\n        return this.backHomeWhenFailed && this.backHomeType == DragBackHomeType.Tween\n    }})\n    public backTweenTime:number = 1;\n\n    @property({type:Enum(EasingString), tooltip:\"缓动类型\", visible:function(this) {\n        return this.backHomeWhenFailed && this.backHomeType == DragBackHomeType.Tween\n    }})\n    public backTweenEasing:EasingString = EasingString.linear\n\n    @property({type:Enum(FloatType), tooltip:\"上浮类型\"})\n    public floatType:FloatType = FloatType.None\n\n    @property({type:Node, visible:function(this){\n        return this.floatType == FloatType.MoveToTopLayer \n        // || this.floatType == FloatType.CopyToTopLayer\n    }})\n    public topLayerNode:Node\n\n    @property({tooltip:\"松开后返回原来的层级\", visible:function(){\n        return this.floatType != FloatType.None\n    }})\n    public backToOriZ = true;\n    private srcParent:Node\n    private zOrder:number\n    private parentZOrder:number\n    private dragStartPos:Vec2 = new Vec2(0, 0)\n    private dragOffset:Vec2 = new Vec2(0, 0)\n    public succeedCheck:Function = null;\n    public succeedCallback:Function = null;\n    private backTween:Tween<Node>\n\n    public backHomeWorkFlow = new GPWorkFlow();\n    start() {\n        this.dragStartPos.set(this.node.position.x, this.node.position.y);\n\n        this.node.on(NodeEventType.TOUCH_START, this.OnDragStart, this)\n        this.node.on(NodeEventType.TOUCH_MOVE, this.OnDragMove, this)\n        this.node.on(NodeEventType.TOUCH_END, this.OnDragEnd, this)\n        this.node.on(NodeEventType.TOUCH_CANCEL, this.OnDragEnd, this)\n\n        let moveNode = new GPWorkFlowNode();\n        this.backHomeWorkFlow.headNode = moveNode;\n        let self = this;\n        moveNode.OnStart = (wfNode:GPWorkFlowNode)=>{\n            let p = new Vec3(self.dragStartPos.x, self.dragStartPos.y, 0);\n            switch(this.backHomeType) {\n                case DragBackHomeType.SetPosition:\n                    self.node.setPosition(p)\n                    wfNode.done();\n                    break;\n                case DragBackHomeType.Tween:\n                    self.backTween && self.backTween.stop()\n                    let easing:TweenEasing = EasingString[self.backTweenEasing] as TweenEasing\n                    self.backTween = tween(self.node)\n                        .to(self.backTweenTime, {position:p}, {easing:easing}).call(()=>{\n                            wfNode.done();\n                        }).start()\n                    break;\n            }\n        }\n\n        let arrivedNode = new GPWorkFlowNode();\n        moveNode.nextNode = arrivedNode;\n        arrivedNode.OnStart = (wfNode:GPWorkFlowNode)=>{\n            self.OnArrivedHome();\n            wfNode.done();\n        }\n    }\n\n    private OnDragStart(e:EventTouch) {\n        if (HeChengMgr.IsPlayHechengingAnim)\n        {\n            return;\n        }\n        GuideMgr.ResetGuide();\n        const DragGridComponent = this.node.parent.getComponent(GridComponent);\n        if (DragGridComponent)\n        {\n            BoardMgr.InDragIndex = DragGridComponent.index;\n            if (BoardMgr.board[BoardMgr.InDragIndex].IsLiWu) {\n                UtilMgr.PlaySoundEffect(27);\n            } else {\n                UtilMgr.PlaySoundEffect(17);\n                HeChengMgr.IsDraging = true;\n                oops.message.dispatchEvent(GameEvent.UpdateHuishouBtn);\n                DragGridComponent.ShowSucaiSelect(true);\n\n                let touchPoint = e.getUILocation();\n                Vec2.subtract(this.dragOffset, this.dragStartPos, touchPoint)\n                switch(this.floatType) {\n                    case FloatType.MoveToTop:\n                        this.parentZOrder = this.node.parent.getSiblingIndex();\n                        this.node.parent.setSiblingIndex(1000);\n                        this.zOrder = this.node.getSiblingIndex();\n                        this.node.setSiblingIndex(1000);\n                        break;\n                    case FloatType.MoveToTopLayer:\n                        this.zOrder = this.node.getSiblingIndex()\n                        this.srcParent = this.node.parent\n                        this.node.parent = this.topLayerNode;\n                        break;\n                }\n            }\n        }\n    }\n\n    private OnDragMove(e:EventTouch) {\n        if (HeChengMgr.IsDraging)\n        {\n            let p = e.getUILocation();\n            if (this.touchOffsetSensitive)\n                this.node.setPosition(new Vec3(p.x + this.dragOffset.x, p.y + this.dragOffset.y, 0))\n            else\n                this.node.setPosition(new Vec3(p.x, 0, p.y))\n        }\n    }\n\n    private OnDragEnd(e:EventTouch) {\n        HeChengMgr.IsDraging = false;\n\n        UtilMgr.StopSoundEffect();\n        const DragGridComponent = this.node.parent.getComponent(GridComponent);\n        if (DragGridComponent)\n        {\n            DragGridComponent.ShowSucaiSelect(false);\n        }\n        if (BoardMgr.IsHuiShou)\n        {\n            HeChengMgr.HandleHuiShou(BoardMgr.InDragIndex);\n        }\n        else\n        {\n            const DragGridComponent = this.node.parent.getComponent(GridComponent);\n            if (DragGridComponent)\n            {\n                let destIndex = BoardMgr.getTouchItem(DragGridComponent.index);\n                if (destIndex > -1)\n                {\n                    let params : any = {};\n                    params.DestIndex = destIndex;\n                    params.SrcIndex = DragGridComponent.index;\n                    oops.message.dispatchEvent(GameEvent.OnGridContract, params);\n                }\n                else\n                {\n                    console.log(\"no touchingMap\");\n                }\n            }\n            else\n            {\n                console.log(\"no GridComponent\");\n            }\n        }\n\n        this.backHomeWorkFlow.start();\n        BoardMgr.InDragIndex = 0;\n        oops.message.dispatchEvent(GameEvent.UpdateHuishouBtn);\n    }\n\n    private OnArrivedHome() {\n        if (this.backToOriZ)\n        switch(this.floatType) {\n            case FloatType.MoveToTop:\n                this.node.setSiblingIndex(this.zOrder)\n                this.node.parent.setSiblingIndex(this.parentZOrder)\n                break;\n            case FloatType.MoveToTopLayer:\n                this.node.parent = this.srcParent;\n                this.node.setSiblingIndex(this.zOrder)\n                break;\n        }\n    }\n\n    protected onDestroy(): void {\n        this.node.off(NodeEventType.TOUCH_START, this.OnDragStart, this)\n        this.node.off(NodeEventType.TOUCH_MOVE, this.OnDragMove, this)\n        this.node.off(NodeEventType.TOUCH_END, this.OnDragEnd, this)\n        this.node.off(NodeEventType.TOUCH_CANCEL, this.OnDragEnd, this)\n    }\n    protected update(dt: number): void {\n        this.backHomeWorkFlow.update(dt)\n    }\n}"]}