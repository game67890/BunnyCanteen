{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/payment/PaymentManager.ts"],"names":["DataItem","PaymentManager","oops","UIID","ProtocolMgr","TonGameMgr","PaymentComponent","UtilMgr","price","carrotcoin","gift","strength","paytype","left","imageUrl","ID","name","discountdesc1","discountdesc2","shopItemList","OpenPaymentUI","gui","open","PaymentUI","GetPaymentData","callback","completeShop","ret","isSucc","JSON","parse","res","shopGoods","PaymentMgr","data","userID","UserId","shopID","param","stringify","sendChargeShop","getShopItem","GoodID","key","hasOwnProperty","value","modifyShopItem","LeftChange","ProcessPay","protocol","carrotCoin","CarrotCoin","PlaySoundEffect","updateCarrotCoin","item","modifyGiftNum","PaymentGUI","get","PaymentCom","getComponent","refreshGridList"],"mappings":"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","sourcesContent":["import { oops } from \"../../../../extensions/oops-plugin-framework/assets/core/Oops\";\r\nimport { UIID } from \"../../framework/common/config/GameUIConfig\";\r\nimport { ProtocolMgr } from \"../manager/ProtocolManager\";\r\nimport { HttpReturn } from \"../../../../extensions/oops-plugin-framework/assets/libs/network/HttpRequest\";\r\n\r\n\r\nimport { TonGameMgr } from \"../manager/TonGameManager\";\r\nimport { PaymentComponent } from \"./PaymentComponent\";\r\nimport { UtilMgr } from \"../manager/UtilManager\";\r\n\r\n\r\nexport class DataItem {\r\n    //单价\r\n    price: number = 0;\r\n    //萝卜币\r\n    carrotcoin: number = 0;\r\n    //礼盒\r\n    gift: number = 0;\r\n    //体力\r\n    strength : number = 0;\r\n    //支付类型\r\n    paytype: number = 0;\r\n    //库存数量\r\n    left: number = 0;\r\n    imageUrl: string;\r\n    //商品ID\r\n    ID: number = 0;\r\n    //商品名称\r\n    name: string;\r\n    //折扣描述1\r\n    discountdesc1: string;\r\n    //折扣描述2\r\n    discountdesc2: string;\r\n}\r\n\r\nexport class PaymentManager {\r\n    public shopItemList: any = null;\r\n\r\n    //拉起支付界面\r\n    public OpenPaymentUI() {\r\n        oops.gui.open(UIID.PaymentUI);\r\n    }\r\n\r\n    public GetPaymentData(callback?: Function){\r\n        var completeShop = (ret: HttpReturn) => {\r\n            if (ret.isSucc)\r\n            {\r\n                let shopItemList = JSON.parse(ret.res.shopGoods);\r\n                PaymentMgr.shopItemList = shopItemList;\r\n                if (callback)\r\n                {\r\n                    callback();\r\n                }\r\n            }\r\n        }\r\n        const data: { [key: string]: any } = {};\r\n        data.userID = TonGameMgr.UserId;\r\n        data.shopID = 1;\r\n\r\n        const param = JSON.stringify(data);\r\n        ProtocolMgr.sendChargeShop(completeShop, param);\r\n    }\r\n\r\n    public getShopItem(GoodID:number) : DataItem {\r\n        for (const key in this.shopItemList) {\r\n            if (this.shopItemList.hasOwnProperty(key)) {\r\n                let value = this.shopItemList[key];\r\n                if (value.ID == GoodID)\r\n                {\r\n                    return value;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    \r\n    public modifyShopItem(GoodID:number, LeftChange:number) : boolean {\r\n        for (const key in PaymentMgr.shopItemList) {\r\n            if (PaymentMgr.shopItemList.hasOwnProperty(key)) {\r\n                let value = PaymentMgr.shopItemList[key];\r\n                if (value.ID == GoodID)\r\n                {\r\n                    PaymentMgr.shopItemList[key].left = PaymentMgr.shopItemList[key].left + LeftChange;\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public ProcessPay(protocol)\r\n    {\r\n        if (protocol.carrotCoin)\r\n        {\r\n            if (protocol.carrotCoin > TonGameMgr.CarrotCoin) {\r\n                UtilMgr.PlaySoundEffect(20);    // 充值成功播放音效\r\n            }\r\n            TonGameMgr.updateCarrotCoin(protocol.carrotCoin);\r\n        }\r\n        let item = this.getShopItem(protocol.GoodID);\r\n        if (item.gift > 0)\r\n        {\r\n            TonGameMgr.modifyGiftNum(item.gift);\r\n        }\r\n\r\n        if (this.modifyShopItem(protocol.GoodID, protocol.LeftChange))\r\n        {\r\n            const PaymentGUI = oops.gui.get(UIID.PaymentUI);\r\n            if (PaymentGUI)\r\n            {\r\n                const PaymentCom = PaymentGUI.getComponent(PaymentComponent);\r\n                if (PaymentCom)\r\n                {\r\n                    PaymentCom.refreshGridList();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n} \r\n\r\nexport var PaymentMgr = new PaymentManager();"]}