{"version":3,"sources":["file:///F:/TON-Game/src/trunk/client/assets/scripts/tongame/shop/ShopMain.ts"],"names":["ShowDataItem","_decorator","Component","Label","VirtualGridList","oops","UIID","HeChengMgr","GameEvent","TonGameMgr","TableShop","JsonUtil","PaymentMgr","UtilMgr","ccclass","property","configid","ShopMain","_dataList","tablerecord","onAdded","params","init","addEvent","table","get","TableName","id","Number","item","push","initGridList","TitleName","string","language","getLangByID","updateBaseData","updateTuziCoin","onDestroy","removeEvent","message","on","UpdateBaseData","onUpdateData","OnShopListChange","updategridList","UpdateTuziCoin","UpdateCarrotCoin","off","event","args","updateCarrotCoin","RabbitCoinNum","formatNumber","TuZiCoin","CarrotCoinNum","CarrotCoin","toString","gridList","refreshItemDisplays","clearList","paddingTop","paddingBottom","spacingX","spacingY","columnNum","useVirtualLayout","emptyTip","cacheImage","registerSelectOneItemEventHandler","_onSelectOneItem","appendItemsToDisplayList","data","console","log","onAddBtnClick","PlaySoundEffect","OpenPaymentUI","onTuziAddBtnClick","onGotoCarrots","onCloseBtnClick","gui","remove"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Button, Label } from 'cc';\r\nimport { VirtualGridList } from \"../../../resources/libs/virtual_grid_list/virtual_grid_list\";\r\nimport { oops } from '../../../../extensions/oops-plugin-framework/assets/core/Oops';\r\nimport { UIID } from '../../framework/common/config/GameUIConfig';\r\nimport { HeChengMgr } from '../hecheng/HeChengManager';\r\nimport { GameEvent } from '../../framework/common/config/GameEvent';\r\nimport { TonGameMgr } from '../manager/TonGameManager';\r\nimport { TableShop } from '../../framework/common/table/TableShop';\r\nimport { JsonUtil } from '../../../../extensions/oops-plugin-framework/assets/core/utils/JsonUtil';\r\nimport { PaymentMgr } from '../payment/PaymentManager';\r\nimport { UtilMgr } from '../manager/UtilManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nclass ShowDataItem {\r\n    configid : number = 0;\r\n}\r\n\r\n@ccclass('ShopMain')\r\nexport class ShopMain extends Component {\r\n    @property(Label)\r\n    TitleName : Label;\r\n    @property(Label)\r\n    RabbitCoinNum : Label;\r\n    @property(Label)\r\n    CarrotCoinNum : Label;\r\n\r\n    @property(VirtualGridList)\r\n    protected gridList: VirtualGridList = null;\r\n\r\n    private _dataList: any[] = [];\r\n    private tablerecord = new TableShop();\r\n\r\n    onAdded(params: any): boolean {\r\n        this.init();\r\n        this.addEvent();\r\n        var table = JsonUtil.get(TableShop.TableName);\r\n\r\n        this._dataList = [];\r\n        if (table) {\r\n            for (let id in table) {\r\n                this.tablerecord.init(Number(id));\r\n                const item: ShowDataItem = {\r\n                    configid: Number(id),\r\n                }\r\n                this._dataList.push(item);\r\n            }\r\n        }\r\n        this.initGridList();\r\n        return true;\r\n    }\r\n\r\n    private init() {\r\n        this.TitleName.string = oops.language.getLangByID(\"stringres_180\");\r\n        this.updateBaseData();\r\n        this.updateTuziCoin();\r\n    }\r\n\r\n    onDestroy() {\r\n        this.removeEvent();\r\n    }\r\n\r\n    /** 添加全局消息事件 */\r\n    private addEvent() {\r\n        oops.message.on(GameEvent.UpdateBaseData, this.onUpdateData, this);\r\n        oops.message.on(GameEvent.OnShopListChange, this.updategridList, this);\r\n        oops.message.on(GameEvent.UpdateTuziCoin, this.onUpdateData, this);\r\n        oops.message.on(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    /** 移除全局消息事件 */\r\n    private removeEvent() {\r\n        oops.message.off(GameEvent.UpdateBaseData, this.onUpdateData, this);\r\n        oops.message.off(GameEvent.OnShopListChange, this.updategridList, this);\r\n        oops.message.off(GameEvent.UpdateTuziCoin, this.onUpdateData, this);\r\n        oops.message.off(GameEvent.UpdateCarrotCoin, this.onUpdateData, this);\r\n    }\r\n\r\n    private onUpdateData(event: string, args: any) {\r\n        switch (event) {\r\n            case GameEvent.UpdateBaseData:\r\n                this.updateBaseData();\r\n                break;\r\n            case GameEvent.UpdateTuziCoin:\r\n                this.updateTuziCoin();\r\n                break;\r\n            case GameEvent.UpdateCarrotCoin:\r\n                this.updateCarrotCoin();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private updateTuziCoin()\r\n    {\r\n        this.RabbitCoinNum.string = UtilMgr.formatNumber(TonGameMgr.TuZiCoin);\r\n    }\r\n\r\n    private updateCarrotCoin()\r\n    {\r\n        this.CarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n    }\r\n\r\n    private updategridList() {\r\n        this.gridList.refreshItemDisplays();\r\n    }\r\n\r\n    private updateBaseData() {\r\n\r\n        this.CarrotCoinNum.string = TonGameMgr.CarrotCoin.toString();\r\n        this.updategridList();\r\n    }\r\n\r\n    initGridList() {\r\n        /*  paddingTop: 列表距离上边缘距离 默认为0\r\n        paddingBottom: 列表距离下边缘距离 默认为0\r\n        spacingX: 列间距 默认为3\r\n        spacingY: 行间距 默认为3\r\n        columnNum: 列数 默认为0，自动适配容器宽度\r\n        useVirtualLayout: 是否启用虚拟列表 默认为true\r\n        emptyTip: 没有数据显示提示\r\n        cacheImage: 是否缓存列表中加载过的图片，控件回收后，图片缓存将被全部释放。\r\n     */\r\n        if (this.gridList) {\r\n            this.gridList.clearList();\r\n            this.gridList.initGridList({\r\n                paddingTop: 10,\r\n                paddingBottom: 10,\r\n                spacingX: 0,\r\n                spacingY: 0,\r\n                columnNum: 1,\r\n                useVirtualLayout: true,\r\n                emptyTip: oops.language.getLangByID(\"stringres_088\"),\r\n                cacheImage: true\r\n            });\r\n            //this.gridList.registerScrollToBottomEventHandler(this._nextPage, this);\r\n            this.gridList.registerSelectOneItemEventHandler(this._onSelectOneItem, this);\r\n\r\n            this.gridList.appendItemsToDisplayList(this._dataList);\r\n        }\r\n    }\r\n\r\n    _onSelectOneItem(data: any) {\r\n        console.log('_onSelectOneItem');\r\n    }\r\n\r\n    // 点击加号按钮\r\n    public onAddBtnClick() {\r\n        UtilMgr.PlaySoundEffect(18);\r\n        PaymentMgr.OpenPaymentUI();\r\n    }\r\n\r\n    // 点击兔子币加号按钮\r\n    public onTuziAddBtnClick() {\r\n        UtilMgr.PlaySoundEffect(18);\r\n        HeChengMgr.onGotoCarrots();\r\n    }\r\n\r\n    // 点击关闭按钮\r\n    public onCloseBtnClick() {\r\n        UtilMgr.PlaySoundEffect(19);\r\n        oops.gui.remove(UIID.ShopMain);\r\n    }\r\n}\r\n\r\n\r\n"]}